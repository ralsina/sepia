crystal_doc_search_index_callback({"repository_name":"Sepia","body":"# Sepia\n\nâš ï¸ **Warning: Unstable API and Storage Format**\nSepia is currently in active development and does not have a stable API or storage format. **The API is subject to change without notice**, and **breaking changes may occur in any release**. Additionally, the on-disk storage format is not stable - you will need to migrate your data stores when upgrading between versions. Use at your own risk in production.\n\nSepia is a file-system-based serialization library for Crystal that provides two main modules:\n\n- **`Sepia::Serializable`**: Objects serialize to single files\n- **`Sepia::Container`**: Objects serialize as directories containing nested objects\n\n## Installation\n\nAdd to your `shard.yml`:\n\n```yaml\ndependencies:\n  sepia:\n    github: ralsina/sepia\n```\n\n## Documentation\n\nðŸ“– **Full Documentation**: [https://ralsina.github.io/sepia](https://ralsina.github.io/sepia)\n\nThe documentation site includes:\n- Getting started guide\n- API reference\n- Examples and tutorials\n- Advanced features (backup, file watching, event logging)\n\n## Development\n\nRun tests with `crystal spec`.\n\n## Contributing\n\n1. Fork it\n2. Create your feature branch (`git checkout -b my-new-feature`)\n3. Commit your changes (`git commit -am 'Add some feature'`)\n4. Push to the branch (`git push origin my-new-feature`)\n5. Create a Pull Request","program":{"html_id":"Sepia/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"locations":[],"repository_name":"Sepia","program":true,"enum":false,"alias":false,"const":false,"types":[{"html_id":"Sepia/Sepia","path":"Sepia.html","kind":"module","full_name":"Sepia","name":"Sepia","abstract":false,"locations":[{"filename":"src/sepia.cr","line_number":285,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia.cr#L285"},{"filename":"src/sepia/backup.cr","line_number":5,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L5"},{"filename":"src/sepia/cache_manager.cr","line_number":4,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L4"},{"filename":"src/sepia/container.cr","line_number":5,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/container.cr#L5"},{"filename":"src/sepia/event.cr","line_number":3,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L3"},{"filename":"src/sepia/event_logger.cr","line_number":6,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L6"},{"filename":"src/sepia/file_storage.cr","line_number":7,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L7"},{"filename":"src/sepia/generation_info.cr","line_number":1,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/generation_info.cr#L1"},{"filename":"src/sepia/in_memory_storage.cr","line_number":3,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L3"},{"filename":"src/sepia/memory_limiter.cr","line_number":3,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L3"},{"filename":"src/sepia/object.cr","line_number":3,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L3"},{"filename":"src/sepia/path_resolver.cr","line_number":1,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L1"},{"filename":"src/sepia/serializable.cr","line_number":3,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/serializable.cr#L3"},{"filename":"src/sepia/storage.cr","line_number":8,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L8"},{"filename":"src/sepia/storage_backend.cr","line_number":1,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage_backend.cr#L1"},{"filename":"src/sepia/watcher.cr","line_number":15,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L15"},{"filename":"src/sepia/weak_cache.cr","line_number":4,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L4"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"VERSION","name":"VERSION","value":"\"0.1.0\""}],"doc":"Sepia is a simple, file-system-based serialization library for Crystal.\nIt provides two main modules: `Sepia::Serializable` and `Sepia::Container`.\n\nâš ï¸ **WARNING: UNSTABLE API AND STORAGE FORMAT**\n\nSepia is currently in active development and does not have a stable API or storage format.\n\n- **The API is subject to change without notice**\n- **Breaking changes may occur in any release**\n- **The on-disk storage format is not stable** - you will need to migrate your data stores when upgrading between versions\n\nUse at your own risk in production. Ensure you have proper backup and migration strategies in place.\n\n\nDisk Storage Strategy:\n\n**1. Individual Objects:**\n\n- `Sepia::Serializable` objects: Stored as individual files in a directory\n  named after their class, using their `sepia_id` as the filename.\n\n  Example:\n\n```\nclass MySerializable\n  include Sepia::Serializable\n  property value : String\n\n  def initialize(@value); end\n\n  def to_sepia\n    @value\n  end\n\n  def self.from_sepia(s)\n    new(s)\n  end\nend\n\nmy_obj = MySerializable.new(\"hello\")\nmy_obj.sepia_id = \"my_obj_id\"\nmy_obj.save\n```\n\n\n  On-disk representation:\n\n```text\n_data/\n  â””â”€â”€ MySerializable/\n      â””â”€â”€ my_obj_id\n```\n\n- `Sepia::Container` objects: Stored as directories, also named after their\n  class and using their `sepia_id` as the directory name.\n\n  Example:\n\n```\nclass MyContainer\n  include Sepia::Container\nend\n\nmy_container = MyContainer.new\nmy_container.sepia_id = \"my_container_id\"\nmy_container.save\n```\n\n  On-disk representation:\n\n```text\n  _data/\n  â””â”€â”€ MyContainer/\n      â””â”€â”€ my_container_id/\n```\n\n**2. Nested Objects within Containers:**\n- Nested `Serializable` objects: Stored as symlinks to their canonical\n  `Serializable` file.\n\n  Example:\n\n```\nclass MyContainer\n  include Sepia::Container\n  property nested_serializable : MySerializable\n\n  def initialize(@nested_serializable); end\nend\n\nmy_serializable = MySerializable.new(\"nested\")\nmy_serializable.sepia_id = \"nested_serializable_id\"\nmy_container = MyContainer.new(my_serializable)\nmy_container.sepia_id = \"container_with_serializable\"\nmy_container.save\n```\n\n  On-disk representation:\n\n```text\n  _data/\n  â”œâ”€â”€ MyContainer/\n  â”‚   â””â”€â”€ container_with_serializable/\n  â”‚       â””â”€â”€ nested_serializable -> ../../MySerializable/nested_serializable_id\n  â””â”€â”€ MySerializable/\n      â””â”€â”€ nested_serializable_id\n```\n\n- Nested `Container` objects: Stored as subdirectories, mirroring the\n  object hierarchy on disk.\n\n  Example:\n\n```\nclass MyOuterContainer\n  include Sepia::Container\n  property inner_container : MyContainer\n\n  def initialize(@inner_container); end\nend\n\nclass MyInnerContainer\n  include Sepia::Container\nend\n\ninner = MyInnerContainer.new\ninner.sepia_id = \"inner_container_id\"\nouter = MyOuterContainer.new(inner)\nouter.sepia_id = \"outer_container_id\"\nouter.save\n```\n\n  On-disk representation:\n\n```text\n  _data/\n  â””â”€â”€ MyOuterContainer/\n      â””â”€â”€ outer_container_id/\n          â””â”€â”€ inner_container/\n```\n\n**3. Collections within Containers:**\n- **Arrays/Sets of `Serializable` objects:** Stored in a subdirectory\n  named after the collection's instance variable. Each serializable object\n  is symlinked into that directory using its index as the filename.\n\n  #   Example:\n\n```\nclass MyContainerWithArray\n  include Sepia::Container\n  property serializables : Array(MySerializable)\n\n  def initialize(@serializables = [] of MySerializable); end\nend\n\ns1 = MySerializable.new(\"one\"); s1.sepia_id = \"s1_id\"\ns2 = MySerializable.new(\"two\"); s2.sepia_id = \"s2_id\"\ncontainer = MyContainerWithArray.new([s1, s2])\ncontainer.sepia_id = \"array_of_serializables\"\ncontainer.save\n```\n\n  On-disk representation:\n\n```text\n  _data/\n  â”œâ”€â”€ MyContainerWithArray/\n  â”‚   â””â”€â”€ array_of_serializables/\n  â”‚       â””â”€â”€ serializables/\n  â”‚           â”œâ”€â”€ 0 -> ../../../../MySerializable/s1_id\n  â”‚           â””â”€â”€ 1 -> ../../../../MySerializable/s2_id\n  â””â”€â”€ MySerializable/\n      â”œâ”€â”€ s1_id\n      â””â”€â”€ s2_id\n```\n\n- **Arrays/Sets of `Container` objects:** Stored in a subdirectory\n  named after the collection's instance variable. Each container object\n  is stored as a subdirectory within that directory, using its index as\n  the directory name.\n\n  Example:\n```\nclass MyContainerWithArrayOfContainers\n  include Sepia::Container\n  property containers : Array(MyContainer)\n\n  def initialize(@containers = [] of MyContainer); end\nend\n\nc1 = MyContainer.new; c1.sepia_id = \"c1_id\"\nc2 = MyContainer.new; c2.sepia_id = \"c2_id\"\ncontainer = MyContainerWithArrayOfContainers.new([c1, c2])\ncontainer.sepia_id = \"array_of_containers\"\ncontainer.save\n```\n\n  On-disk representation:\n\n```text\n_data/\n  â”œâ”€â”€ MyContainerWithArrayOfContainers/\n  â”‚   â””â”€â”€ array_of_containers/\n  â”‚       â””â”€â”€ containers/\n  â”‚           â”œâ”€â”€ 0/\n  â”‚           â””â”€â”€ 1/\n  â””â”€â”€ MyContainer/\n      â”œâ”€â”€ c1_id/\n      â””â”€â”€ c2_id/\n```\n\n- **Hashes (String keys) of `Serializable` values:** Stored in a subdirectory\n  named after the hash's instance variable. Each serializable object\n  is symlinked into that directory using its key as the filename.\n\n  Example:\n\n  ```\nclass MyContainerWithHash\n  include Sepia::Container\n  property serializables_hash : Hash(String, MySerializable)\n\n  def initialize(@serializables_hash = {} of String => MySerializable); end\nend\n\ns1 = MySerializable.new(\"alpha\"); s1.sepia_id = \"alpha_id\"\ns2 = MySerializable.new(\"beta\"); s2.sepia_id = \"beta_id\"\ncontainer = MyContainerWithHash.new({\"a\" => s1, \"b\" => s2})\ncontainer.sepia_id = \"hash_of_serializables\"\ncontainer.save\n  ```\n\n  On-disk representation:\n\n```text\n_data/\nâ”œâ”€â”€ MyContainerWithHash/\nâ”‚   â””â”€â”€ hash_of_serializables/\nâ”‚       â””â”€â”€ serializables_hash/\nâ”‚           â”œâ”€â”€ a -> ../../../../MySerializable/alpha_id\nâ”‚           â””â”€â”€ b -> ../../../../MySerializable/beta_id\nâ””â”€â”€ MySerializable/\n    â”œâ”€â”€ alpha_id\n    â””â”€â”€ beta_id\n```\n\n- **Hashes (String keys) of `Container` values:** Stored in a subdirectory\n  named after the hash's instance variable. Each container object\n  is stored as a subdirectory within that directory, using its key as\n  the directory name.\n\n  Example:\n\n```\nclass MyContainerWithHashOfContainers\n  include Sepia::Container\n  property containers_hash : Hash(String, MyContainer)\n\n  def initialize(@containers_hash = {} of String => MyContainer); end\nend\n\nc1 = MyContainer.new; c1.sepia_id = \"hash_c1_id\"\nc2 = MyContainer.new; c2.sepia_id = \"hash_c2_id\"\ncontainer = MyContainerWithHashOfContainers.new({\"x\" => c1, \"y\" => c2})\ncontainer.sepia_id = \"hash_of_containers\"\ncontainer.save\n```\n\nOn-disk representation:\n\n```text\n_data/\nâ”œâ”€â”€ MyContainerWithHashOfContainers/\nâ”‚   â””â”€â”€ hash_of_containers/\nâ”‚       â””â”€â”€ containers_hash/\nâ”‚           â”œâ”€â”€ x/\nâ”‚           â””â”€â”€ y/\nâ””â”€â”€ MyContainer/\n    â”œâ”€â”€ hash_c1_id/\n    â””â”€â”€ hash_c2_id/\n```","summary":"<p>Sepia is a simple, file-system-based serialization library for Crystal.</p>","class_methods":[{"html_id":"container?(name:String):Bool-class-method","name":"container?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"String"}],"args_string":"(name : String) : Bool","args_html":"(name : String) : Bool","location":{"filename":"src/sepia.cr","line_number":295,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia.cr#L295"},"def":{"name":"container?","args":[{"name":"name","external_name":"name","restriction":"String"}],"return_type":"Bool","visibility":"Public","body":"@@is_container_registry[name]? || false"},"external_var":false},{"html_id":"register_class_type(name:String,is_container:Bool)-class-method","name":"register_class_type","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"is_container","external_name":"is_container","restriction":"Bool"}],"args_string":"(name : String, is_container : Bool)","args_html":"(name : String, is_container : Bool)","location":{"filename":"src/sepia.cr","line_number":291,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia.cr#L291"},"def":{"name":"register_class_type","args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"is_container","external_name":"is_container","restriction":"Bool"}],"visibility":"Public","body":"@@is_container_registry[name] = is_container"},"external_var":false}],"types":[{"html_id":"Sepia/Sepia/BackendNotSupportedError","path":"Sepia/BackendNotSupportedError.html","kind":"class","full_name":"Sepia::BackendNotSupportedError","name":"BackendNotSupportedError","abstract":false,"superclass":{"html_id":"Sepia/Sepia/BackupError","kind":"class","full_name":"Sepia::BackupError","name":"BackupError"},"ancestors":[{"html_id":"Sepia/Sepia/BackupError","kind":"class","full_name":"Sepia::BackupError","name":"BackupError"},{"html_id":"Sepia/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/backup.cr","line_number":10,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L10"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"}},{"html_id":"Sepia/Sepia/Backup","path":"Sepia/Backup.html","kind":"class","full_name":"Sepia::Backup","name":"Backup","abstract":false,"superclass":{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/backup.cr","line_number":19,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L19"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"class_methods":[{"html_id":"create(root_objects:Array(Sepia::Object),output_path:String,config:Configuration):String-class-method","name":"create","doc":"Create backup with custom configuration","summary":"<p>Create backup with custom configuration</p>","abstract":false,"args":[{"name":"root_objects","external_name":"root_objects","restriction":"Array(Sepia::Object)"},{"name":"output_path","external_name":"output_path","restriction":"String"},{"name":"config","external_name":"config","restriction":"Configuration"}],"args_string":"(root_objects : Array(Sepia::Object), output_path : String, config : Configuration) : String","args_html":"(root_objects : Array(<a href=\"../Sepia/Object.html\">Sepia::Object</a>), output_path : String, config : <a href=\"../Sepia/Backup/Configuration.html\">Configuration</a>) : String","location":{"filename":"src/sepia/backup.cr","line_number":212,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L212"},"def":{"name":"create","args":[{"name":"root_objects","external_name":"root_objects","restriction":"Array(Sepia::Object)"},{"name":"output_path","external_name":"output_path","restriction":"String"},{"name":"config","external_name":"config","restriction":"Configuration"}],"return_type":"String","visibility":"Public","body":"manifest = BackupManifest.new\n\n\nroot_objects.each do |obj|\n  object_ref = ObjectReference.new(obj.class.name, obj.sepia_id, \"#{obj.class.name}/#{obj.sepia_id}\", determine_object_type(obj))\n  manifest.root_objects << object_ref\nend\n\n\ncollected_objects = collect_all_objects(root_objects)\n\n\ncollected_objects.each do |class_name, ids|\n  ids.each do |id|\n    object_ref = ObjectReference.new(class_name, id, \"#{class_name}/#{id}\", ObjectType::Serializable)\n    manifest.add_object(class_name, object_ref)\n  end\nend\n\n\nstorage_path = get_storage_path()\nbackup_files = collect_files_for_backup(collected_objects, storage_path, config)\n\n\nupdate_manifest_object_types(manifest, backup_files)\n\n\ncreate_tar_archive(backup_files, manifest, output_path, config)\n\noutput_path\n"},"external_var":false},{"html_id":"create(root_objects:Array(Sepia::Object),output_path:String):String-class-method","name":"create","doc":"Main backup class methods","summary":"<p>Main backup class methods</p>","abstract":false,"args":[{"name":"root_objects","external_name":"root_objects","restriction":"Array(Sepia::Object)"},{"name":"output_path","external_name":"output_path","restriction":"String"}],"args_string":"(root_objects : Array(Sepia::Object), output_path : String) : String","args_html":"(root_objects : Array(<a href=\"../Sepia/Object.html\">Sepia::Object</a>), output_path : String) : String","location":{"filename":"src/sepia/backup.cr","line_number":207,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L207"},"def":{"name":"create","args":[{"name":"root_objects","external_name":"root_objects","restriction":"Array(Sepia::Object)"},{"name":"output_path","external_name":"output_path","restriction":"String"}],"return_type":"String","visibility":"Public","body":"create(root_objects, output_path, Configuration.new)"},"external_var":false},{"html_id":"get_metadata(backup_path:String):BackupManifest-class-method","name":"get_metadata","doc":"Extracts metadata from a backup file","summary":"<p>Extracts metadata from a backup file</p>","abstract":false,"args":[{"name":"backup_path","external_name":"backup_path","restriction":"String"}],"args_string":"(backup_path : String) : BackupManifest","args_html":"(backup_path : String) : <a href=\"../Sepia/Backup/BackupManifest.html\">BackupManifest</a>","location":{"filename":"src/sepia/backup.cr","line_number":340,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L340"},"def":{"name":"get_metadata","args":[{"name":"backup_path","external_name":"backup_path","restriction":"String"}],"return_type":"BackupManifest","visibility":"Public","body":"list_contents(backup_path)"},"external_var":false},{"html_id":"list_contents(backup_path:String):BackupManifest-class-method","name":"list_contents","doc":"Lists contents of a backup without restoring\n\nThis method allows applications to inspect what objects are contained in a backup\narchive without performing a full restore. It extracts and parses the metadata\nto return information about the backup contents.\n\n### Parameters\n\n- *backup_path* : Path to the backup tar file\n\n### Returns\n\nA BackupManifest containing information about the backup contents\n\n### Example\n\n```\n# Inspect backup contents\nmanifest = Sepia::Backup.list_contents(\"user_backup.tar\")\nputs \"Backup created: #{manifest.created_at}\"\nputs \"Contains #{manifest.all_objects.values.map(&.size).sum} objects\"\nputs \"Root objects: #{manifest.root_objects.map(&.object_id).join(\", \")}\"\n```\n\n### Raises\n\n- `BackupCorruptionError` if the backup file is corrupted or missing metadata","summary":"<p>Lists contents of a backup without restoring</p>","abstract":false,"args":[{"name":"backup_path","external_name":"backup_path","restriction":"String"}],"args_string":"(backup_path : String) : BackupManifest","args_html":"(backup_path : String) : <a href=\"../Sepia/Backup/BackupManifest.html\">BackupManifest</a>","location":{"filename":"src/sepia/backup.cr","line_number":282,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L282"},"def":{"name":"list_contents","args":[{"name":"backup_path","external_name":"backup_path","restriction":"String"}],"return_type":"BackupManifest","visibility":"Public","body":"if File.exists?(backup_path)\nelse\n  raise(BackupCorruptionError.new(\"Backup file does not exist: #{backup_path}\"))\nend\n\nmetadata_content = extract_metadata_from_backup(backup_path)\n\nbegin\n  json_data = JSON.parse(metadata_content)\n\n\n  manifest = BackupManifest.new\n\n\n  if json_data[\"version\"]?\n    manifest.version = json_data[\"version\"].as_s\n  end\n\n  if json_data[\"created_at\"]?\n    manifest.created_at = Time.parse_rfc3339(json_data[\"created_at\"].as_s)\n  end\n\n\n  if json_data[\"root_objects\"]?\n    json_data[\"root_objects\"].as_a.each do |root_obj|\n      obj_ref = ObjectReference.new(root_obj[\"class_name\"].as_s, root_obj[\"object_id\"].as_s, root_obj[\"relative_path\"].as_s, root_obj[\"object_type\"].as_s == \"Container\" ? ObjectType::Container : ObjectType::Serializable)\n      manifest.root_objects << obj_ref\n    end\n  end\n\n\n  if json_data[\"all_objects\"]?\n    json_data[\"all_objects\"].as_h.each do |class_name, objects|\n      objects.as_a.each do |obj_data|\n        obj_ref = ObjectReference.new(obj_data[\"class_name\"].as_s, obj_data[\"object_id\"].as_s, obj_data[\"relative_path\"].as_s, obj_data[\"object_type\"].as_s == \"Container\" ? ObjectType::Container : ObjectType::Serializable)\n        manifest.add_object(class_name, obj_ref)\n      end\n    end\n  end\nrescue ex\n  raise(BackupCorruptionError.new(\"Failed to parse backup metadata: #{ex.message}\"))\nend\n\nmanifest\n"},"external_var":false},{"html_id":"restore(backup_path:String,target_storage_path:String|Nil=nil):Array(Sepia::Object)-class-method","name":"restore","doc":"Restores objects from a backup archive\n\nThis method is left for application-specific implementations as restore\nlogic varies greatly depending on business requirements, data migration\npolicies, and application-specific validation rules.\n\n### Parameters\n\n- *backup_path* : Path to the backup tar file\n- *target_storage_path* : Optional target storage path\n\n### Returns\n\nArray of restored Sepia::Object instances\n\n### Note\n\nThis method raises NotImplementedError as restore functionality should be\nimplemented by applications based on their specific requirements.","summary":"<p>Restores objects from a backup archive</p>","abstract":false,"args":[{"name":"backup_path","external_name":"backup_path","restriction":"String"},{"name":"target_storage_path","default_value":"nil","external_name":"target_storage_path","restriction":"String | ::Nil"}],"args_string":"(backup_path : String, target_storage_path : String | Nil = nil) : Array(Sepia::Object)","args_html":"(backup_path : String, target_storage_path : String | Nil = <span class=\"n\">nil</span>) : Array(<a href=\"../Sepia/Object.html\">Sepia::Object</a>)","location":{"filename":"src/sepia/backup.cr","line_number":451,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L451"},"def":{"name":"restore","args":[{"name":"backup_path","external_name":"backup_path","restriction":"String"},{"name":"target_storage_path","default_value":"nil","external_name":"target_storage_path","restriction":"String | ::Nil"}],"return_type":"Array(Sepia::Object)","visibility":"Public","body":"raise(NotImplementedError.new(\"Restore functionality should be implemented by applications based on their specific requirements. Use list_contents() and verify() to analyze backups before implementing custom restore logic.\"))"},"external_var":false},{"html_id":"verify(backup_path:String):BackupVerificationResult-class-method","name":"verify","doc":"Verifies backup integrity and structure\n\nThis method checks that the backup file is well-formed and that all expected\nfiles are present and readable. It provides detailed information about the\nbackup contents and any issues found.\n\n### Parameters\n\n- *backup_path* : Path to the backup tar file\n\n### Returns\n\nA BackupVerificationResult containing verification status and statistics\n\n### Example\n\n```\nresult = Sepia::Backup.verify(\"user_backup.tar\")\nif result.valid\n  puts \"Backup is valid\"\n  puts \"Contains #{result.statistics.total_objects} objects\"\nelse\n  puts \"Backup has issues:\"\n  result.errors.each { |error| puts \"  - #{error}\" }\nend\n```\n\n### Raises\n\n- `BackupCorruptionError` if the backup file is severely corrupted","summary":"<p>Verifies backup integrity and structure</p>","abstract":false,"args":[{"name":"backup_path","external_name":"backup_path","restriction":"String"}],"args_string":"(backup_path : String) : BackupVerificationResult","args_html":"(backup_path : String) : <a href=\"../Sepia/Backup/BackupVerificationResult.html\">BackupVerificationResult</a>","location":{"filename":"src/sepia/backup.cr","line_number":374,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L374"},"def":{"name":"verify","args":[{"name":"backup_path","external_name":"backup_path","restriction":"String"}],"return_type":"BackupVerificationResult","visibility":"Public","body":"result = BackupVerificationResult.new\n\n\nif File.exists?(backup_path)\nelse\n  result.add_error(\"Backup file does not exist: #{backup_path}\")\n  return result\nend\n\nbegin\n  manifest = list_contents(backup_path)\n\n\n  manifest.all_objects.each do |class_name, objects|\n    objects.each do |obj_ref|\n      result.statistics.add_object(class_name, obj_ref.object_type)\n    end\n  end\n\n\n  backup_file_list = get_backup_file_list(backup_path)\n\n\n  expected_files = [\"metadata.json\", \"README\"]\n  expected_files.each do |expected_file|\n    if backup_file_list.includes?(expected_file)\n    else\n      result.add_error(\"Missing expected file: #{expected_file}\")\n    end\n  end\n\n\n  manifest.all_objects.each do |class_name, objects|\n    objects.each do |obj_ref|\n      expected_path = \"objects/#{class_name}/#{obj_ref.object_id}\"\n      if obj_ref.object_type.container?\n        container_files = backup_file_list.select do |file| file.starts_with?(\"#{expected_path}/\") end\n        if container_files.empty?\n          result.add_error(\"Missing container directory structure: #{expected_path}/\")\n        end\n      elsif backup_file_list.includes?(expected_path)\n      else\n        result.add_error(\"Missing object file: #{expected_path}\")\n      end\n    end\n  end\nrescue ex : BackupCorruptionError\n  result.add_error(\"Backup corruption detected: #{ex.message}\")\nrescue ex\n  result.add_error(\"Unexpected error during verification: #{ex.message}\")\nend\n\nresult\n"},"external_var":false}],"types":[{"html_id":"Sepia/Sepia/Backup/BackupFile","path":"Sepia/Backup/BackupFile.html","kind":"struct","full_name":"Sepia::Backup::BackupFile","name":"BackupFile","abstract":false,"superclass":{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"Sepia/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/backup.cr","line_number":96,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L96"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia/Backup","kind":"class","full_name":"Sepia::Backup","name":"Backup"},"doc":"Represents a file to be included in the backup tarball","summary":"<p>Represents a file to be included in the backup tarball</p>","constructors":[{"html_id":"new(path:String,content:Bytes,type:String,mode:Int64,symlink_target:String|Nil=nil)-class-method","name":"new","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"content","external_name":"content","restriction":"Bytes"},{"name":"type","external_name":"type","restriction":"String"},{"name":"mode","external_name":"mode","restriction":"Int64"},{"name":"symlink_target","default_value":"nil","external_name":"symlink_target","restriction":"String | ::Nil"}],"args_string":"(path : String, content : Bytes, type : String, mode : Int64, symlink_target : String | Nil = nil)","args_html":"(path : String, content : Bytes, type : String, mode : Int64, symlink_target : String | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/sepia/backup.cr","line_number":103,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L103"},"def":{"name":"new","args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"content","external_name":"content","restriction":"Bytes"},{"name":"type","external_name":"type","restriction":"String"},{"name":"mode","external_name":"mode","restriction":"Int64"},{"name":"symlink_target","default_value":"nil","external_name":"symlink_target","restriction":"String | ::Nil"}],"visibility":"Public","body":"_ = allocate\n_.initialize(path, content, type, mode, symlink_target)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new(path:String,content_string:String,type:String,mode:Int64,symlink_target:String|Nil=nil)-class-method","name":"new","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"content_string","external_name":"content_string","restriction":"String"},{"name":"type","external_name":"type","restriction":"String"},{"name":"mode","external_name":"mode","restriction":"Int64"},{"name":"symlink_target","default_value":"nil","external_name":"symlink_target","restriction":"String | ::Nil"}],"args_string":"(path : String, content_string : String, type : String, mode : Int64, symlink_target : String | Nil = nil)","args_html":"(path : String, content_string : String, type : String, mode : Int64, symlink_target : String | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/sepia/backup.cr","line_number":106,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L106"},"def":{"name":"new","args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"content_string","external_name":"content_string","restriction":"String"},{"name":"type","external_name":"type","restriction":"String"},{"name":"mode","external_name":"mode","restriction":"Int64"},{"name":"symlink_target","default_value":"nil","external_name":"symlink_target","restriction":"String | ::Nil"}],"visibility":"Public","body":"_ = allocate\n_.initialize(path, content_string, type, mode, symlink_target)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"content:Bytes-instance-method","name":"content","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":98,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L98"},"def":{"name":"content","return_type":"Bytes","visibility":"Public","body":"@content"},"external_var":false},{"html_id":"content=(content:Bytes)-instance-method","name":"content=","abstract":false,"args":[{"name":"content","external_name":"content","restriction":"Bytes"}],"args_string":"(content : Bytes)","args_html":"(content : Bytes)","location":{"filename":"src/sepia/backup.cr","line_number":98,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L98"},"def":{"name":"content=","args":[{"name":"content","external_name":"content","restriction":"Bytes"}],"visibility":"Public","body":"@content = content"},"external_var":false},{"html_id":"mode:Int64-instance-method","name":"mode","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":100,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L100"},"def":{"name":"mode","return_type":"Int64","visibility":"Public","body":"@mode"},"external_var":false},{"html_id":"mode=(mode:Int64)-instance-method","name":"mode=","abstract":false,"args":[{"name":"mode","external_name":"mode","restriction":"Int64"}],"args_string":"(mode : Int64)","args_html":"(mode : Int64)","location":{"filename":"src/sepia/backup.cr","line_number":100,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L100"},"def":{"name":"mode=","args":[{"name":"mode","external_name":"mode","restriction":"Int64"}],"visibility":"Public","body":"@mode = mode"},"external_var":false},{"html_id":"path:String-instance-method","name":"path","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":97,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L97"},"def":{"name":"path","return_type":"String","visibility":"Public","body":"@path"},"external_var":false},{"html_id":"path=(path:String)-instance-method","name":"path=","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String)","args_html":"(path : String)","location":{"filename":"src/sepia/backup.cr","line_number":97,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L97"},"def":{"name":"path=","args":[{"name":"path","external_name":"path","restriction":"String"}],"visibility":"Public","body":"@path = path"},"external_var":false},{"html_id":"symlink_target:String|Nil-instance-method","name":"symlink_target","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":101,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L101"},"def":{"name":"symlink_target","return_type":"String | ::Nil","visibility":"Public","body":"@symlink_target"},"external_var":false},{"html_id":"symlink_target=(symlink_target:String|Nil)-instance-method","name":"symlink_target=","abstract":false,"args":[{"name":"symlink_target","external_name":"symlink_target","restriction":"String | ::Nil"}],"args_string":"(symlink_target : String | Nil)","args_html":"(symlink_target : String | Nil)","location":{"filename":"src/sepia/backup.cr","line_number":101,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L101"},"def":{"name":"symlink_target=","args":[{"name":"symlink_target","external_name":"symlink_target","restriction":"String | ::Nil"}],"visibility":"Public","body":"@symlink_target = symlink_target"},"external_var":false},{"html_id":"type:String-instance-method","name":"type","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":99,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L99"},"def":{"name":"type","return_type":"String","visibility":"Public","body":"@type"},"external_var":false},{"html_id":"type=(type:String)-instance-method","name":"type=","abstract":false,"args":[{"name":"type","external_name":"type","restriction":"String"}],"args_string":"(type : String)","args_html":"(type : String)","location":{"filename":"src/sepia/backup.cr","line_number":99,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L99"},"def":{"name":"type=","args":[{"name":"type","external_name":"type","restriction":"String"}],"visibility":"Public","body":"@type = type"},"external_var":false}]},{"html_id":"Sepia/Sepia/Backup/BackupManifest","path":"Sepia/Backup/BackupManifest.html","kind":"class","full_name":"Sepia::Backup::BackupManifest","name":"BackupManifest","abstract":false,"superclass":{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/backup.cr","line_number":112,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L112"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia/Backup","kind":"class","full_name":"Sepia::Backup","name":"Backup"},"doc":"Manifest containing backup metadata and object information","summary":"<p>Manifest containing backup metadata and object information</p>","class_methods":[{"html_id":"from_json(json:JSON::PullParser)-class-method","name":"from_json","abstract":false,"args":[{"name":"json","external_name":"json","restriction":"JSON::PullParser"}],"args_string":"(json : JSON::PullParser)","args_html":"(json : JSON::PullParser)","location":{"filename":"src/sepia/backup.cr","line_number":145,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L145"},"def":{"name":"from_json","args":[{"name":"json","external_name":"json","restriction":"JSON::PullParser"}],"visibility":"Public","body":"manifest = new\njson.read_object do |key|\n  case key\n  when \"version\"\n    manifest.version = json.read_string\n  when \"created_at\"\n    manifest.created_at = Time.parse_rfc3339(json.read_string)\n  when \"root_objects\"\n    manifest.root_objects = Array(ObjectReference).from_json(json)\n  when \"all_objects\"\n    json.read_object do |class_name|\n      manifest.all_objects[class_name] = Array(ObjectReference).from_json(json)\n    end\n  else\n    json.skip\n  end\nend\nmanifest\n"},"external_var":false}],"constructors":[{"html_id":"new(root_objects:Array(Sepia::Backup::ObjectReference)=[]ofObjectReference)-class-method","name":"new","abstract":false,"args":[{"name":"root_objects","default_value":"[] of ObjectReference","external_name":"root_objects","restriction":"::Array(::Sepia::Backup::ObjectReference)"}],"args_string":"(root_objects : Array(Sepia::Backup::ObjectReference) = [] of ObjectReference)","args_html":"(root_objects : Array(<a href=\"../../Sepia/Backup/ObjectReference.html\">Sepia::Backup::ObjectReference</a>) = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">ObjectReference</span>)","location":{"filename":"src/sepia/backup.cr","line_number":118,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L118"},"def":{"name":"new","args":[{"name":"root_objects","default_value":"[] of ObjectReference","external_name":"root_objects","restriction":"::Array(::Sepia::Backup::ObjectReference)"}],"visibility":"Public","body":"_ = allocate\n_.initialize(root_objects)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"add_object(class_name:String,object_ref:ObjectReference)-instance-method","name":"add_object","abstract":false,"args":[{"name":"class_name","external_name":"class_name","restriction":"String"},{"name":"object_ref","external_name":"object_ref","restriction":"ObjectReference"}],"args_string":"(class_name : String, object_ref : ObjectReference)","args_html":"(class_name : String, object_ref : <a href=\"../../Sepia/Backup/ObjectReference.html\">ObjectReference</a>)","location":{"filename":"src/sepia/backup.cr","line_number":122,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L122"},"def":{"name":"add_object","args":[{"name":"class_name","external_name":"class_name","restriction":"String"},{"name":"object_ref","external_name":"object_ref","restriction":"ObjectReference"}],"visibility":"Public","body":"@all_objects[class_name] << object_ref"},"external_var":false},{"html_id":"all_objects:Hash(String,Array(ObjectReference))-instance-method","name":"all_objects","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":116,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L116"},"def":{"name":"all_objects","return_type":"Hash(String, Array(ObjectReference))","visibility":"Public","body":"@all_objects"},"external_var":false},{"html_id":"all_objects=(all_objects:Hash(String,Array(ObjectReference)))-instance-method","name":"all_objects=","abstract":false,"args":[{"name":"all_objects","external_name":"all_objects","restriction":"Hash(String, Array(ObjectReference))"}],"args_string":"(all_objects : Hash(String, Array(ObjectReference)))","args_html":"(all_objects : Hash(String, Array(<a href=\"../../Sepia/Backup/ObjectReference.html\">ObjectReference</a>)))","location":{"filename":"src/sepia/backup.cr","line_number":116,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L116"},"def":{"name":"all_objects=","args":[{"name":"all_objects","external_name":"all_objects","restriction":"Hash(String, Array(ObjectReference))"}],"visibility":"Public","body":"@all_objects = all_objects"},"external_var":false},{"html_id":"created_at:Time-instance-method","name":"created_at","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":114,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L114"},"def":{"name":"created_at","return_type":"Time","visibility":"Public","body":"@created_at"},"external_var":false},{"html_id":"created_at=(created_at:Time)-instance-method","name":"created_at=","abstract":false,"args":[{"name":"created_at","external_name":"created_at","restriction":"Time"}],"args_string":"(created_at : Time)","args_html":"(created_at : Time)","location":{"filename":"src/sepia/backup.cr","line_number":114,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L114"},"def":{"name":"created_at=","args":[{"name":"created_at","external_name":"created_at","restriction":"Time"}],"visibility":"Public","body":"@created_at = created_at"},"external_var":false},{"html_id":"root_objects:Array(ObjectReference)-instance-method","name":"root_objects","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":115,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L115"},"def":{"name":"root_objects","return_type":"Array(ObjectReference)","visibility":"Public","body":"@root_objects"},"external_var":false},{"html_id":"root_objects=(root_objects:Array(ObjectReference))-instance-method","name":"root_objects=","abstract":false,"args":[{"name":"root_objects","external_name":"root_objects","restriction":"Array(ObjectReference)"}],"args_string":"(root_objects : Array(ObjectReference))","args_html":"(root_objects : Array(<a href=\"../../Sepia/Backup/ObjectReference.html\">ObjectReference</a>))","location":{"filename":"src/sepia/backup.cr","line_number":115,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L115"},"def":{"name":"root_objects=","args":[{"name":"root_objects","external_name":"root_objects","restriction":"Array(ObjectReference)"}],"visibility":"Public","body":"@root_objects = root_objects"},"external_var":false},{"html_id":"to_json(json:JSON::Builder)-instance-method","name":"to_json","abstract":false,"args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"args_string":"(json : JSON::Builder)","args_html":"(json : JSON::Builder)","location":{"filename":"src/sepia/backup.cr","line_number":126,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L126"},"def":{"name":"to_json","args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"visibility":"Public","body":"json.object do\n  json.field(\"version\", @version)\n  json.field(\"created_at\", @created_at.to_rfc3339)\n  json.field(\"root_objects\") do\n    @root_objects.to_json(json)\n  end\n  json.field(\"all_objects\") do\n    json.object do\n      @all_objects.each do |class_name, objects|\n        json.field(class_name) do\n          objects.to_json(json)\n        end\n      end\n    end\n  end\nend"},"external_var":false},{"html_id":"version:String-instance-method","name":"version","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":113,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L113"},"def":{"name":"version","return_type":"String","visibility":"Public","body":"@version"},"external_var":false},{"html_id":"version=(version:String)-instance-method","name":"version=","abstract":false,"args":[{"name":"version","external_name":"version","restriction":"String"}],"args_string":"(version : String)","args_html":"(version : String)","location":{"filename":"src/sepia/backup.cr","line_number":113,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L113"},"def":{"name":"version=","args":[{"name":"version","external_name":"version","restriction":"String"}],"visibility":"Public","body":"@version = version"},"external_var":false}]},{"html_id":"Sepia/Sepia/Backup/BackupStatistics","path":"Sepia/Backup/BackupStatistics.html","kind":"struct","full_name":"Sepia::Backup::BackupStatistics","name":"BackupStatistics","abstract":false,"superclass":{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"Sepia/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/backup.cr","line_number":185,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L185"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia/Backup","kind":"class","full_name":"Sepia::Backup","name":"Backup"},"doc":"Statistics about backup contents","summary":"<p>Statistics about backup contents</p>","constructors":[{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":185,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L185"},"def":{"name":"new","visibility":"Public","body":"x = allocate\nif x.responds_to?(:finalize)\n  ::GC.add_finalizer(x)\nend\nx\n"},"external_var":false}],"instance_methods":[{"html_id":"add_object(class_name:String,object_type:ObjectType)-instance-method","name":"add_object","abstract":false,"args":[{"name":"class_name","external_name":"class_name","restriction":"String"},{"name":"object_type","external_name":"object_type","restriction":"ObjectType"}],"args_string":"(class_name : String, object_type : ObjectType)","args_html":"(class_name : String, object_type : <a href=\"../../Sepia/Backup/ObjectType.html\">ObjectType</a>)","location":{"filename":"src/sepia/backup.cr","line_number":193,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L193"},"def":{"name":"add_object","args":[{"name":"class_name","external_name":"class_name","restriction":"String"},{"name":"object_type","external_name":"object_type","restriction":"ObjectType"}],"visibility":"Public","body":"@total_objects = @total_objects + 1\n@classes << class_name\n\ncase object_type\nwhen .serializable?\n  @serializable_objects = @serializable_objects + 1\nwhen .container?\n  @container_objects = @container_objects + 1\nend\n"},"external_var":false},{"html_id":"classes:Set(String)-instance-method","name":"classes","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":191,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L191"},"def":{"name":"classes","return_type":"Set(String)","visibility":"Public","body":"@classes"},"external_var":false},{"html_id":"classes=(classes:Set(String))-instance-method","name":"classes=","abstract":false,"args":[{"name":"classes","external_name":"classes","restriction":"Set(String)"}],"args_string":"(classes : Set(String))","args_html":"(classes : Set(String))","location":{"filename":"src/sepia/backup.cr","line_number":191,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L191"},"def":{"name":"classes=","args":[{"name":"classes","external_name":"classes","restriction":"Set(String)"}],"visibility":"Public","body":"@classes = classes"},"external_var":false},{"html_id":"container_objects:Int32-instance-method","name":"container_objects","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":188,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L188"},"def":{"name":"container_objects","return_type":"Int32","visibility":"Public","body":"@container_objects"},"external_var":false},{"html_id":"container_objects=(container_objects:Int32)-instance-method","name":"container_objects=","abstract":false,"args":[{"name":"container_objects","external_name":"container_objects","restriction":"Int32"}],"args_string":"(container_objects : Int32)","args_html":"(container_objects : Int32)","location":{"filename":"src/sepia/backup.cr","line_number":188,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L188"},"def":{"name":"container_objects=","args":[{"name":"container_objects","external_name":"container_objects","restriction":"Int32"}],"visibility":"Public","body":"@container_objects = container_objects"},"external_var":false},{"html_id":"initialize-instance-method","name":"initialize","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":185,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L185"},"def":{"name":"initialize","visibility":"Public","body":""},"external_var":false},{"html_id":"serializable_objects:Int32-instance-method","name":"serializable_objects","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":187,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L187"},"def":{"name":"serializable_objects","return_type":"Int32","visibility":"Public","body":"@serializable_objects"},"external_var":false},{"html_id":"serializable_objects=(serializable_objects:Int32)-instance-method","name":"serializable_objects=","abstract":false,"args":[{"name":"serializable_objects","external_name":"serializable_objects","restriction":"Int32"}],"args_string":"(serializable_objects : Int32)","args_html":"(serializable_objects : Int32)","location":{"filename":"src/sepia/backup.cr","line_number":187,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L187"},"def":{"name":"serializable_objects=","args":[{"name":"serializable_objects","external_name":"serializable_objects","restriction":"Int32"}],"visibility":"Public","body":"@serializable_objects = serializable_objects"},"external_var":false},{"html_id":"total_files:Int32-instance-method","name":"total_files","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":189,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L189"},"def":{"name":"total_files","return_type":"Int32","visibility":"Public","body":"@total_files"},"external_var":false},{"html_id":"total_files=(total_files:Int32)-instance-method","name":"total_files=","abstract":false,"args":[{"name":"total_files","external_name":"total_files","restriction":"Int32"}],"args_string":"(total_files : Int32)","args_html":"(total_files : Int32)","location":{"filename":"src/sepia/backup.cr","line_number":189,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L189"},"def":{"name":"total_files=","args":[{"name":"total_files","external_name":"total_files","restriction":"Int32"}],"visibility":"Public","body":"@total_files = total_files"},"external_var":false},{"html_id":"total_objects:Int32-instance-method","name":"total_objects","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":186,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L186"},"def":{"name":"total_objects","return_type":"Int32","visibility":"Public","body":"@total_objects"},"external_var":false},{"html_id":"total_objects=(total_objects:Int32)-instance-method","name":"total_objects=","abstract":false,"args":[{"name":"total_objects","external_name":"total_objects","restriction":"Int32"}],"args_string":"(total_objects : Int32)","args_html":"(total_objects : Int32)","location":{"filename":"src/sepia/backup.cr","line_number":186,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L186"},"def":{"name":"total_objects=","args":[{"name":"total_objects","external_name":"total_objects","restriction":"Int32"}],"visibility":"Public","body":"@total_objects = total_objects"},"external_var":false},{"html_id":"total_size:Int64-instance-method","name":"total_size","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":190,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L190"},"def":{"name":"total_size","return_type":"Int64","visibility":"Public","body":"@total_size"},"external_var":false},{"html_id":"total_size=(total_size:Int64)-instance-method","name":"total_size=","abstract":false,"args":[{"name":"total_size","external_name":"total_size","restriction":"Int64"}],"args_string":"(total_size : Int64)","args_html":"(total_size : Int64)","location":{"filename":"src/sepia/backup.cr","line_number":190,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L190"},"def":{"name":"total_size=","args":[{"name":"total_size","external_name":"total_size","restriction":"Int64"}],"visibility":"Public","body":"@total_size = total_size"},"external_var":false}]},{"html_id":"Sepia/Sepia/Backup/BackupVerificationResult","path":"Sepia/Backup/BackupVerificationResult.html","kind":"struct","full_name":"Sepia::Backup::BackupVerificationResult","name":"BackupVerificationResult","abstract":false,"superclass":{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"Sepia/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/backup.cr","line_number":168,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L168"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia/Backup","kind":"class","full_name":"Sepia::Backup","name":"Backup"},"doc":"Result of backup verification","summary":"<p>Result of backup verification</p>","constructors":[{"html_id":"new(valid:Bool=true)-class-method","name":"new","abstract":false,"args":[{"name":"valid","default_value":"true","external_name":"valid","restriction":"::Bool"}],"args_string":"(valid : Bool = true)","args_html":"(valid : Bool = <span class=\"n\">true</span>)","location":{"filename":"src/sepia/backup.cr","line_number":173,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L173"},"def":{"name":"new","args":[{"name":"valid","default_value":"true","external_name":"valid","restriction":"::Bool"}],"visibility":"Public","body":"_ = allocate\n_.initialize(valid)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"add_error(error:String)-instance-method","name":"add_error","abstract":false,"args":[{"name":"error","external_name":"error","restriction":"String"}],"args_string":"(error : String)","args_html":"(error : String)","location":{"filename":"src/sepia/backup.cr","line_number":178,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L178"},"def":{"name":"add_error","args":[{"name":"error","external_name":"error","restriction":"String"}],"visibility":"Public","body":"@valid = false\n@errors << error\n"},"external_var":false},{"html_id":"errors:Array(String)-instance-method","name":"errors","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":170,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L170"},"def":{"name":"errors","return_type":"Array(String)","visibility":"Public","body":"@errors"},"external_var":false},{"html_id":"errors=(errors:Array(String))-instance-method","name":"errors=","abstract":false,"args":[{"name":"errors","external_name":"errors","restriction":"Array(String)"}],"args_string":"(errors : Array(String))","args_html":"(errors : Array(String))","location":{"filename":"src/sepia/backup.cr","line_number":170,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L170"},"def":{"name":"errors=","args":[{"name":"errors","external_name":"errors","restriction":"Array(String)"}],"visibility":"Public","body":"@errors = errors"},"external_var":false},{"html_id":"statistics:BackupStatistics-instance-method","name":"statistics","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":171,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L171"},"def":{"name":"statistics","return_type":"BackupStatistics","visibility":"Public","body":"@statistics"},"external_var":false},{"html_id":"statistics=(statistics:BackupStatistics)-instance-method","name":"statistics=","abstract":false,"args":[{"name":"statistics","external_name":"statistics","restriction":"BackupStatistics"}],"args_string":"(statistics : BackupStatistics)","args_html":"(statistics : <a href=\"../../Sepia/Backup/BackupStatistics.html\">BackupStatistics</a>)","location":{"filename":"src/sepia/backup.cr","line_number":171,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L171"},"def":{"name":"statistics=","args":[{"name":"statistics","external_name":"statistics","restriction":"BackupStatistics"}],"visibility":"Public","body":"@statistics = statistics"},"external_var":false},{"html_id":"valid:Bool-instance-method","name":"valid","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":169,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L169"},"def":{"name":"valid","return_type":"Bool","visibility":"Public","body":"@valid"},"external_var":false},{"html_id":"valid=(valid:Bool)-instance-method","name":"valid=","abstract":false,"args":[{"name":"valid","external_name":"valid","restriction":"Bool"}],"args_string":"(valid : Bool)","args_html":"(valid : Bool)","location":{"filename":"src/sepia/backup.cr","line_number":169,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L169"},"def":{"name":"valid=","args":[{"name":"valid","external_name":"valid","restriction":"Bool"}],"visibility":"Public","body":"@valid = valid"},"external_var":false}]},{"html_id":"Sepia/Sepia/Backup/Configuration","path":"Sepia/Backup/Configuration.html","kind":"struct","full_name":"Sepia::Backup::Configuration","name":"Configuration","abstract":false,"superclass":{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"Sepia/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/backup.cr","line_number":42,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L42"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia/Backup","kind":"class","full_name":"Sepia::Backup","name":"Backup"},"doc":"Simple configuration options for backup creation","summary":"<p>Simple configuration options for backup creation</p>","constructors":[{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":46,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L46"},"def":{"name":"new","visibility":"Public","body":"_ = allocate\n_.initialize\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"follow_symlinks:Bool-instance-method","name":"follow_symlinks","doc":"Basic backup behavior","summary":"<p>Basic backup behavior</p>","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":44,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L44"},"def":{"name":"follow_symlinks","return_type":"Bool","visibility":"Public","body":"@follow_symlinks"},"external_var":false},{"html_id":"follow_symlinks=(follow_symlinks:Bool)-instance-method","name":"follow_symlinks=","doc":"Basic backup behavior","summary":"<p>Basic backup behavior</p>","abstract":false,"args":[{"name":"follow_symlinks","external_name":"follow_symlinks","restriction":"Bool"}],"args_string":"(follow_symlinks : Bool)","args_html":"(follow_symlinks : Bool)","location":{"filename":"src/sepia/backup.cr","line_number":44,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L44"},"def":{"name":"follow_symlinks=","args":[{"name":"follow_symlinks","external_name":"follow_symlinks","restriction":"Bool"}],"visibility":"Public","body":"@follow_symlinks = follow_symlinks"},"external_var":false}]},{"html_id":"Sepia/Sepia/Backup/ObjectReference","path":"Sepia/Backup/ObjectReference.html","kind":"struct","full_name":"Sepia::Backup::ObjectReference","name":"ObjectReference","abstract":false,"superclass":{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"Sepia/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/backup.cr","line_number":51,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L51"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia/Backup","kind":"class","full_name":"Sepia::Backup","name":"Backup"},"doc":"Represents a reference to an object in the backup","summary":"<p>Represents a reference to an object in the backup</p>","class_methods":[{"html_id":"from_json(json:JSON::PullParser)-class-method","name":"from_json","abstract":false,"args":[{"name":"json","external_name":"json","restriction":"JSON::PullParser"}],"args_string":"(json : JSON::PullParser)","args_html":"(json : JSON::PullParser)","location":{"filename":"src/sepia/backup.cr","line_number":69,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L69"},"def":{"name":"from_json","args":[{"name":"json","external_name":"json","restriction":"JSON::PullParser"}],"visibility":"Public","body":"class_name = \"\"\nobject_id = \"\"\nrelative_path = \"\"\nobject_type_str = \"\"\n\njson.read_object do |key|\n  case key\n  when \"class_name\"\n    class_name = json.read_string\n  when \"object_id\"\n    object_id = json.read_string\n  when \"relative_path\"\n    relative_path = json.read_string\n  when \"object_type\"\n    object_type_str = json.read_string\n  else\n    json.skip\n  end\nend\n\nobject_type = object_type_str == \"Container\" ? ObjectType::Container : ObjectType::Serializable\nnew(class_name, object_id, relative_path, object_type)\n"},"external_var":false}],"constructors":[{"html_id":"new(class_name:String,object_id:String,relative_path:String,object_type:ObjectType)-class-method","name":"new","abstract":false,"args":[{"name":"class_name","external_name":"class_name","restriction":"String"},{"name":"object_id","external_name":"object_id","restriction":"String"},{"name":"relative_path","external_name":"relative_path","restriction":"String"},{"name":"object_type","external_name":"object_type","restriction":"ObjectType"}],"args_string":"(class_name : String, object_id : String, relative_path : String, object_type : ObjectType)","args_html":"(class_name : String, object_id : String, relative_path : String, object_type : <a href=\"../../Sepia/Backup/ObjectType.html\">ObjectType</a>)","location":{"filename":"src/sepia/backup.cr","line_number":57,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L57"},"def":{"name":"new","args":[{"name":"class_name","external_name":"class_name","restriction":"String"},{"name":"object_id","external_name":"object_id","restriction":"String"},{"name":"relative_path","external_name":"relative_path","restriction":"String"},{"name":"object_type","external_name":"object_type","restriction":"ObjectType"}],"visibility":"Public","body":"_ = allocate\n_.initialize(class_name, object_id, relative_path, object_type)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"class_name:String-instance-method","name":"class_name","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":52,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L52"},"def":{"name":"class_name","return_type":"String","visibility":"Public","body":"@class_name"},"external_var":false},{"html_id":"class_name=(class_name:String)-instance-method","name":"class_name=","abstract":false,"args":[{"name":"class_name","external_name":"class_name","restriction":"String"}],"args_string":"(class_name : String)","args_html":"(class_name : String)","location":{"filename":"src/sepia/backup.cr","line_number":52,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L52"},"def":{"name":"class_name=","args":[{"name":"class_name","external_name":"class_name","restriction":"String"}],"visibility":"Public","body":"@class_name = class_name"},"external_var":false},{"html_id":"object_id:String-instance-method","name":"object_id","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":53,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L53"},"def":{"name":"object_id","return_type":"String","visibility":"Public","body":"@object_id"},"external_var":false},{"html_id":"object_id=(object_id:String)-instance-method","name":"object_id=","abstract":false,"args":[{"name":"object_id","external_name":"object_id","restriction":"String"}],"args_string":"(object_id : String)","args_html":"(object_id : String)","location":{"filename":"src/sepia/backup.cr","line_number":53,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L53"},"def":{"name":"object_id=","args":[{"name":"object_id","external_name":"object_id","restriction":"String"}],"visibility":"Public","body":"@object_id = object_id"},"external_var":false},{"html_id":"object_type:ObjectType-instance-method","name":"object_type","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":55,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L55"},"def":{"name":"object_type","return_type":"ObjectType","visibility":"Public","body":"@object_type"},"external_var":false},{"html_id":"object_type=(object_type:ObjectType)-instance-method","name":"object_type=","abstract":false,"args":[{"name":"object_type","external_name":"object_type","restriction":"ObjectType"}],"args_string":"(object_type : ObjectType)","args_html":"(object_type : <a href=\"../../Sepia/Backup/ObjectType.html\">ObjectType</a>)","location":{"filename":"src/sepia/backup.cr","line_number":55,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L55"},"def":{"name":"object_type=","args":[{"name":"object_type","external_name":"object_type","restriction":"ObjectType"}],"visibility":"Public","body":"@object_type = object_type"},"external_var":false},{"html_id":"relative_path:String-instance-method","name":"relative_path","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":54,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L54"},"def":{"name":"relative_path","return_type":"String","visibility":"Public","body":"@relative_path"},"external_var":false},{"html_id":"relative_path=(relative_path:String)-instance-method","name":"relative_path=","abstract":false,"args":[{"name":"relative_path","external_name":"relative_path","restriction":"String"}],"args_string":"(relative_path : String)","args_html":"(relative_path : String)","location":{"filename":"src/sepia/backup.cr","line_number":54,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L54"},"def":{"name":"relative_path=","args":[{"name":"relative_path","external_name":"relative_path","restriction":"String"}],"visibility":"Public","body":"@relative_path = relative_path"},"external_var":false},{"html_id":"to_json(json:JSON::Builder)-instance-method","name":"to_json","abstract":false,"args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"args_string":"(json : JSON::Builder)","args_html":"(json : JSON::Builder)","location":{"filename":"src/sepia/backup.cr","line_number":60,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L60"},"def":{"name":"to_json","args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"visibility":"Public","body":"json.object do\n  json.field(\"class_name\", @class_name)\n  json.field(\"object_id\", @object_id)\n  json.field(\"relative_path\", @relative_path)\n  json.field(\"object_type\", @object_type.to_s)\nend"},"external_var":false}]},{"html_id":"Sepia/Sepia/Backup/ObjectType","path":"Sepia/Backup/ObjectType.html","kind":"enum","full_name":"Sepia::Backup::ObjectType","name":"ObjectType","abstract":false,"ancestors":[{"html_id":"Sepia/Enum","kind":"struct","full_name":"Enum","name":"Enum"},{"html_id":"Sepia/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"Sepia/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/backup.cr","line_number":36,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L36"}],"repository_name":"Sepia","program":false,"enum":true,"alias":false,"const":false,"constants":[{"id":"Serializable","name":"Serializable","value":"0"},{"id":"Container","name":"Container","value":"1"}],"namespace":{"html_id":"Sepia/Sepia/Backup","kind":"class","full_name":"Sepia::Backup","name":"Backup"},"doc":"Backup and restore functionality for Sepia object trees\n\nThis class provides comprehensive backup/restore capabilities using tar archives.\nIt preserves object relationships, symlinks, and directory structures.\n\n### Example\n\n```\n# Create backup of object tree\nroot_objects = [document, project, user]\nbackup_path = Sepia::Backup.create(root_objects, \"backup.sepia.tar\")\n\n# Restore from backup\nrestored_objects = Sepia::Backup.restore(\"backup.sepia.tar\")\n```\nObject type classification for backup purposes","summary":"<p>Backup and restore functionality for Sepia object trees</p>","instance_methods":[{"html_id":"container?-instance-method","name":"container?","doc":"Returns `true` if this enum value equals `Container`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../../Sepia/Backup/ObjectType.html#Container\">Container</a></code></p>","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":38,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L38"},"def":{"name":"container?","visibility":"Public","body":"self == Container"},"external_var":false},{"html_id":"serializable?-instance-method","name":"serializable?","doc":"Returns `true` if this enum value equals `Serializable`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../../Sepia/Backup/ObjectType.html#Serializable\">Serializable</a></code></p>","abstract":false,"location":{"filename":"src/sepia/backup.cr","line_number":37,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L37"},"def":{"name":"serializable?","visibility":"Public","body":"self == Serializable"},"external_var":false}]}]},{"html_id":"Sepia/Sepia/BackupCorruptionError","path":"Sepia/BackupCorruptionError.html","kind":"class","full_name":"Sepia::BackupCorruptionError","name":"BackupCorruptionError","abstract":false,"superclass":{"html_id":"Sepia/Sepia/BackupError","kind":"class","full_name":"Sepia::BackupError","name":"BackupError"},"ancestors":[{"html_id":"Sepia/Sepia/BackupError","kind":"class","full_name":"Sepia::BackupError","name":"BackupError"},{"html_id":"Sepia/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/backup.cr","line_number":16,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L16"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"}},{"html_id":"Sepia/Sepia/BackupCreationError","path":"Sepia/BackupCreationError.html","kind":"class","full_name":"Sepia::BackupCreationError","name":"BackupCreationError","abstract":false,"superclass":{"html_id":"Sepia/Sepia/BackupError","kind":"class","full_name":"Sepia::BackupError","name":"BackupError"},"ancestors":[{"html_id":"Sepia/Sepia/BackupError","kind":"class","full_name":"Sepia::BackupError","name":"BackupError"},{"html_id":"Sepia/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/backup.cr","line_number":13,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L13"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"}},{"html_id":"Sepia/Sepia/BackupError","path":"Sepia/BackupError.html","kind":"class","full_name":"Sepia::BackupError","name":"BackupError","abstract":false,"superclass":{"html_id":"Sepia/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"Sepia/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/backup.cr","line_number":7,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/backup.cr#L7"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"subclasses":[{"html_id":"Sepia/Sepia/BackendNotSupportedError","kind":"class","full_name":"Sepia::BackendNotSupportedError","name":"BackendNotSupportedError"},{"html_id":"Sepia/Sepia/BackupCorruptionError","kind":"class","full_name":"Sepia::BackupCorruptionError","name":"BackupCorruptionError"},{"html_id":"Sepia/Sepia/BackupCreationError","kind":"class","full_name":"Sepia::BackupCreationError","name":"BackupCreationError"}],"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Backup-specific exception classes","summary":"<p>Backup-specific exception classes</p>"},{"html_id":"Sepia/Sepia/CacheManager","path":"Sepia/CacheManager.html","kind":"class","full_name":"Sepia::CacheManager","name":"CacheManager","abstract":false,"superclass":{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/cache_manager.cr","line_number":26,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L26"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Centralized cache manager for Sepia objects.\n\nProvides thread-safe LRU caching with configurable size limits, TTL,\nand eviction policies. Designed to work with both regular objects\nand LazyReference instances.\n\n### Example\n\n```\ncache = CacheManager.new(max_size: 1000, ttl: 3600.seconds)\n\n# Store an object\ncache.put(\"doc-123\", my_document)\n\n# Retrieve an object\ndoc = cache.get(\"doc-123\")\n\n# Cache statistics\nputs cache.stats\n# => {hits: 45, misses: 12, size: 23, max_size: 1000}\n```","summary":"<p>Centralized cache manager for Sepia objects.</p>","class_methods":[{"html_id":"instance_getter-class-method","name":"instance_getter","doc":"Alias for convenience (thread-safe)","summary":"<p>Alias for convenience (thread-safe)</p>","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":458,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L458"},"def":{"name":"instance_getter","visibility":"Public","body":"instance"},"external_var":false}],"constructors":[{"html_id":"instance:CacheManager-class-method","name":"instance","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":450,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L450"},"def":{"name":"instance","return_type":"CacheManager","visibility":"Public","body":"@@instance_mutex.synchronize do\n  @@instance || (@@instance = new)\n  @@instance.as(CacheManager)\nend"},"external_var":false},{"html_id":"new(max_size:Int32=1000,ttl:Time::Span|Nil=nil)-class-method","name":"new","doc":"Creates a new cache manager.\n\n### Parameters\n\n- *max_size* : Maximum number of items to cache (default: 1000)\n- *ttl* : Time-to-live for entries (default: nil = no expiration)\n\n### Example\n\n```\ncache = CacheManager.new(max_size: 500, ttl: 1.hour)\n```","summary":"<p>Creates a new cache manager.</p>","abstract":false,"args":[{"name":"max_size","default_value":"1000","external_name":"max_size","restriction":"Int32"},{"name":"ttl","default_value":"nil","external_name":"ttl","restriction":"Time::Span | ::Nil"}],"args_string":"(max_size : Int32 = 1000, ttl : Time::Span | Nil = nil)","args_html":"(max_size : Int32 = <span class=\"n\">1000</span>, ttl : Time::Span | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/sepia/cache_manager.cr","line_number":85,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L85"},"def":{"name":"new","args":[{"name":"max_size","default_value":"1000","external_name":"max_size","restriction":"Int32"},{"name":"ttl","default_value":"nil","external_name":"ttl","restriction":"Time::Span | ::Nil"}],"visibility":"Public","body":"_ = allocate\n_.initialize(max_size, ttl)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"cleanup_expired:Int32-instance-method","name":"cleanup_expired","doc":"Removes all expired entries from the cache.\n\n### Returns\n\nThe number of expired entries that were removed.\n\n### Example\n\n```\nremoved = cache.cleanup_expired\nputs \"Removed #{removed} expired entries\"\n```","summary":"<p>Removes all expired entries from the cache.</p>","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":306,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L306"},"def":{"name":"cleanup_expired","return_type":"Int32","visibility":"Public","body":"@mutex.synchronize do\n  removed = 0\n  @cache.each do |key, entry|\n    if entry.expired?\n      remove_key(key)\n      removed = removed + 1\n    end\n  end\n  removed\nend"},"external_var":false},{"html_id":"clear:Void-instance-method","name":"clear","doc":"Clears all entries from the cache.\n\n### Example\n\n```\ncache.clear\nputs cache.stats.size # => 0\n```","summary":"<p>Clears all entries from the cache.</p>","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":286,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L286"},"def":{"name":"clear","return_type":"Void","visibility":"Public","body":"@mutex.synchronize do\n  @cache.clear\n  @access_order.clear\n  @stats.size = 0\nend"},"external_var":false},{"html_id":"get(key:String,type:T.class):T|NilforallT-instance-method","name":"get","doc":"Retrieves an object of specific type from the cache.\n\nGeneric version of `get` that returns the properly typed object.\n\n### Parameters\n\n- *key* : The cache key\n\n### Returns\n\nThe cached object cast to type T or `nil` if not found/expired.\n\n### Example\n\n```\ndoc = cache.get(MyDocument, \"doc-123\")\nputs doc.title if doc\n```","summary":"<p>Retrieves an object of specific type from the cache.</p>","abstract":false,"args":[{"name":"key","external_name":"key","restriction":"String"},{"name":"type","external_name":"type","restriction":"T.class"}],"args_string":"(key : String, type : T.class) : T | Nil forall T","args_html":"(key : String, type : <span class=\"t\">T</span>.<span class=\"k\">class</span>) : T | Nil forall T","location":{"filename":"src/sepia/cache_manager.cr","line_number":188,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L188"},"def":{"name":"get","args":[{"name":"key","external_name":"key","restriction":"String"},{"name":"type","external_name":"type","restriction":"T.class"}],"return_type":"T | ::Nil","visibility":"Public","body":"object = get(key)\nif object\n  object.as(T | ::Nil)\nend\n"},"external_var":false},{"html_id":"get(key:String):Object|Nil-instance-method","name":"get","doc":"Retrieves an object from the cache.\n\nReturns `nil` if the key doesn't exist or the entry has expired.\nUpdates the access order for LRU tracking.\n\n### Parameters\n\n- *key* : The cache key\n\n### Returns\n\nThe cached object or `nil` if not found/expired.\n\n### Example\n\n```\ndoc = cache.get(\"doc-123\")\nputs doc.title if doc\n```","summary":"<p>Retrieves an object from the cache.</p>","abstract":false,"args":[{"name":"key","external_name":"key","restriction":"String"}],"args_string":"(key : String) : Object | Nil","args_html":"(key : String) : <a href=\"../Sepia/Object.html\">Object</a> | Nil","location":{"filename":"src/sepia/cache_manager.cr","line_number":148,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L148"},"def":{"name":"get","args":[{"name":"key","external_name":"key","restriction":"String"}],"return_type":"Object | ::Nil","visibility":"Public","body":"@mutex.synchronize do\n  entry = @cache[key]?\n\n  if entry\n    if entry.expired?\n      remove_key(key)\n      @stats.misses = @stats.misses + 1\n      nil\n    else\n      move_to_end(key)\n      @stats.hits = @stats.hits + 1\n      entry.value\n    end\n  else\n    @stats.misses = @stats.misses + 1\n    nil\n  end\nend"},"external_var":false},{"html_id":"has_key?(key:String):Bool-instance-method","name":"has_key?","doc":"Checks if a key exists in the cache (excluding expired entries).\n\n### Parameters\n\n- *key* : The cache key\n\n### Returns\n\n`true` if the key exists and hasn't expired, `false` otherwise.\n\n### Example\n\n```\nif cache.has_key?(\"doc-123\")\n  puts \"Document is cached\"\nend\n```","summary":"<p>Checks if a key exists in the cache (excluding expired entries).</p>","abstract":false,"args":[{"name":"key","external_name":"key","restriction":"String"}],"args_string":"(key : String) : Bool","args_html":"(key : String) : Bool","location":{"filename":"src/sepia/cache_manager.cr","line_number":210,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L210"},"def":{"name":"has_key?","args":[{"name":"key","external_name":"key","restriction":"String"}],"return_type":"Bool","visibility":"Public","body":"@mutex.synchronize do\n  entry = @cache[key]?\n  if entry && !entry.expired?\n    true\n  else\n    if entry\n      remove_key(key)\n    end\n    false\n  end\nend"},"external_var":false},{"html_id":"invalidate(key:String):Bool-instance-method","name":"invalidate","doc":"Invalidates a cache entry and updates invalidation statistics.\n\nThis is similar to remove, but specifically tracks invalidations\n(e.g., from external file changes via the filesystem watcher).\n\n### Parameters\n\n- *key* : The cache key to invalidate\n\n### Returns\n\n`true` if the key was invalidated, `false` if it didn't exist.\n\n### Example\n\n```\ncache.invalidate(\"doc-123\") # External file changed\n```","summary":"<p>Invalidates a cache entry and updates invalidation statistics.</p>","abstract":false,"args":[{"name":"key","external_name":"key","restriction":"String"}],"args_string":"(key : String) : Bool","args_html":"(key : String) : Bool","location":{"filename":"src/sepia/cache_manager.cr","line_number":266,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L266"},"def":{"name":"invalidate","args":[{"name":"key","external_name":"key","restriction":"String"}],"return_type":"Bool","visibility":"Public","body":"@mutex.synchronize do\n  if @cache.has_key?(key)\n    remove_key(key)\n    @stats.invalidations = @stats.invalidations + 1\n    true\n  else\n    false\n  end\nend"},"external_var":false},{"html_id":"keys:Array(String)-instance-method","name":"keys","doc":"Returns an array of all keys currently in the cache.\n\n### Returns\n\nArray of cache keys (most recently used last).\n\n### Example\n\n```\nkeys = cache.keys\nputs \"Cached objects: #{keys.size}\"\n```","summary":"<p>Returns an array of all keys currently in the cache.</p>","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":358,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L358"},"def":{"name":"keys","return_type":"Array(String)","visibility":"Public","body":"@mutex.synchronize do\n  @access_order.dup\nend"},"external_var":false},{"html_id":"max_size:Int32-instance-method","name":"max_size","doc":"Maximum number of items in cache","summary":"<p>Maximum number of items in cache</p>","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":65,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L65"},"def":{"name":"max_size","return_type":"Int32","visibility":"Public","body":"@max_size"},"external_var":false},{"html_id":"memory_usage:Int64-instance-method","name":"memory_usage","doc":"Estimates memory usage of the cache.\n\nThis is a rough estimation based on the number of cached objects.\nActual memory usage may vary based on object size.\n\n### Returns\n\nEstimated memory usage in bytes.\n\n### Example\n\n```\nbytes = cache.memory_usage\nputs \"Cache uses approximately #{bytes / 1024} KB\"\n```","summary":"<p>Estimates memory usage of the cache.</p>","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":400,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L400"},"def":{"name":"memory_usage","return_type":"Int64","visibility":"Public","body":"@mutex.synchronize do\n\n  @cache.size.to_i64 * 1024\nend"},"external_var":false},{"html_id":"put(key:String,value:Object):Void-instance-method","name":"put","doc":"Stores an object in the cache.\n\nIf the cache is full, implements LRU eviction by removing\nthe least recently used items.\n\n### Parameters\n\n- *key* : The cache key (typically object ID)\n- *value* : The object to cache\n\n### Example\n\n```\ncache.put(\"doc-123\", my_document)\n```","summary":"<p>Stores an object in the cache.</p>","abstract":false,"args":[{"name":"key","external_name":"key","restriction":"String"},{"name":"value","external_name":"value","restriction":"Object"}],"args_string":"(key : String, value : Object) : Void","args_html":"(key : String, value : <a href=\"../Sepia/Object.html\">Object</a>) : Void","location":{"filename":"src/sepia/cache_manager.cr","line_number":107,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L107"},"def":{"name":"put","args":[{"name":"key","external_name":"key","restriction":"String"},{"name":"value","external_name":"value","restriction":"Object"}],"return_type":"Void","visibility":"Public","body":"@mutex.synchronize do\n  expires_at = @ttl.try do |ttl| Time.utc + ttl end\n  entry = Entry(Object).new(value, expires_at)\n\n  if @cache.has_key?(key)\n    @cache[key] = entry\n    move_to_end(key)\n  else\n    if @cache.size >= @max_size\n      evict_lru\n    end\n\n    @cache[key] = entry\n    @access_order << key\n    @stats.size = @cache.size\n  end\nend"},"external_var":false},{"html_id":"remove(key:String):Bool-instance-method","name":"remove","doc":"Removes a specific key from the cache.\n\n### Parameters\n\n- *key* : The cache key to remove\n\n### Returns\n\n`true` if the key was removed, `false` if it didn't exist.\n\n### Example\n\n```\ncache.remove(\"doc-123\")\n```","summary":"<p>Removes a specific key from the cache.</p>","abstract":false,"args":[{"name":"key","external_name":"key","restriction":"String"}],"args_string":"(key : String) : Bool","args_html":"(key : String) : Bool","location":{"filename":"src/sepia/cache_manager.cr","line_number":237,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L237"},"def":{"name":"remove","args":[{"name":"key","external_name":"key","restriction":"String"}],"return_type":"Bool","visibility":"Public","body":"@mutex.synchronize do\n  if @cache.has_key?(key)\n    remove_key(key)\n    true\n  else\n    false\n  end\nend"},"external_var":false},{"html_id":"resize(new_size:Int32):Void-instance-method","name":"resize","doc":"Changes the maximum cache size.\n\nIf the new size is smaller than the current cache size,\nevicts LRU entries to fit the new limit.\n\n### Parameters\n\n- *new_size* : The new maximum cache size\n\n### Example\n\n```\ncache.resize(500) # Reduce cache size\n```","summary":"<p>Changes the maximum cache size.</p>","abstract":false,"args":[{"name":"new_size","external_name":"new_size","restriction":"Int32"}],"args_string":"(new_size : Int32) : Void","args_html":"(new_size : Int32) : Void","location":{"filename":"src/sepia/cache_manager.cr","line_number":333,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L333"},"def":{"name":"resize","args":[{"name":"new_size","external_name":"new_size","restriction":"Int32"}],"return_type":"Void","visibility":"Public","body":"@mutex.synchronize do\n\n  @max_size = new_size\n  @stats.max_size = new_size\n\n\n  while @cache.size > @max_size\n    evict_lru\n  end\nend"},"external_var":false},{"html_id":"stats:Stats-instance-method","name":"stats","doc":"Current cache statistics","summary":"<p>Current cache statistics</p>","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":71,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L71"},"def":{"name":"stats","return_type":"Stats","visibility":"Public","body":"@stats"},"external_var":false},{"html_id":"ttl:Time::Span|Nil-instance-method","name":"ttl","doc":"Time-to-live for cache entries (nil = no expiration)","summary":"<p>Time-to-live for cache entries (nil = no expiration)</p>","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":68,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L68"},"def":{"name":"ttl","return_type":"Time::Span | ::Nil","visibility":"Public","body":"@ttl"},"external_var":false},{"html_id":"values:Array(Object)-instance-method","name":"values","doc":"Returns an array of all non-expired values in the cache.\n\n### Returns\n\nArray of cached objects.\n\n### Example\n\n```\nobjects = cache.values\nputs \"Cached #{objects.size} objects\"\n```","summary":"<p>Returns an array of all non-expired values in the cache.</p>","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":376,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L376"},"def":{"name":"values","return_type":"Array(Object)","visibility":"Public","body":"@mutex.synchronize do\n  @access_order.compact_map do |key|\n    entry = @cache[key]?\n    entry && !entry.expired? ? entry.value : nil\n  end\nend"},"external_var":false}],"types":[{"html_id":"Sepia/Sepia/CacheManager/Stats","path":"Sepia/CacheManager/Stats.html","kind":"struct","full_name":"Sepia::CacheManager::Stats","name":"Stats","abstract":false,"superclass":{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"Sepia/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/cache_manager.cr","line_number":41,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L41"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia/CacheManager","kind":"class","full_name":"Sepia::CacheManager","name":"CacheManager"},"doc":"Cache statistics","summary":"<p>Cache statistics</p>","constructors":[{"html_id":"new(max_size:Int32)-class-method","name":"new","abstract":false,"args":[{"name":"max_size","external_name":"max_size","restriction":"Int32"}],"args_string":"(max_size : Int32)","args_html":"(max_size : Int32)","location":{"filename":"src/sepia/cache_manager.cr","line_number":49,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L49"},"def":{"name":"new","args":[{"name":"max_size","external_name":"max_size","restriction":"Int32"}],"visibility":"Public","body":"_ = allocate\n_.initialize(max_size)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"evictions:Int64-instance-method","name":"evictions","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":44,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L44"},"def":{"name":"evictions","return_type":"Int64","visibility":"Public","body":"@evictions"},"external_var":false},{"html_id":"evictions=(evictions:Int64)-instance-method","name":"evictions=","abstract":false,"args":[{"name":"evictions","external_name":"evictions","restriction":"Int64"}],"args_string":"(evictions : Int64)","args_html":"(evictions : Int64)","location":{"filename":"src/sepia/cache_manager.cr","line_number":44,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L44"},"def":{"name":"evictions=","args":[{"name":"evictions","external_name":"evictions","restriction":"Int64"}],"visibility":"Public","body":"@evictions = evictions"},"external_var":false},{"html_id":"hit_rate:Float64-instance-method","name":"hit_rate","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":52,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L52"},"def":{"name":"hit_rate","return_type":"Float64","visibility":"Public","body":"total = @hits + @misses\ntotal > 0 ? @hits.to_f / total : 0.0\n"},"external_var":false},{"html_id":"hits:Int64-instance-method","name":"hits","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":42,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L42"},"def":{"name":"hits","return_type":"Int64","visibility":"Public","body":"@hits"},"external_var":false},{"html_id":"hits=(hits:Int64)-instance-method","name":"hits=","abstract":false,"args":[{"name":"hits","external_name":"hits","restriction":"Int64"}],"args_string":"(hits : Int64)","args_html":"(hits : Int64)","location":{"filename":"src/sepia/cache_manager.cr","line_number":42,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L42"},"def":{"name":"hits=","args":[{"name":"hits","external_name":"hits","restriction":"Int64"}],"visibility":"Public","body":"@hits = hits"},"external_var":false},{"html_id":"invalidations:Int64-instance-method","name":"invalidations","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":45,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L45"},"def":{"name":"invalidations","return_type":"Int64","visibility":"Public","body":"@invalidations"},"external_var":false},{"html_id":"invalidations=(invalidations:Int64)-instance-method","name":"invalidations=","abstract":false,"args":[{"name":"invalidations","external_name":"invalidations","restriction":"Int64"}],"args_string":"(invalidations : Int64)","args_html":"(invalidations : Int64)","location":{"filename":"src/sepia/cache_manager.cr","line_number":45,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L45"},"def":{"name":"invalidations=","args":[{"name":"invalidations","external_name":"invalidations","restriction":"Int64"}],"visibility":"Public","body":"@invalidations = invalidations"},"external_var":false},{"html_id":"max_size:Int32-instance-method","name":"max_size","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":47,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L47"},"def":{"name":"max_size","return_type":"Int32","visibility":"Public","body":"@max_size"},"external_var":false},{"html_id":"max_size=(max_size:Int32)-instance-method","name":"max_size=","abstract":false,"args":[{"name":"max_size","external_name":"max_size","restriction":"Int32"}],"args_string":"(max_size : Int32)","args_html":"(max_size : Int32)","location":{"filename":"src/sepia/cache_manager.cr","line_number":47,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L47"},"def":{"name":"max_size=","args":[{"name":"max_size","external_name":"max_size","restriction":"Int32"}],"visibility":"Public","body":"@max_size = max_size"},"external_var":false},{"html_id":"misses:Int64-instance-method","name":"misses","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":43,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L43"},"def":{"name":"misses","return_type":"Int64","visibility":"Public","body":"@misses"},"external_var":false},{"html_id":"misses=(misses:Int64)-instance-method","name":"misses=","abstract":false,"args":[{"name":"misses","external_name":"misses","restriction":"Int64"}],"args_string":"(misses : Int64)","args_html":"(misses : Int64)","location":{"filename":"src/sepia/cache_manager.cr","line_number":43,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L43"},"def":{"name":"misses=","args":[{"name":"misses","external_name":"misses","restriction":"Int64"}],"visibility":"Public","body":"@misses = misses"},"external_var":false},{"html_id":"size:Int32-instance-method","name":"size","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":46,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L46"},"def":{"name":"size","return_type":"Int32","visibility":"Public","body":"@size"},"external_var":false},{"html_id":"size=(size:Int32)-instance-method","name":"size=","abstract":false,"args":[{"name":"size","external_name":"size","restriction":"Int32"}],"args_string":"(size : Int32)","args_html":"(size : Int32)","location":{"filename":"src/sepia/cache_manager.cr","line_number":46,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L46"},"def":{"name":"size=","args":[{"name":"size","external_name":"size","restriction":"Int32"}],"visibility":"Public","body":"@size = size"},"external_var":false},{"html_id":"to_s:String-instance-method","name":"to_s","doc":"Returns a nicely readable and concise string representation of this object,\ntypically intended for users.\n\nThis method should usually **not** be overridden. It delegates to\n`#to_s(IO)` which can be overridden for custom implementations.\n\nAlso see `#inspect`.","summary":"<p>Returns a nicely readable and concise string representation of this object, typically intended for users.</p>","abstract":false,"location":{"filename":"src/sepia/cache_manager.cr","line_number":57,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/cache_manager.cr#L57"},"def":{"name":"to_s","return_type":"String","visibility":"Public","body":"\"{hits: #{@hits}, misses: #{@misses}, evictions: #{@evictions}, invalidations: #{@invalidations}, size: #{@size}, max_size: #{@max_size}, hit_rate: #{(hit_rate * 100).round(2)}%}\""},"external_var":false}]}]},{"html_id":"Sepia/Sepia/Container","path":"Sepia/Container.html","kind":"module","full_name":"Sepia::Container","name":"Container","abstract":false,"locations":[{"filename":"src/sepia/container.cr","line_number":69,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/container.cr#L69"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Module for objects that contain other Sepia objects.\n\nThe `Container` module enables objects to contain nested Serializable or\nContainer objects. Containers serialize as directories on disk, with\ncontained objects stored as files, subdirectories, or symlinks.\n\nâš ï¸ **WARNING**: The Container API and on-disk format are subject to change.\nData migrations will be required when upgrading Sepia versions.\n\n### Key Features\n\n- **Automatic JSON Serialization**: Primitive properties are automatically\n  serialized to a `data.json` file\n- **Nested Object Storage**: Contained Sepia objects are stored as references\n- **Complex Structure Support**: Handles Arrays, Hashes, Sets, and nilable references\n- **Symlink References**: Serializable objects are stored as symlinks to avoid duplication\n\n### Directory Structure\n\n```\ncontainer_id/\n  â”œâ”€â”€ data.json           # Primitive properties (automatic)\n  â”œâ”€â”€ simple_array/       # Array of primitives\n  â”‚   â”œâ”€â”€ 0000_value1\n  â”‚   â””â”€â”€ 0001_value2\n  â”œâ”€â”€ object_array/       # Array of Sepia objects\n  â”‚   â”œâ”€â”€ 0000 -> ../../ClassName/id1\n  â”‚   â””â”€â”€ 0001 -> ../../ClassName/id2\n  â”œâ”€â”€ nested_object/      # Single Sepia object\n  â”‚   â””â”€â”€ 0000 -> ../../OtherClass/id\n  â””â”€â”€ complex_hash/       # Hash with mixed types\n      â”œâ”€â”€ key1/value1     # Primitive value\n      â””â”€â”€ key2 -> ../../RefClass/id  # Sepia object reference\n```\n\n### Example\n\n```\nclass Project < Sepia::Object\n  include Sepia::Container\n\n  # Primitive properties - automatically serialized\n  property name : String\n  property created_at : Time\n  property tags : Array(String)\n\n  # Sepia object references - stored as symlinks\n  owner : User?\n  tasks : Array(Task)\n  metadata : Hash(String, Document)?\n\n  def initialize(@name = \"\")\n    @created_at = Time.utc\n    @tags = [] of String\n    @tasks = [] of Task\n  end\nend\n\nproject = Project.new(\"My Project\")\nproject.owner = user            # User object\nproject.tasks << task1 << task2 # Task objects\nproject.save                    # Creates directory structure\n```","summary":"<p>Module for objects that contain other Sepia objects.</p>","instance_methods":[{"html_id":"load_enumerable_of_containers(path:String,name:String,collection_type:T.class,item_type:U.class)forallT,U-instance-method","name":"load_enumerable_of_containers","doc":"Loads an enumerable of containers from a directory of subdirectories.","summary":"<p>Loads an enumerable of containers from a directory of subdirectories.</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"name","external_name":"name","restriction":"String"},{"name":"collection_type","external_name":"collection_type","restriction":"T.class"},{"name":"item_type","external_name":"item_type","restriction":"U.class"}],"args_string":"(path : String, name : String, collection_type : T.class, item_type : U.class) forall T, U","args_html":"(path : String, name : String, collection_type : <span class=\"t\">T</span>.<span class=\"k\">class</span>, item_type : <span class=\"t\">U</span>.<span class=\"k\">class</span>) forall T, U","location":{"filename":"src/sepia/container.cr","line_number":638,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/container.cr#L638"},"def":{"name":"load_enumerable_of_containers","args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"name","external_name":"name","restriction":"String"},{"name":"collection_type","external_name":"collection_type","restriction":"T.class"},{"name":"item_type","external_name":"item_type","restriction":"U.class"}],"visibility":"Public","body":"array_dir = File.join(path, name)\nloaded_collection = T.new\nif Dir.exists?(array_dir)\n  dirs = (Dir.entries(array_dir)).reject do |e| (e == \".\") || (e == \"..\") end.sort!\n  dirs.each do |entry|\n    container_path = File.join(array_dir, entry)\n    if Dir.exists?(container_path)\n      container = U.new\n\n      container.sepia_id = (entry.split(\"_\", 2))[1]\n      container.load_references(container_path)\n      loaded_collection << container\n    end\n  end\nend\nloaded_collection\n"},"external_var":false},{"html_id":"load_enumerable_of_references(path:String,name:String,collection_type:T.class,item_type:U.class)forallT,U-instance-method","name":"load_enumerable_of_references","doc":"Loads an enumerable of serializable objects from a directory of symlinks.","summary":"<p>Loads an enumerable of serializable objects from a directory of symlinks.</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"name","external_name":"name","restriction":"String"},{"name":"collection_type","external_name":"collection_type","restriction":"T.class"},{"name":"item_type","external_name":"item_type","restriction":"U.class"}],"args_string":"(path : String, name : String, collection_type : T.class, item_type : U.class) forall T, U","args_html":"(path : String, name : String, collection_type : <span class=\"t\">T</span>.<span class=\"k\">class</span>, item_type : <span class=\"t\">U</span>.<span class=\"k\">class</span>) forall T, U","location":{"filename":"src/sepia/container.cr","line_number":606,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/container.cr#L606"},"def":{"name":"load_enumerable_of_references","args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"name","external_name":"name","restriction":"String"},{"name":"collection_type","external_name":"collection_type","restriction":"T.class"},{"name":"item_type","external_name":"item_type","restriction":"U.class"}],"visibility":"Public","body":"array_dir = File.join(path, name)\nloaded_collection = T.new\nif Dir.exists?(array_dir)\n  symlinks = (Dir.entries(array_dir)).reject do |e| (e == \".\") || (e == \"..\") end.sort!\n  symlinks.each do |entry|\n    symlink_path = File.join(array_dir, entry)\n    if File.symlink?(symlink_path)\n      obj_path = File.readlink(symlink_path)\n\n      abs_obj_path = if obj_path.starts_with?(\"/\")\n        obj_path\n      else\n        File.expand_path(obj_path, File.dirname(symlink_path))\n      end\n      obj_id = File.basename(abs_obj_path)\n\n      loaded_obj = item_type.from_sepia(File.read(abs_obj_path))\n      loaded_obj.sepia_id = obj_id\n      if loaded_obj.is_a?(Container)\n        container_path = abs_obj_path\n        loaded_obj.load_references(File.dirname(container_path))\n      end\n      loaded_collection << (loaded_obj.as(U))\n    end\n  end\nend\nloaded_collection\n"},"external_var":false},{"html_id":"load_hash_of_containers(path:String,name:String,collection_type:T.class,item_type:U.class)forallT,U-instance-method","name":"load_hash_of_containers","doc":"Loads a hash of containers from a directory of subdirectories.","summary":"<p>Loads a hash of containers from a directory of subdirectories.</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"name","external_name":"name","restriction":"String"},{"name":"collection_type","external_name":"collection_type","restriction":"T.class"},{"name":"item_type","external_name":"item_type","restriction":"U.class"}],"args_string":"(path : String, name : String, collection_type : T.class, item_type : U.class) forall T, U","args_html":"(path : String, name : String, collection_type : <span class=\"t\">T</span>.<span class=\"k\">class</span>, item_type : <span class=\"t\">U</span>.<span class=\"k\">class</span>) forall T, U","location":{"filename":"src/sepia/container.cr","line_number":677,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/container.cr#L677"},"def":{"name":"load_hash_of_containers","args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"name","external_name":"name","restriction":"String"},{"name":"collection_type","external_name":"collection_type","restriction":"T.class"},{"name":"item_type","external_name":"item_type","restriction":"U.class"}],"visibility":"Public","body":"hash_dir = File.join(path, name)\nloaded_hash = T.new\nif Dir.exists?(hash_dir)\n  dirs = (Dir.entries(hash_dir)).reject do |e| (e == \".\") || (e == \"..\") end\n  dirs.each do |entry|\n    container_path = File.join(hash_dir, entry)\n    if Dir.exists?(container_path)\n      container = U.new\n      container.sepia_id = entry\n      container.load_references(container_path)\n      loaded_hash[entry] = container\n    end\n  end\nend\nloaded_hash\n"},"external_var":false},{"html_id":"load_hash_of_references(path:String,name:String,collection_type:T.class,item_type:U.class)forallT,U-instance-method","name":"load_hash_of_references","doc":"Loads a hash of serializable objects from a directory of symlinks.","summary":"<p>Loads a hash of serializable objects from a directory of symlinks.</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"name","external_name":"name","restriction":"String"},{"name":"collection_type","external_name":"collection_type","restriction":"T.class"},{"name":"item_type","external_name":"item_type","restriction":"U.class"}],"args_string":"(path : String, name : String, collection_type : T.class, item_type : U.class) forall T, U","args_html":"(path : String, name : String, collection_type : <span class=\"t\">T</span>.<span class=\"k\">class</span>, item_type : <span class=\"t\">U</span>.<span class=\"k\">class</span>) forall T, U","location":{"filename":"src/sepia/container.cr","line_number":658,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/container.cr#L658"},"def":{"name":"load_hash_of_references","args":[{"name":"path","external_name":"path","restriction":"String"},{"name":"name","external_name":"name","restriction":"String"},{"name":"collection_type","external_name":"collection_type","restriction":"T.class"},{"name":"item_type","external_name":"item_type","restriction":"U.class"}],"visibility":"Public","body":"hash_dir = File.join(path, name)\nloaded_hash = T.new\nif Dir.exists?(hash_dir)\n  symlinks = (Dir.entries(hash_dir)).reject do |e| (e == \".\") || (e == \"..\") end\n  symlinks.each do |entry|\n    symlink_path = File.join(hash_dir, entry)\n    if File.symlink?(symlink_path)\n      obj_path = File.readlink(symlink_path)\n      obj_id = File.basename(obj_path)\n      loaded_obj = Sepia::Storage::INSTANCE.load(item_type, obj_id)\n      loaded_hash[entry] = loaded_obj.as(U)\n    end\n  end\nend\nloaded_hash\n"},"external_var":false},{"html_id":"load_references(path:String)-instance-method","name":"load_references","doc":"Loads all references (Serializable, Container, Enumerable of either)\nfrom the container's path.","summary":"<p>Loads all references (Serializable, Container, Enumerable of either) from the container's path.</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String)","args_html":"(path : String)","location":{"filename":"src/sepia/container.cr","line_number":420,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/container.cr#L420"},"def":{"name":"load_references","args":[{"name":"path","external_name":"path","restriction":"String"}],"visibility":"Public","body":"{% for ivar in @type.instance_vars %}\n        # For each instance variable, check if it's a Serializable or a Container.\n        # Handle both direct Serializable types and nilable Serializables (unions)\n        {% if ivar.type < Sepia::Serializable || (ivar.type.union? && ivar.type.union_types.any? do |type| type < Sepia::Serializable end) %}\n          # Determine the actual Serializable type (for union types, find the non-nil type)\n          {% if ivar.type < Sepia::Serializable %}\n            {% serializable_type = ivar.type %}\n          {% else %}\n            {% serializable_type = nil %}\n            {% for type in ivar.type.union_types %}\n              {% if type < Sepia::Serializable %}\n                {% serializable_type = type %}\n              {% end %}\n            {% end %}\n          {% end %}\n          # Check if we're using InMemoryStorage\n          if Sepia::Storage.backend.is_a?(InMemoryStorage)\n            # Load from in-memory reference storage\n            ref_key = Sepia::Storage.backend.as(InMemoryStorage).get_reference(path, {{ ivar.name.stringify }})\n            if ref_key\n              obj_class_name, obj_id = ref_key.split('/', 2)\n              @{{ ivar.name }} = Sepia::Storage::INSTANCE.load({{ serializable_type }}, obj_id).as({{ ivar.type }})\n            else\n              {% if ivar.type.nilable? %}\n                @{{ ivar.name }} = nil\n              {% else %}\n                raise \"Missing required reference for '\" + {{ ivar.name.stringify }} + \"' in container at \" + path\n              {% end %}\n            end\n          else\n            # Load from filesystem symlinks\n            symlink_path = File.join(path, {{ ivar.name.stringify }})\n            if File.symlink?(symlink_path)\n              # See where the symlink points to - it might be relative or absolute\n              obj_path = File.readlink(symlink_path)\n              # Resolve to absolute path\n              abs_obj_path = if obj_path.starts_with?(\"/\")\n                               obj_path\n                             else\n                               File.expand_path(obj_path, File.dirname(symlink_path))\n                             end\n              obj_id = File.basename(abs_obj_path)\n              # Read the file directly\n              obj = {{ serializable_type }}.from_sepia(File.read(abs_obj_path))\n              obj.sepia_id = obj_id\n              @{{ ivar.name }} = obj.as({{ ivar.type }})\n            else\n              {% if ivar.type.nilable? %}\n                @{{ ivar.name }} = nil\n              {% else %}\n                raise \"Missing required reference for '#{symlink_path}' for non-nilable property '{{ ivar.name }}'\"\n              {% end %}\n            end\n          end\n        {% elsif ivar.type < Sepia::Container %}\n          container_path = File.join(path, {{ ivar.name.stringify }})\n          if Dir.exists?(container_path)\n            @{{ ivar.name }} = {{ ivar.type }}.new\n            @{{ ivar.name }}.as({{ ivar.type }}).sepia_id = {{ ivar.name.stringify }}\n            @{{ ivar.name }}.as(Container).load_references(container_path)\n          else\n            {% if ivar.type.nilable? %}\n              @{{ ivar.name }} = nil\n            {% end %}\n          end\n        {% elsif ivar.type < Enumerable && ivar.type.type_vars.first < Sepia::Serializable %}\n          array_dir = File.join(path, {{ ivar.name.stringify }})\n          if Dir.exists?(array_dir)\n            @{{ ivar.name }} = load_enumerable_of_references(path, {{ ivar.name.stringify }}, {{ ivar.type }}, {{ ivar.type.type_vars.first }})\n          else\n            {% if ivar.type.union? %} # It's nilable\n              @{{ ivar.name }} = nil\n            {% else %} # It's not nilable, so create empty array\n              @{{ ivar.name }} = {{ ivar.type }}.new\n            {% end %}\n          end\n        {% elsif ivar.type < Enumerable && ivar.type.type_vars.first < Sepia::Container %}\n          array_dir = File.join(path, {{ ivar.name.stringify }})\n          if Dir.exists?(array_dir)\n            @{{ ivar.name }} = load_enumerable_of_containers(path, {{ ivar.name.stringify }}, {{ ivar.type }}, {{ ivar.type.type_vars.first }})\n          else\n            {% if ivar.type.union? %} # It's nilable\n              @{{ ivar.name }} = nil\n            {% else %} # It's not nilable, so create empty array\n              @{{ ivar.name }} = {{ ivar.type }}.new\n            {% end %}\n          end\n        {% elsif (ivar.type < Hash && (ivar.type.type_vars.first == String)) && ivar.type.type_vars.last < Sepia::Serializable %}\n          hash_dir = File.join(path, {{ ivar.name.stringify }})\n          if Dir.exists?(hash_dir)\n            @{{ ivar.name }} = load_hash_of_references(path, {{ ivar.name.stringify }}, {{ ivar.type }}, {{ ivar.type.type_vars.last }})\n          else\n            {% if ivar.type.union? %} # It's nilable\n              @{{ ivar.name }} = nil\n            {% else %} # It's not nilable, so create empty hash\n              @{{ ivar.name }} = {{ ivar.type }}.new\n            {% end %}\n          end\n        {% elsif (ivar.type < Hash && (ivar.type.type_vars.first == String)) && ivar.type.type_vars.last < Sepia::Container %}\n          hash_dir = File.join(path, {{ ivar.name.stringify }})\n          if Dir.exists?(hash_dir)\n            @{{ ivar.name }} = load_hash_of_containers(path, {{ ivar.name.stringify }}, {{ ivar.type }}, {{ ivar.type.type_vars.last }})\n          else\n            {% if ivar.type.union? %} # It's nilable\n              @{{ ivar.name }} = nil\n            {% else %} # It's not nilable, so create empty hash\n              @{{ ivar.name }} = {{ ivar.type }}.new\n            {% end %}\n          end\n        {% end %}\n      {% end %}\n\n\ndata_file = File.join(path, \"data.json\")\nif File.exists?(data_file)\n  json_data = File.read(data_file)\n  if json_data.empty?\n  else\n    parser = JSON::Parser.new(json_data)\n    data = parser.parse\n\n    if data_hash = data.as_h?\n      {% for ivar in @type.instance_vars %}\n                {% unless (\n        (\n          (\n            (\n              ivar.type < Sepia::Object ||\n              (ivar.type.union? && ivar.type.union_types.any? do |t| t < Sepia::Object end)\n            ) ||\n            (((ivar.type.stringify.includes?(\"Array\")) && ivar.type.type_vars.size > 0) && ivar.type.type_vars.first < Sepia::Object)\n          ) ||\n          (((ivar.type.stringify.includes?(\"Set\")) && ivar.type.type_vars.size > 0) && ivar.type.type_vars.first < Sepia::Object)\n        ) ||\n        (((ivar.type.stringify.includes?(\"Hash\")) && ivar.type.type_vars.size > 1) && ivar.type.type_vars.last < Sepia::Object)\n      ) ||\n      (ivar.name.stringify == \"sepia_id\") %}\n                  # Find the key (it might be a JSON::Any)\n                  key = data_hash.keys.find { |k| k.to_s == {{ ivar.name.stringify }} }\n                  if key\n                    value = data_hash[key]\n                    # Use JSON::Serializable's built-in parsing\n                    {% if ivar.type.stringify.includes?(\"Array\") %}\n                      parsed_value = Array({{ ivar.type.type_vars.first }}).from_json(value.to_json)\n                    {% elsif ivar.type.stringify.includes?(\"Hash\") %}\n                      parsed_value = Hash({{ ivar.type.type_vars.first }}, {{ ivar.type.type_vars.last }}).from_json(value.to_json)\n                    {% else %}\n                      parsed_value = {{ ivar.type }}.from_json(value.to_json)\n                    {% end %}\n                    @{{ ivar.name }} = parsed_value\n                  end\n                {% end %}\n              {% end %}\n    end\n  end\nend\n"},"external_var":false},{"html_id":"log_activity(action:String,metadata)-instance-method","name":"log_activity","doc":"Logs an activity event for this container.\n\nThis method allows containers to log arbitrary activities that are not\nrelated to object persistence (save/delete operations). Activities\nare stored in the container's event log alongside other events.\n\n### Parameters\n\n- *action* : Description of the activity (e.g., \"moved_lane\", \"edited\")\n- *metadata* : Optional metadata for the activity (caller's responsibility for JSON serializability)\n\n### Example\n\n```\nboard.log_activity(\"lane_created\", {\"lane_name\" => \"Review\", \"user\" => \"alice\"})\n\n# Simple version\nboard.log_activity(\"color_changed\")\n```","summary":"<p>Logs an activity event for this container.</p>","abstract":false,"args":[{"name":"action","external_name":"action","restriction":"String"},{"name":"metadata","external_name":"metadata","restriction":""}],"args_string":"(action : String, metadata)","args_html":"(action : String, metadata)","location":{"filename":"src/sepia/container.cr","line_number":714,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/container.cr#L714"},"def":{"name":"log_activity","args":[{"name":"action","external_name":"action","restriction":"String"},{"name":"metadata","external_name":"metadata","restriction":""}],"visibility":"Public","body":"activity_metadata = {\"action\" => action}.merge(metadata)\n\n\nif (self.class.responds_to?(:sepia_log_events)) && self.class.sepia_log_events\n  current_generation = EventLogger.current_generation(self.class, self.sepia_id)\n  EventLogger.append_event(self, LogEventType::Activity, current_generation, activity_metadata)\nend\n"},"external_var":false},{"html_id":"log_activity(action:String)-instance-method","name":"log_activity","doc":"Logs an activity event for this object (without metadata).\n\nThis method allows objects to log arbitrary activities that are not\nrelated to object persistence (save/delete operations). Activities\nare stored in the object's event log alongside other events.\n\n### Parameters\n\n- *action* : Description of the activity (e.g., \"moved_lane\", \"edited\")\n\n### Example\n\n```\nboard.log_activity(\"color_changed\")\n```","summary":"<p>Logs an activity event for this object (without metadata).</p>","abstract":false,"args":[{"name":"action","external_name":"action","restriction":"String"}],"args_string":"(action : String)","args_html":"(action : String)","location":{"filename":"src/sepia/container.cr","line_number":741,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/container.cr#L741"},"def":{"name":"log_activity","args":[{"name":"action","external_name":"action","restriction":"String"}],"visibility":"Public","body":"activity_metadata = {\"action\" => action}\n\n\nif (self.class.responds_to?(:sepia_log_events)) && self.class.sepia_log_events\n  current_generation = EventLogger.current_generation(self.class, self.sepia_id)\n  EventLogger.append_event(self, LogEventType::Activity, current_generation, activity_metadata)\nend\n"},"external_var":false},{"html_id":"restore_properties_from_json(json_data:String)-instance-method","name":"restore_properties_from_json","doc":"Restore primitive properties from JSON without creating a new instance","summary":"<p>Restore primitive properties from JSON without creating a new instance</p>","abstract":false,"args":[{"name":"json_data","external_name":"json_data","restriction":"String"}],"args_string":"(json_data : String)","args_html":"(json_data : String)","location":{"filename":"src/sepia/container.cr","line_number":572,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/container.cr#L572"},"def":{"name":"restore_properties_from_json","args":[{"name":"json_data","external_name":"json_data","restriction":"String"}],"visibility":"Public","body":"if json_data.empty?\n  return\nend\n\n\nparser = JSON::Parser.new(json_data)\ndata = parser.parse\n\nif data_hash = data.as_h?\n  {% for ivar in @type.instance_vars %}\n          {% unless (\n    (\n      (\n        (\n          ivar.type < Sepia::Object ||\n          (ivar.type.union? && ivar.type.union_types.any? do |t| t < Sepia::Object end)\n        ) ||\n        (((ivar.type.stringify.includes?(\"Array\")) && ivar.type.type_vars.size > 0) && ivar.type.type_vars.first < Sepia::Object)\n      ) ||\n      (((ivar.type.stringify.includes?(\"Set\")) && ivar.type.type_vars.size > 0) && ivar.type.type_vars.first < Sepia::Object)\n    ) ||\n    (((ivar.type.stringify.includes?(\"Hash\")) && ivar.type.type_vars.size > 1) && ivar.type.type_vars.last < Sepia::Object)\n  ) ||\n  (ivar.name.stringify == \"sepia_id\") %}\n            key = data_hash.keys.find { |k| k.to_s == {{ ivar.name.stringify }} }\n            if key\n              value = data_hash[key]\n              # Parse the value based on type\n              {% if ivar.type.stringify.includes?(\"Array\") %}\n                parsed_value = Array({{ ivar.type.type_vars.first }}).from_json(value.to_json)\n              {% elsif ivar.type.stringify.includes?(\"Hash\") %}\n                parsed_value = Hash({{ ivar.type.type_vars.first }}, {{ ivar.type.type_vars.last }}).from_json(value.to_json)\n              {% else %}\n                parsed_value = {{ ivar.type }}.from_json(value.to_json)\n              {% end %}\n              @{{ ivar.name }} = parsed_value\n            end\n          {% end %}\n        {% end %}\nend\n"},"external_var":false},{"html_id":"save_references(path:String)-instance-method","name":"save_references","doc":"Saves all references (Serializable, Container, Enumerable of either)\nto the container's path.","summary":"<p>Saves all references (Serializable, Container, Enumerable of either) to the container's path.</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String)","args_html":"(path : String)","location":{"filename":"src/sepia/container.cr","line_number":244,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/container.cr#L244"},"def":{"name":"save_references","args":[{"name":"path","external_name":"path","restriction":"String"}],"visibility":"Public","body":"Watcher.add_internal_file(path)\ndata_file = File.join(path, \"data.json\")\nWatcher.add_internal_file(data_file)\n\nbegin\n  {% for ivar in @type.instance_vars %}\n          save_value(path, @{{ ivar.name }}, {{ ivar.name.stringify }})\n        {% end %}\n\n\n  File.write(data_file, to_filtered_json)\n\n\n  spawn do\n    sleep(0.3.seconds)\n    Watcher.remove_internal_file(path)\n    Watcher.remove_internal_file(data_file)\n  end\nrescue ex\n  Watcher.remove_internal_file(path)\n  Watcher.remove_internal_file(data_file)\n  raise(ex)\nend\n"},"external_var":false},{"html_id":"sepia_references:Enumerable(Sepia::Object)-instance-method","name":"sepia_references","doc":"Returns all Sepia objects referenced by this container.\n\nThis method automatically inspects all instance variables and collects\nany Sepia objects, including those nested in Arrays, Hashes, and Sets.\nUsed by the garbage collector to track object relationships.\n\n### Returns\n\nAn Enumerable containing all Sepia objects referenced by this container.\n\n### Example\n\n```\nclass Team < Sepia::Object\n  include Sepia::Container\n  property members : Array(User)\n  property lead : User?\n  property projects : Hash(String, Project)\n\n  def initialize\n    @members = [] of User\n    @projects = {} of String => Project\n  end\nend\n\nteam = Team.new\nteam.members << user1 << user2\nteam.lead = user3\nteam.projects[\"web\"] = project1\n\nrefs = team.sepia_references\n# refs contains [user1, user2, user3, project1]\n```","summary":"<p>Returns all Sepia objects referenced by this container.</p>","abstract":false,"location":{"filename":"src/sepia/container.cr","line_number":217,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/container.cr#L217"},"def":{"name":"sepia_references","return_type":"Enumerable(Sepia::Object)","visibility":"Public","body":"refs = [] of Sepia::Object\n{% for ivar in @type.instance_vars %}\n        value = @{{ ivar.name }}\n        if value.is_a?(Sepia::Object)\n          refs << value\n        elsif value.is_a?(Enumerable)\n          value.each do |item|\n            add_sepia_object_to_refs(item, refs)\n          end\n        elsif value.is_a?(Hash)\n          value.each_value do |item|\n            add_sepia_object_to_refs(item, refs)\n          end\n        end\n      {% end %}\nrefs\n"},"external_var":false},{"html_id":"to_filtered_json:String-instance-method","name":"to_filtered_json","doc":"Serializes only primitive properties to JSON.\n\nThis method automatically filters out any Sepia object references,\nserializing only primitive types (String, Int32, Bool, Time, etc.)\nand collections of primitives. The resulting JSON is stored in\nthe container's `data.json` file.\n\n### Returns\n\nA JSON string containing only the primitive properties of the container.\n\n### Example\n\n```\nclass UserProfile < Sepia::Object\n  include Sepia::Container\n  property name : String         # Included in JSON\n  property age : Int32           # Included in JSON\n  property friends : Array(User) # Excluded (Sepia objects)\n\n  def initialize(@name = \"\", @age = 0)\n    @friends = [] of User\n  end\nend\n\nprofile = UserProfile.new(\"Alice\", 30)\njson = profile.to_filtered_json\n# json = {\"name\":\"Alice\",\"age\":30,\"friends\":[]}\n```","summary":"<p>Serializes only primitive properties to JSON.</p>","abstract":false,"location":{"filename":"src/sepia/container.cr","line_number":165,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/container.cr#L165"},"def":{"name":"to_filtered_json","return_type":"String","visibility":"Public","body":"String.build do |io|\n  JSON.build(io) do |json|\n    json.object do\n      {% for ivar in @type.instance_vars %}\n              {% unless (\n        (\n          (\n            (\n              ivar.type < Sepia::Object ||\n              (ivar.type.union? && ivar.type.union_types.any? do |t| t < Sepia::Object end)\n            ) ||\n            (((ivar.type.stringify.includes?(\"Array\")) && ivar.type.type_vars.size > 0) && ivar.type.type_vars.first < Sepia::Object)\n          ) ||\n          (((ivar.type.stringify.includes?(\"Set\")) && ivar.type.type_vars.size > 0) && ivar.type.type_vars.first < Sepia::Object)\n        ) ||\n        (((ivar.type.stringify.includes?(\"Hash\")) && ivar.type.type_vars.size > 1) && ivar.type.type_vars.last < Sepia::Object)\n      ) ||\n      (ivar.name.stringify == \"sepia_id\") %}\n                json.field {{ ivar.name.stringify }}, @{{ ivar.name }}\n              {% end %}\n            {% end %}\n    end\n  end\nend"},"external_var":false}]},{"html_id":"Sepia/Sepia/Event","path":"Sepia/Event.html","kind":"struct","full_name":"Sepia::Event","name":"Event","abstract":false,"superclass":{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"Sepia/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/watcher.cr","line_number":24,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L24"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Represents a file system event for a Sepia object.","summary":"<p>Represents a file system event for a Sepia object.</p>","constructors":[{"html_id":"new(type:EventType,object_class:String,object_id:String,path:String,object_info:PathResolver::ObjectInfo|Nil=nil)-class-method","name":"new","abstract":false,"args":[{"name":"type","external_name":"type","restriction":"EventType"},{"name":"object_class","external_name":"object_class","restriction":"String"},{"name":"object_id","external_name":"object_id","restriction":"String"},{"name":"path","external_name":"path","restriction":"String"},{"name":"object_info","default_value":"nil","external_name":"object_info","restriction":"PathResolver::ObjectInfo | ::Nil"}],"args_string":"(type : EventType, object_class : String, object_id : String, path : String, object_info : PathResolver::ObjectInfo | Nil = nil)","args_html":"(type : <a href=\"../Sepia/EventType.html\">EventType</a>, object_class : String, object_id : String, path : String, object_info : <a href=\"../Sepia/PathResolver/ObjectInfo.html\">PathResolver::ObjectInfo</a> | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/sepia/watcher.cr","line_number":32,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L32"},"def":{"name":"new","args":[{"name":"type","external_name":"type","restriction":"EventType"},{"name":"object_class","external_name":"object_class","restriction":"String"},{"name":"object_id","external_name":"object_id","restriction":"String"},{"name":"path","external_name":"path","restriction":"String"},{"name":"object_info","default_value":"nil","external_name":"object_info","restriction":"PathResolver::ObjectInfo | ::Nil"}],"visibility":"Public","body":"_ = allocate\n_.initialize(type, object_class, object_id, path, object_info)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"object(klass:Class):Object|Nil-instance-method","name":"object","doc":"Load the actual Sepia object from this event\n\n```\nobj = event.object(MyDocument)\nif obj\n  puts \"Loaded object: #{obj.class.name}\"\nend\n```","summary":"<p>Load the actual Sepia object from this event</p>","abstract":false,"args":[{"name":"klass","external_name":"klass","restriction":"Class"}],"args_string":"(klass : Class) : Object | Nil","args_html":"(klass : Class) : <a href=\"../Sepia/Object.html\">Object</a> | Nil","location":{"filename":"src/sepia/watcher.cr","line_number":49,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L49"},"def":{"name":"object","args":[{"name":"klass","external_name":"klass","restriction":"Class"}],"return_type":"Object | ::Nil","visibility":"Public","body":"info = @object_info\nif info\nelse\n  return nil\nend\n\ninfo.object(klass)\n"},"external_var":false},{"html_id":"object_class:String-instance-method","name":"object_class","abstract":false,"location":{"filename":"src/sepia/watcher.cr","line_number":26,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L26"},"def":{"name":"object_class","return_type":"String","visibility":"Public","body":"@object_class"},"external_var":false},{"html_id":"object_class=(object_class:String)-instance-method","name":"object_class=","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"String"}],"args_string":"(object_class : String)","args_html":"(object_class : String)","location":{"filename":"src/sepia/watcher.cr","line_number":26,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L26"},"def":{"name":"object_class=","args":[{"name":"object_class","external_name":"object_class","restriction":"String"}],"visibility":"Public","body":"@object_class = object_class"},"external_var":false},{"html_id":"object_id:String-instance-method","name":"object_id","abstract":false,"location":{"filename":"src/sepia/watcher.cr","line_number":27,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L27"},"def":{"name":"object_id","return_type":"String","visibility":"Public","body":"@object_id"},"external_var":false},{"html_id":"object_id=(object_id:String)-instance-method","name":"object_id=","abstract":false,"args":[{"name":"object_id","external_name":"object_id","restriction":"String"}],"args_string":"(object_id : String)","args_html":"(object_id : String)","location":{"filename":"src/sepia/watcher.cr","line_number":27,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L27"},"def":{"name":"object_id=","args":[{"name":"object_id","external_name":"object_id","restriction":"String"}],"visibility":"Public","body":"@object_id = object_id"},"external_var":false},{"html_id":"object_info:PathResolver::ObjectInfo|Nil-instance-method","name":"object_info","abstract":false,"location":{"filename":"src/sepia/watcher.cr","line_number":30,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L30"},"def":{"name":"object_info","return_type":"PathResolver::ObjectInfo | ::Nil","visibility":"Public","body":"@object_info"},"external_var":false},{"html_id":"object_info=(object_info:PathResolver::ObjectInfo|Nil)-instance-method","name":"object_info=","abstract":false,"args":[{"name":"object_info","external_name":"object_info","restriction":"PathResolver::ObjectInfo | ::Nil"}],"args_string":"(object_info : PathResolver::ObjectInfo | Nil)","args_html":"(object_info : <a href=\"../Sepia/PathResolver/ObjectInfo.html\">PathResolver::ObjectInfo</a> | Nil)","location":{"filename":"src/sepia/watcher.cr","line_number":30,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L30"},"def":{"name":"object_info=","args":[{"name":"object_info","external_name":"object_info","restriction":"PathResolver::ObjectInfo | ::Nil"}],"visibility":"Public","body":"@object_info = object_info"},"external_var":false},{"html_id":"object_info?:Sepia::PathResolver::ObjectInfo?-instance-method","name":"object_info?","doc":"Get the resolved object information for this event","summary":"<p>Get the resolved object information for this event</p>","abstract":false,"location":{"filename":"src/sepia/watcher.cr","line_number":37,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L37"},"def":{"name":"object_info?","visibility":"Public","body":"@object_info"},"external_var":false},{"html_id":"path:String-instance-method","name":"path","abstract":false,"location":{"filename":"src/sepia/watcher.cr","line_number":28,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L28"},"def":{"name":"path","return_type":"String","visibility":"Public","body":"@path"},"external_var":false},{"html_id":"path=(path:String)-instance-method","name":"path=","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String)","args_html":"(path : String)","location":{"filename":"src/sepia/watcher.cr","line_number":28,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L28"},"def":{"name":"path=","args":[{"name":"path","external_name":"path","restriction":"String"}],"visibility":"Public","body":"@path = path"},"external_var":false},{"html_id":"timestamp:Time-instance-method","name":"timestamp","abstract":false,"location":{"filename":"src/sepia/watcher.cr","line_number":29,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L29"},"def":{"name":"timestamp","return_type":"Time","visibility":"Public","body":"@timestamp"},"external_var":false},{"html_id":"timestamp=(timestamp:Time)-instance-method","name":"timestamp=","abstract":false,"args":[{"name":"timestamp","external_name":"timestamp","restriction":"Time"}],"args_string":"(timestamp : Time)","args_html":"(timestamp : Time)","location":{"filename":"src/sepia/watcher.cr","line_number":29,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L29"},"def":{"name":"timestamp=","args":[{"name":"timestamp","external_name":"timestamp","restriction":"Time"}],"visibility":"Public","body":"@timestamp = timestamp"},"external_var":false},{"html_id":"type:EventType-instance-method","name":"type","abstract":false,"location":{"filename":"src/sepia/watcher.cr","line_number":25,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L25"},"def":{"name":"type","return_type":"EventType","visibility":"Public","body":"@type"},"external_var":false},{"html_id":"type=(type:EventType)-instance-method","name":"type=","abstract":false,"args":[{"name":"type","external_name":"type","restriction":"EventType"}],"args_string":"(type : EventType)","args_html":"(type : <a href=\"../Sepia/EventType.html\">EventType</a>)","location":{"filename":"src/sepia/watcher.cr","line_number":25,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L25"},"def":{"name":"type=","args":[{"name":"type","external_name":"type","restriction":"EventType"}],"visibility":"Public","body":"@type = type"},"external_var":false}]},{"html_id":"Sepia/Sepia/EventLogger","path":"Sepia/EventLogger.html","kind":"class","full_name":"Sepia::EventLogger","name":"EventLogger","abstract":false,"superclass":{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/event_logger.cr","line_number":205,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L205"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Main event logger that manages event logging operations.\n\nThis class provides the main interface for event logging in Sepia.\nIt manages the active backend and provides convenience methods\nfor common operations.","summary":"<p>Main event logger that manages event logging operations.</p>","class_methods":[{"html_id":"append_event(object:Serializable|Container,event_type:LogEventType,generation:Int32,metadata)-class-method","name":"append_event","doc":"Append an event to the log using the current backend.\n\nThis is the main entry point for event logging. It delegates\nto the configured backend after checking if logging is enabled.\n\n### Parameters\n\n- *object* : The Sepia object the event relates to\n- *event_type* : Type of event (Created, Updated, Deleted)\n- *generation* : Object generation number\n- *metadata* : Optional metadata for the event\n\n### Example\n\n```\nSepia::EventLogger.append_event(document, LogEventType::Updated, 2, {\"user\" => \"alice\"})\n```","summary":"<p>Append an event to the log using the current backend.</p>","abstract":false,"args":[{"name":"object","external_name":"object","restriction":"Serializable | Container"},{"name":"event_type","external_name":"event_type","restriction":"LogEventType"},{"name":"generation","external_name":"generation","restriction":"Int32"},{"name":"metadata","external_name":"metadata","restriction":""}],"args_string":"(object : Serializable | Container, event_type : LogEventType, generation : Int32, metadata)","args_html":"(object : <a href=\"../Sepia/Serializable.html\">Serializable</a> | <a href=\"../Sepia/Container.html\">Container</a>, event_type : <a href=\"../Sepia/LogEventType.html\">LogEventType</a>, generation : Int32, metadata)","location":{"filename":"src/sepia/event_logger.cr","line_number":256,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L256"},"def":{"name":"append_event","args":[{"name":"object","external_name":"object","restriction":"Serializable | Container"},{"name":"event_type","external_name":"event_type","restriction":"LogEventType"},{"name":"generation","external_name":"generation","restriction":"Int32"},{"name":"metadata","external_name":"metadata","restriction":""}],"visibility":"Public","body":"@@backend.append_event(object, event_type, generation, metadata)"},"external_var":false},{"html_id":"backend:EventLoggerBackend-class-method","name":"backend","doc":"The current event logging backend.\n\nDefaults to PerFileEventLogger, but can be changed to support\ndifferent storage strategies.","summary":"<p>The current event logging backend.</p>","abstract":false,"location":{"filename":"src/sepia/event_logger.cr","line_number":210,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L210"},"def":{"name":"backend","return_type":"EventLoggerBackend","visibility":"Public","body":"@@backend"},"external_var":false},{"html_id":"backend=(backend:EventLoggerBackend)-class-method","name":"backend=","doc":"The current event logging backend.\n\nDefaults to PerFileEventLogger, but can be changed to support\ndifferent storage strategies.","summary":"<p>The current event logging backend.</p>","abstract":false,"args":[{"name":"backend","external_name":"backend","restriction":"EventLoggerBackend"}],"args_string":"(backend : EventLoggerBackend)","args_html":"(backend : <a href=\"../Sepia/EventLoggerBackend.html\">EventLoggerBackend</a>)","location":{"filename":"src/sepia/event_logger.cr","line_number":210,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L210"},"def":{"name":"backend=","args":[{"name":"backend","external_name":"backend","restriction":"EventLoggerBackend"}],"visibility":"Public","body":"@@backend = backend"},"external_var":false},{"html_id":"configure(backend:EventLoggerBackend)-class-method","name":"configure","doc":"Configure the event logging backend.\n\n### Parameters\n\n- *backend* : The backend instance to use for event logging\n\n### Example\n\n```\n# Use per-file logging (default)\nSepia::EventLogger.configure(PerFileEventLogger.new(\"./data\"))\n\n# Use global logging (future feature)\nSepia::EventLogger.configure(GlobalEventLogger.new(\"./data/events.jsonl\"))\n```","summary":"<p>Configure the event logging backend.</p>","abstract":false,"args":[{"name":"backend","external_name":"backend","restriction":"EventLoggerBackend"}],"args_string":"(backend : EventLoggerBackend)","args_html":"(backend : <a href=\"../Sepia/EventLoggerBackend.html\">EventLoggerBackend</a>)","location":{"filename":"src/sepia/event_logger.cr","line_number":227,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L227"},"def":{"name":"configure","args":[{"name":"backend","external_name":"backend","restriction":"EventLoggerBackend"}],"visibility":"Public","body":"@@backend = backend"},"external_var":false},{"html_id":"current_generation(object_class:Class,id:String):Int32-class-method","name":"current_generation","doc":"Get the current generation for an object.\n\nThis determines what generation number should be used for activity events.\nIt looks at the most recent save event (Created or Updated) to determine\nthe current generation of the object.\n\n### Parameters\n\n- *object_class* : The class of the object\n- *id* : The object's unique identifier\n\n### Returns\n\nThe current generation number for the object, or 0 if no save events exist\n\n### Example\n\n```\ncurrent_gen = Sepia::EventLogger.current_generation(MyDocument, \"doc-123\")\n```","summary":"<p>Get the current generation for an object.</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(object_class : Class, id : String) : Int32","args_html":"(object_class : Class, id : String) : Int32","location":{"filename":"src/sepia/event_logger.cr","line_number":359,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L359"},"def":{"name":"current_generation","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"return_type":"Int32","visibility":"Public","body":"events = read_events(object_class, id)\nif events.empty?\n  return 0\nend\n\n\nevents.reverse_each do |event|\n  case event.event_type\n  when LogEventType::Created, LogEventType::Updated\n    return event.generation\n  end\nend\n\n\n0\n"},"external_var":false},{"html_id":"last_event(object_class:Class,id:String):LogEvent|Nil-class-method","name":"last_event","doc":"Get the last event for a specific object.\n\nConvenience method that returns only the most recent event.\n\n### Parameters\n\n- *object_class* : The class of the object\n- *id* : The object's unique identifier\n\n### Returns\n\nThe last event for the object, or nil if no events exist\n\n### Example\n\n```\nlast_event = Sepia::EventLogger.last_event(MyDocument, \"doc-123\")\nif last_event\n  puts \"Last modified: #{last_event.timestamp}\"\nend\n```","summary":"<p>Get the last event for a specific object.</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(object_class : Class, id : String) : LogEvent | Nil","args_html":"(object_class : Class, id : String) : <a href=\"../Sepia/LogEvent.html\">LogEvent</a> | Nil","location":{"filename":"src/sepia/event_logger.cr","line_number":302,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L302"},"def":{"name":"last_event","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"return_type":"LogEvent | ::Nil","visibility":"Public","body":"(read_events(object_class, id)).last?"},"external_var":false},{"html_id":"next_generation(object_class:Class,id:String):Int32-class-method","name":"next_generation","doc":"Get the next generation number for an object.\n\nThis method reads the existing events for an object and determines\nwhat the next generation number should be based on the last event.\n\n### Parameters\n\n- *object_class* : The class of the object\n- *id* : The object's unique identifier\n\n### Returns\n\nThe next generation number (1 for new objects, existing+1 for updates)\n\n### Example\n\n```\nnext_gen = Sepia::EventLogger.next_generation(MyDocument, \"doc-123\")\nputs \"Next generation: #{next_gen}\"\n```","summary":"<p>Get the next generation number for an object.</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(object_class : Class, id : String) : Int32","args_html":"(object_class : Class, id : String) : Int32","location":{"filename":"src/sepia/event_logger.cr","line_number":326,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L326"},"def":{"name":"next_generation","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"return_type":"Int32","visibility":"Public","body":"events = read_events(object_class, id)\nif events.empty?\n  return 1\nend\n\nlast_event = events.last\ncase last_event.event_type\nwhen LogEventType::Deleted\n  1\nelse\n  last_event.generation + 1\nend\n"},"external_var":false},{"html_id":"read_events(object_class:Class,id:String):Array(LogEvent)-class-method","name":"read_events","doc":"Read all events for a specific object using the current backend.\n\n### Parameters\n\n- *object_class* : The class of the object\n- *id* : The object's unique identifier\n\n### Returns\n\nArray of events for the specified object, ordered by timestamp\n\n### Example\n\n```\nevents = Sepia::EventLogger.read_events(MyDocument, \"doc-123\")\nevents.each { |event| puts \"#{event.timestamp}: #{event.event_type}\" }\n```","summary":"<p>Read all events for a specific object using the current backend.</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(object_class : Class, id : String) : Array(LogEvent)","args_html":"(object_class : Class, id : String) : Array(<a href=\"../Sepia/LogEvent.html\">LogEvent</a>)","location":{"filename":"src/sepia/event_logger.cr","line_number":277,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L277"},"def":{"name":"read_events","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"return_type":"Array(LogEvent)","visibility":"Public","body":"@@backend.read_events(object_class, id)"},"external_var":false},{"html_id":"reset_backend-class-method","name":"reset_backend","doc":"Reset the event logging backend to a fresh instance.\n\nThis is useful in tests when you want to ensure a clean backend\nthat points to the current storage backend.","summary":"<p>Reset the event logging backend to a fresh instance.</p>","abstract":false,"location":{"filename":"src/sepia/event_logger.cr","line_number":235,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L235"},"def":{"name":"reset_backend","visibility":"Public","body":"@@backend = PerFileEventLogger.new"},"external_var":false},{"html_id":"should_log?(klass:Class):Bool-class-method","name":"should_log?","doc":"Check if event logging is enabled for a class.\n\nDelegates to the current backend's should_log? method.\n\n### Parameters\n\n- *klass* : The class to check\n\n### Returns\n\nTrue if events should be logged for this class","summary":"<p>Check if event logging is enabled for a class.</p>","abstract":false,"args":[{"name":"klass","external_name":"klass","restriction":"Class"}],"args_string":"(klass : Class) : Bool","args_html":"(klass : Class) : Bool","location":{"filename":"src/sepia/event_logger.cr","line_number":386,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L386"},"def":{"name":"should_log?","args":[{"name":"klass","external_name":"klass","restriction":"Class"}],"return_type":"Bool","visibility":"Public","body":"@@backend.should_log?(klass)"},"external_var":false}]},{"html_id":"Sepia/Sepia/EventLoggerBackend","path":"Sepia/EventLoggerBackend.html","kind":"class","full_name":"Sepia::EventLoggerBackend","name":"EventLoggerBackend","abstract":true,"superclass":{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/event_logger.cr","line_number":19,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L19"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"subclasses":[{"html_id":"Sepia/Sepia/PerFileEventLogger","kind":"class","full_name":"Sepia::PerFileEventLogger","name":"PerFileEventLogger"}],"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Abstract base class for event logging backends.\n\nThis class defines the interface that all event logging implementations\nmust follow. Different backends can store events in different ways\nwhile providing the same API to the storage system.\n\n### Implementations\n\n- `PerFileEventLogger` - One file per object (current default)\n- `GlobalEventLogger` - Single global log file (future)\n- `DatabaseEventLogger` - Database storage (future)\n- `CompositeEventLogger` - Multiple backends simultaneously (future)","summary":"<p>Abstract base class for event logging backends.</p>","instance_methods":[{"html_id":"append_event(object:Serializable|Container,event_type:LogEventType,generation:Int32,metadata)-instance-method","name":"append_event","doc":"Append an event to the log.\n\n### Parameters\n\n- *object* : The Sepia object the event relates to\n- *event_type* : Type of event (Created, Updated, Deleted)\n- *generation* : Object generation number\n- *metadata* : Optional metadata for the event","summary":"<p>Append an event to the log.</p>","abstract":true,"args":[{"name":"object","external_name":"object","restriction":"Serializable | Container"},{"name":"event_type","external_name":"event_type","restriction":"LogEventType"},{"name":"generation","external_name":"generation","restriction":"Int32"},{"name":"metadata","external_name":"metadata","restriction":""}],"args_string":"(object : Serializable | Container, event_type : LogEventType, generation : Int32, metadata)","args_html":"(object : <a href=\"../Sepia/Serializable.html\">Serializable</a> | <a href=\"../Sepia/Container.html\">Container</a>, event_type : <a href=\"../Sepia/LogEventType.html\">LogEventType</a>, generation : Int32, metadata)","location":{"filename":"src/sepia/event_logger.cr","line_number":28,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L28"},"def":{"name":"append_event","args":[{"name":"object","external_name":"object","restriction":"Serializable | Container"},{"name":"event_type","external_name":"event_type","restriction":"LogEventType"},{"name":"generation","external_name":"generation","restriction":"Int32"},{"name":"metadata","external_name":"metadata","restriction":""}],"visibility":"Public","body":""},"external_var":false},{"html_id":"read_events(object_class:Class,id:String):Array(LogEvent)-instance-method","name":"read_events","doc":"Read all events for a specific object.\n\n### Parameters\n\n- *object_class* : The class of the object\n- *id* : The object's unique identifier\n\n### Returns\n\nArray of events for the specified object, ordered by timestamp","summary":"<p>Read all events for a specific object.</p>","abstract":true,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(object_class : Class, id : String) : Array(LogEvent)","args_html":"(object_class : Class, id : String) : Array(<a href=\"../Sepia/LogEvent.html\">LogEvent</a>)","location":{"filename":"src/sepia/event_logger.cr","line_number":40,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L40"},"def":{"name":"read_events","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"return_type":"Array(LogEvent)","visibility":"Public","body":""},"external_var":false},{"html_id":"should_log?(klass:Class):Bool-instance-method","name":"should_log?","doc":"Check if this backend should log events for the given class.\n\nDefault implementation checks if the class has sepia_log_events enabled.\nSubclasses can override for more sophisticated filtering.\n\n### Parameters\n\n- *klass* : The class to check\n\n### Returns\n\nTrue if events should be logged for this class","summary":"<p>Check if this backend should log events for the given class.</p>","abstract":false,"args":[{"name":"klass","external_name":"klass","restriction":"Class"}],"args_string":"(klass : Class) : Bool","args_html":"(klass : Class) : Bool","location":{"filename":"src/sepia/event_logger.cr","line_number":54,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L54"},"def":{"name":"should_log?","args":[{"name":"klass","external_name":"klass","restriction":"Class"}],"return_type":"Bool","visibility":"Public","body":"(klass.responds_to?(:sepia_log_events)) && klass.sepia_log_events"},"external_var":false}]},{"html_id":"Sepia/Sepia/EventType","path":"Sepia/EventType.html","kind":"enum","full_name":"Sepia::EventType","name":"EventType","abstract":false,"ancestors":[{"html_id":"Sepia/Enum","kind":"struct","full_name":"Enum","name":"Enum"},{"html_id":"Sepia/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"Sepia/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/watcher.cr","line_number":17,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L17"}],"repository_name":"Sepia","program":false,"enum":true,"alias":false,"const":false,"constants":[{"id":"Created","name":"Created","value":"0"},{"id":"Modified","name":"Modified","value":"1"},{"id":"Deleted","name":"Deleted","value":"2"}],"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"File system event types for Sepia objects.","summary":"<p>File system event types for Sepia objects.</p>","instance_methods":[{"html_id":"created?-instance-method","name":"created?","doc":"Returns `true` if this enum value equals `Created`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../Sepia/EventType.html#Created\">Created</a></code></p>","abstract":false,"location":{"filename":"src/sepia/watcher.cr","line_number":18,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L18"},"def":{"name":"created?","visibility":"Public","body":"self == Created"},"external_var":false},{"html_id":"deleted?-instance-method","name":"deleted?","doc":"Returns `true` if this enum value equals `Deleted`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../Sepia/EventType.html#Deleted\">Deleted</a></code></p>","abstract":false,"location":{"filename":"src/sepia/watcher.cr","line_number":20,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L20"},"def":{"name":"deleted?","visibility":"Public","body":"self == Deleted"},"external_var":false},{"html_id":"modified?-instance-method","name":"modified?","doc":"Returns `true` if this enum value equals `Modified`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../Sepia/EventType.html#Modified\">Modified</a></code></p>","abstract":false,"location":{"filename":"src/sepia/watcher.cr","line_number":19,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L19"},"def":{"name":"modified?","visibility":"Public","body":"self == Modified"},"external_var":false}]},{"html_id":"Sepia/Sepia/FileStorage","path":"Sepia/FileStorage.html","kind":"class","full_name":"Sepia::FileStorage","name":"FileStorage","abstract":false,"superclass":{"html_id":"Sepia/Sepia/StorageBackend","kind":"class","full_name":"Sepia::StorageBackend","name":"StorageBackend"},"ancestors":[{"html_id":"Sepia/Sepia/StorageBackend","kind":"class","full_name":"Sepia::StorageBackend","name":"StorageBackend"},{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/file_storage.cr","line_number":38,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L38"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Filesystem-based storage backend for Sepia objects.\n\nThis is the default storage backend that stores objects on the local filesystem.\nSerializable objects are stored as files, while Container objects are stored as\ndirectories with nested structures.\n\n### Directory Structure\n\nThe storage creates a directory structure like:\n\n```\nstorage_path/\n  â”œâ”€â”€ ClassName1/\n  â”‚   â”œâ”€â”€ object1_id     (Serializable object file)\n  â”‚   â””â”€â”€ object2_id     (Serializable object file)\n  â””â”€â”€ ClassName2/\n      â”œâ”€â”€ container1/    (Container directory)\n      â”‚   â”œâ”€â”€ data.json  (Primitive properties)\n      â”‚   â””â”€â”€ refs/      (Reference files/symlinks)\n      â””â”€â”€ container2/    (Container directory)\n```\n\n### Example\n\n```\n# Configure Sepia to use filesystem storage\nSepia::Storage.configure(:filesystem, {\"path\" => \"./data\"})\n\n# Objects will be stored in ./data/ClassName/sepia_id\n```","summary":"<p>Filesystem-based storage backend for Sepia objects.</p>","constructors":[{"html_id":"new(path:String=Dir.tempdir,watch:Bool|Hash=false)-class-method","name":"new","doc":"Creates a new FileStorage instance.\n\nThe `path` parameter specifies the root directory where objects will be stored.\nIf not provided, uses the system's temporary directory.\n\nThe `watch` parameter enables automatic file system monitoring for external\nchanges. When enabled, the storage will automatically invalidate cache entries\nwhen files are modified externally.\n\n### Parameters\n\n- *path* : Root directory for object storage (default: system temp directory)\n- *watch* : Watcher configuration (default: false - disabled)\n  - `false` : Disable watcher\n  - `true` : Enable watcher with default settings\n  - `Hash` : Custom watcher configuration options\n\n### Examples\n\n```\n# Use system temp directory\nstorage = FileStorage.new\n\n# Use custom directory\nstorage = FileStorage.new(\"./data\")\n\n# Enable watcher with default settings\nstorage = FileStorage.new(\"./data\", watch: true)\n\n# Enable watcher with custom settings\nstorage = FileStorage.new(\"./data\", watch: {\n  recursive: true,\n  latency:   0.1,\n})\n```","summary":"<p>Creates a new FileStorage instance.</p>","abstract":false,"args":[{"name":"path","default_value":"Dir.tempdir","external_name":"path","restriction":"String"},{"name":"watch","default_value":"false","external_name":"watch","restriction":"Bool | Hash"}],"args_string":"(path : String = Dir.tempdir, watch : Bool | Hash = false)","args_html":"(path : String = <span class=\"t\">Dir</span>.tempdir, watch : Bool | Hash = <span class=\"n\">false</span>)","location":{"filename":"src/sepia/file_storage.cr","line_number":133,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L133"},"def":{"name":"new","args":[{"name":"path","default_value":"Dir.tempdir","external_name":"path","restriction":"String"},{"name":"watch","default_value":"false","external_name":"watch","restriction":"Bool | Hash"}],"visibility":"Public","body":"_ = allocate\n_.initialize(path, watch)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"clear-instance-method","name":"clear","doc":"Clears all objects from storage.\n\nRemoves the entire storage directory and recreates it.\nThis permanently deletes all data - use with caution.\n\n```\nstorage.clear # Deletes everything in the storage path\n```","summary":"<p>Clears all objects from storage.</p>","abstract":false,"location":{"filename":"src/sepia/file_storage.cr","line_number":523,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L523"},"def":{"name":"clear","visibility":"Public","body":"if Dir.exists?(@path)\n  FileUtils.rm_rf(@path)\n  FileUtils.mkdir_p(@path)\nend"},"external_var":false},{"html_id":"count(object_class:Class):Int32-instance-method","name":"count","doc":"Returns the count of objects for a given class.\n\nThis is equivalent to `list_all(object_class).size` but may be\nmore efficient in some implementations.\n\n```\ncount = storage.count(MyDocument)\nputs \"Found #{count} documents\"\n```","summary":"<p>Returns the count of objects for a given class.</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"}],"args_string":"(object_class : Class) : Int32","args_html":"(object_class : Class) : Int32","location":{"filename":"src/sepia/file_storage.cr","line_number":511,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L511"},"def":{"name":"count","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"}],"return_type":"Int32","visibility":"Public","body":"(list_all(object_class)).size"},"external_var":false},{"html_id":"delete(class_name:String,id:String)-instance-method","name":"delete","doc":"Deletes an object by class name and ID.\n\nAlternative method to delete objects without loading them first.\nRequires knowing whether the class is a Container or Serializable type.\n\n```\n# Delete without loading the object\nstorage.delete(\"MyDocument\", \"doc-uuid\")\nstorage.delete(\"MyBoard\", \"board-uuid\")\n```","summary":"<p>Deletes an object by class name and ID.</p>","abstract":false,"args":[{"name":"class_name","external_name":"class_name","restriction":"String"},{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(class_name : String, id : String)","args_html":"(class_name : String, id : String)","location":{"filename":"src/sepia/file_storage.cr","line_number":447,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L447"},"def":{"name":"delete","args":[{"name":"class_name","external_name":"class_name","restriction":"String"},{"name":"id","external_name":"id","restriction":"String"}],"visibility":"Public","body":"object_path = File.join(@path, class_name, id)\n\nif Sepia.container?(class_name)\n  if Dir.exists?(object_path)\n    FileUtils.rm_rf(object_path)\n  end\nelsif File.exists?(object_path)\n  File.delete(object_path)\nend\n"},"external_var":false},{"html_id":"delete(object:Serializable|Container)-instance-method","name":"delete","doc":"Deletes an object from the filesystem.\n\nRemoves the object's file or directory. For Container objects, recursively\nremoves the entire directory structure including all nested objects.\n\n```\ndoc = MyDocument.load(\"doc-uuid\")\nstorage.delete(doc) # Removes the file\n\nboard = Board.load(\"board-uuid\")\nstorage.delete(board) # Removes the directory and all contents\n```","summary":"<p>Deletes an object from the filesystem.</p>","abstract":false,"args":[{"name":"object","external_name":"object","restriction":"Serializable | Container"}],"args_string":"(object : Serializable | Container)","args_html":"(object : <a href=\"../Sepia/Serializable.html\">Serializable</a> | <a href=\"../Sepia/Container.html\">Container</a>)","location":{"filename":"src/sepia/file_storage.cr","line_number":423,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L423"},"def":{"name":"delete","args":[{"name":"object","external_name":"object","restriction":"Serializable | Container"}],"visibility":"Public","body":"object_path = File.join(@path, object.class.name, object.sepia_id)\n\nif object.is_a?(Serializable)\n  if File.exists?(object_path)\n    File.delete(object_path)\n  end\nelsif object.is_a?(Container)\n  if Dir.exists?(object_path)\n    FileUtils.rm_rf(object_path)\n  end\nend\n"},"external_var":false},{"html_id":"exists?(object_class:Class,id:String):Bool-instance-method","name":"exists?","doc":"Checks if an object with the given ID exists.\n\nFor Serializable objects, checks if the file exists.\nFor Container objects, checks if the directory exists.\n\n```\nif storage.exists?(MyDocument, \"doc-uuid\")\n  puts \"Document exists\"\nend\n```","summary":"<p>Checks if an object with the given ID exists.</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(object_class : Class, id : String) : Bool","args_html":"(object_class : Class, id : String) : Bool","location":{"filename":"src/sepia/file_storage.cr","line_number":490,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L490"},"def":{"name":"exists?","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"return_type":"Bool","visibility":"Public","body":"object_path = File.join(@path, object_class.to_s, id)\n\nif object_class < Serializable\n  File.exists?(object_path)\nelsif object_class < Container\n  File.directory?(object_path)\nelse\n  false\nend\n"},"external_var":false},{"html_id":"export_data:Hash(String,Array(Hash(String,String)))-instance-method","name":"export_data","doc":"Exports all data as a portable hash structure.\n\nReturns a hash where keys are class names and values are arrays of\nobject data. Each object includes its ID and either its content\n(for Serializable objects) or a container type marker.\n\nUseful for backing up or migrating data between storage backends.\n\n```\ndata = storage.export_data\n# data = {\n#   \"MyDocument\" => [\n#     {\"id\" => \"doc1\", \"content\" => \"Hello\"},\n#     {\"id\" => \"doc2\", \"content\" => \"World\"}\n#   ],\n#   \"MyBoard\" => [\n#     {\"id\" => \"board1\", \"type\" => \"container\"}\n#   ]\n# }\n```","summary":"<p>Exports all data as a portable hash structure.</p>","abstract":false,"location":{"filename":"src/sepia/file_storage.cr","line_number":550,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L550"},"def":{"name":"export_data","return_type":"Hash(String, Array(Hash(String, String)))","visibility":"Public","body":"data = {} of String => Array(Hash(String, String))\n\nif Dir.exists?(@path)\nelse\n  return data\nend\n\nDir.each_child(@path) do |class_name|\n  class_dir = File.join(@path, class_name)\n  if File.directory?(class_dir)\n  else\n    next\n  end\n\n  data[class_name] = [] of Hash(String, String)\n\n  Dir.each_child(class_dir) do |id|\n    object_path = File.join(class_dir, id)\n\n    if File.file?(object_path)\n      data[class_name] << {\"id\" => id, \"content\" => File.read(object_path)}\n    elsif File.directory?(object_path)\n      data[class_name] << {\"id\" => id, \"type\" => \"container\"}\n    end\n  end\nend\n\ndata\n"},"external_var":false},{"html_id":"import_data(data:Hash(String,Array(Hash(String,String))))-instance-method","name":"import_data","doc":"Imports data from an exported hash structure.\n\nRestores objects from the data structure created by `export_data`.\nClears any existing data before importing.\n\nUseful for restoring backups or migrating from another storage backend.\n\n```\ndata = {\n  \"MyDocument\" => [\n    {\"id\" => \"doc1\", \"content\" => \"Hello\"},\n  ],\n}\nstorage.import_data(data)\n```","summary":"<p>Imports data from an exported hash structure.</p>","abstract":false,"args":[{"name":"data","external_name":"data","restriction":"Hash(String, Array(Hash(String, String)))"}],"args_string":"(data : Hash(String, Array(Hash(String, String))))","args_html":"(data : Hash(String, Array(Hash(String, String))))","location":{"filename":"src/sepia/file_storage.cr","line_number":598,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L598"},"def":{"name":"import_data","args":[{"name":"data","external_name":"data","restriction":"Hash(String, Array(Hash(String, String)))"}],"visibility":"Public","body":"clear\n\ndata.each do |class_name, objects|\n  class_dir = File.join(@path, class_name)\n  FileUtils.mkdir_p(class_dir)\n\n  objects.each do |obj_data|\n    object_path = File.join(class_dir, obj_data[\"id\"])\n\n    if obj_data.has_key?(\"content\")\n      File.write(object_path, obj_data[\"content\"])\n    elsif obj_data[\"type\"]? == \"container\"\n      FileUtils.mkdir_p(object_path)\n    end\n  end\nend\n"},"external_var":false},{"html_id":"list_all(object_class:Class):Array(String)-instance-method","name":"list_all","doc":"Lists all object IDs for a given class.\n\nReturns an array of all object IDs found in the class directory.\nThe IDs are sorted alphabetically.\n\n```\nids = storage.list_all(MyDocument)\nids # => [\"doc-uuid1\", \"doc-uuid2\", \"doc-uuid3\"]\n```","summary":"<p>Lists all object IDs for a given class.</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"}],"args_string":"(object_class : Class) : Array(String)","args_html":"(object_class : Class) : Array(String)","location":{"filename":"src/sepia/file_storage.cr","line_number":470,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L470"},"def":{"name":"list_all","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"}],"return_type":"Array(String)","visibility":"Public","body":"class_dir = File.join(@path, object_class.to_s)\nif Dir.exists?(class_dir)\nelse\n  return [] of String\nend\n\n(Dir.entries(class_dir))\n  .reject do |e| (e == \".\") || (e == \"..\") end\n  .select do |e| (File.file?(File.join(class_dir, e))) || (File.directory?(File.join(class_dir, e))) end\n  .sort!\n"},"external_var":false},{"html_id":"list_all_objects:Hash(String,Array(String))-instance-method","name":"list_all_objects","doc":"Lists all objects grouped by class name.\n\nReturns a hash where keys are class names and values are arrays of\nobject IDs for that class. This provides a complete inventory of\nall objects in storage.\n\nUseful for administrative purposes, data migration, or debugging.\n\n```\nall_objects = storage.list_all_objects\n# all_objects = {\n#   \"MyDocument\" => [\"doc1\", \"doc2\"],\n#   \"MyBoard\" => [\"board1\"],\n#   \"User\" => [\"user1\", \"user2\", \"user3\"]\n# }\n```","summary":"<p>Lists all objects grouped by class name.</p>","abstract":false,"location":{"filename":"src/sepia/file_storage.cr","line_number":635,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L635"},"def":{"name":"list_all_objects","return_type":"Hash(String, Array(String))","visibility":"Public","body":"objects = Hash(String, Array(String)).new do |hash, key| hash[key] = [] of String end\nif Dir.exists?(@path)\nelse\n  return objects\nend\n\nDir.each_child(@path) do |class_name|\n  class_dir = File.join(@path, class_name)\n  if File.directory?(class_dir)\n  else\n    next\n  end\n\n  Dir.each_child(class_dir) do |id|\n    objects[class_name] << id\n  end\nend\nobjects\n"},"external_var":false},{"html_id":"load(object_class:Class,id:String,path:String|Nil=nil):Object-instance-method","name":"load","doc":"Loads an object from the filesystem.\n\nDeserializes an object of the specified class with the given ID.\nFor Serializable objects, reads the file content and uses the class's\n`from_sepia` method. For Container objects, reconstructs the object\nfrom its directory structure.\n\nRaises an exception if the object is not found.\n\n```\n# Load a Serializable object\ndoc = storage.load(MyDocument, \"doc-uuid\")\n\n# Load a Container object\nboard = storage.load(MyBoard, \"board-uuid\")\n```","summary":"<p>Loads an object from the filesystem.</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"args_string":"(object_class : Class, id : String, path : String | Nil = nil) : Object","args_html":"(object_class : Class, id : String, path : String | Nil = <span class=\"n\">nil</span>) : <a href=\"../Sepia/Object.html\">Object</a>","location":{"filename":"src/sepia/file_storage.cr","line_number":335,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L335"},"def":{"name":"load","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"return_type":"Object","visibility":"Public","body":"object_path = path || (File.join(@path, object_class.to_s, id))\n\ncase\nwhen object_class.responds_to?(:from_sepia)\n  if File.exists?(object_path)\n  else\n    raise(\"Object with ID #{id} not found in storage for type #{object_class}.\")\n  end\n  obj = object_class.from_sepia(File.read(object_path))\n  obj.sepia_id = id\n  obj\nwhen object_class < Container\n  if File.directory?(object_path)\n  else\n    raise(\"Object with ID #{id} not found in storage for type #{object_class} (directory missing).\")\n  end\n  obj = object_class.new\n  obj.sepia_id = id\n  (obj.as(Container)).load_references(object_path)\n  obj\nelse\n  raise(\"Unsupported class for Sepia storage: #{object_class.name}. Must include Sepia::Serializable or Sepia::Container.\")\nend\n"},"external_var":false},{"html_id":"load_with_cache(object_class:Class,id:String,path:String|Nil=nil):Object-instance-method","name":"load_with_cache","doc":"Loads an object with caching support.\n\nSimilar to the regular `load` method but integrates with the storage\ncaching system for better performance when loading the same objects\nmultiple times.\n\n### Parameters\n\n- *object_class* : The class of object to load\n- *id* : The object's unique identifier\n- *path* : Optional custom load path\n\n### Returns\n\nThe loaded object.\n\n### Example\n\n```\n# Load with caching (faster for repeated loads)\ndoc1 = storage.load_with_cache(MyDocument, \"doc-123\")\ndoc2 = storage.load_with_cache(MyDocument, \"doc-123\") # Returns cached instance\n```","summary":"<p>Loads an object with caching support.</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"args_string":"(object_class : Class, id : String, path : String | Nil = nil) : Object","args_html":"(object_class : Class, id : String, path : String | Nil = <span class=\"n\">nil</span>) : <a href=\"../Sepia/Object.html\">Object</a>","location":{"filename":"src/sepia/file_storage.cr","line_number":382,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L382"},"def":{"name":"load_with_cache","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"return_type":"Object","visibility":"Public","body":"object_path = path || (File.join(@path, object_class.to_s, id))\n\ncase\nwhen object_class.responds_to?(:from_sepia)\n  if File.exists?(object_path)\n  else\n    raise(\"Object with ID #{id} not found in storage for type #{object_class}.\")\n  end\n\n\n  content = File.read(object_path)\n  obj = object_class.from_sepia(content)\n  obj.sepia_id = id\n  obj\nwhen object_class < Container\n  if File.directory?(object_path)\n  else\n    raise(\"Object with ID #{id} not found in storage for type #{object_class} (directory missing).\")\n  end\n\n\n  obj = object_class.new\n  obj.sepia_id = id\n  (obj.as(Container)).load_references(object_path)\n  obj\nelse\n  raise(\"Unsupported class for Sepia storage: #{object_class.name}. Must include Sepia::Serializable or Sepia::Container.\")\nend\n"},"external_var":false},{"html_id":"on_watcher_change(&block:Event->)-instance-method","name":"on_watcher_change","doc":"Registers a callback to be called when external file changes are detected.\n\nThis allows users to add custom logic in addition to automatic cache invalidation.\n\n### Parameters\n\n- *&block* : Callback block that receives Event objects\n\n### Example\n\n```\nstorage.on_watcher_change do |event|\n  puts \"External change: #{event.type} #{event.object_class}:#{event.object_id}\"\nend\n```","summary":"<p>Registers a callback to be called when external file changes are detected.</p>","abstract":false,"location":{"filename":"src/sepia/file_storage.cr","line_number":252,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L252"},"def":{"name":"on_watcher_change","yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(Event ->)"},"visibility":"Public","body":"if @watcher\nelse\n  return\nend\n@watcher.not_nil!.on_change(&block)\n"},"external_var":false},{"html_id":"path:String-instance-method","name":"path","doc":"Root directory path where objects are stored.\n\nDefault is the system's temporary directory. Can be set to any absolute path.\n\n```\nstorage = FileStorage.new\nstorage.path # => \"/tmp\"\n\n# Custom path\nstorage = FileStorage.new(\"./my_data\")\nstorage.path # => \"./my_data\"\n```","summary":"<p>Root directory path where objects are stored.</p>","abstract":false,"location":{"filename":"src/sepia/file_storage.cr","line_number":51,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L51"},"def":{"name":"path","return_type":"String","visibility":"Public","body":"@path"},"external_var":false},{"html_id":"path=(path:String)-instance-method","name":"path=","doc":"Root directory path where objects are stored.\n\nDefault is the system's temporary directory. Can be set to any absolute path.\n\n```\nstorage = FileStorage.new\nstorage.path # => \"/tmp\"\n\n# Custom path\nstorage = FileStorage.new(\"./my_data\")\nstorage.path # => \"./my_data\"\n```","summary":"<p>Root directory path where objects are stored.</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String)","args_html":"(path : String)","location":{"filename":"src/sepia/file_storage.cr","line_number":51,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L51"},"def":{"name":"path=","args":[{"name":"path","external_name":"path","restriction":"String"}],"visibility":"Public","body":"@path = path"},"external_var":false},{"html_id":"save(object:Serializable,path:String|Nil=nil)-instance-method","name":"save","doc":"Saves a Serializable object to the filesystem.\n\nWrites the object's serialized content to a file. Creates any necessary\nparent directories. Uses atomic write operations to prevent corruption.\n\nThe object is saved to `path/class_name/sepia_id` if no specific path is provided.\n\n### Atomic Writes\n\nThe file is first written to a temporary file (with .tmp extension),\nthen atomically renamed to the final path. This prevents partial writes\nand ensures data integrity.\n\n```\ndoc = MyDocument.new(\"Hello\")\nstorage = FileStorage.new(\"./data\")\nstorage.save(doc) # Creates ./data/MyDocument/uuid\n```","summary":"<p>Saves a Serializable object to the filesystem.</p>","abstract":false,"args":[{"name":"object","external_name":"object","restriction":"Serializable"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"args_string":"(object : Serializable, path : String | Nil = nil)","args_html":"(object : <a href=\"../Sepia/Serializable.html\">Serializable</a>, path : String | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/sepia/file_storage.cr","line_number":275,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L275"},"def":{"name":"save","args":[{"name":"object","external_name":"object","restriction":"Serializable"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"visibility":"Public","body":"object_path = path || (File.join(@path, object.class.name, object.sepia_id))\nobject_dir = File.dirname(object_path)\nif File.exists?(object_dir)\nelse\n  FileUtils.mkdir_p(object_dir)\nend\n\n\ntemp_path = \"#{object_path}.tmp\"\n\n\nWatcher.add_internal_file(temp_path)\nWatcher.add_internal_file(object_path)\n\nbegin\n  File.write(temp_path, object.to_sepia)\n  File.rename(temp_path, object_path)\n\n\n  spawn do\n    sleep(0.3.seconds)\n    Watcher.remove_internal_file(object_path)\n  end\nensure\n  Watcher.remove_internal_file(temp_path)\nend\n"},"external_var":false},{"html_id":"save(object:Container,path:String|Nil=nil)-instance-method","name":"save","doc":"Saves a Container object to the filesystem.\n\nCreates a directory for the container and saves all nested objects and\nreferences. The container's primitive properties are saved to a data.json file,\nwhile nested Sepia objects are saved as files or symlinks.\n\n```\nboard = Board.new(\"My Board\")\nstorage = FileStorage.new(\"./data\")\nstorage.save(board) # Creates ./data/Board/uuid/\n```","summary":"<p>Saves a Container object to the filesystem.</p>","abstract":false,"args":[{"name":"object","external_name":"object","restriction":"Container"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"args_string":"(object : Container, path : String | Nil = nil)","args_html":"(object : <a href=\"../Sepia/Container.html\">Container</a>, path : String | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/sepia/file_storage.cr","line_number":313,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L313"},"def":{"name":"save","args":[{"name":"object","external_name":"object","restriction":"Container"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"visibility":"Public","body":"object_path = path || (File.join(@path, object.class.name, object.sepia_id))\nFileUtils.mkdir_p(object_path)\nobject.save_references(object_path)\n"},"external_var":false},{"html_id":"start_watcher:Bool-instance-method","name":"start_watcher","doc":"Starts the file system watcher if it's not already running.\n\n### Returns\n\n`true` if watcher was started, `false` if already running or not configured\n\n### Example\n\n```\nstorage.start_watcher\nputs \"Watcher running: #{storage.watcher_running?}\"\n```","summary":"<p>Starts the file system watcher if it's not already running.</p>","abstract":false,"location":{"filename":"src/sepia/file_storage.cr","line_number":188,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L188"},"def":{"name":"start_watcher","return_type":"Bool","visibility":"Public","body":"if @watcher_config.enabled\nelse\n  return false\nend\nif @watcher && @watcher.not_nil!.running?\n  return true\nend\n\nsetup_watcher\n(@watcher && @watcher.not_nil!.running?) || false\n"},"external_var":false},{"html_id":"stop_watcher:Bool-instance-method","name":"stop_watcher","doc":"Stops the file system watcher if it's running.\n\n### Returns\n\n`true` if watcher was stopped, `false` if not running\n\n### Example\n\n```\nstorage.stop_watcher\nputs \"Watcher running: #{storage.watcher_running?}\"\n```","summary":"<p>Stops the file system watcher if it's running.</p>","abstract":false,"location":{"filename":"src/sepia/file_storage.cr","line_number":208,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L208"},"def":{"name":"stop_watcher","return_type":"Bool","visibility":"Public","body":"if @watcher\nelse\n  return false\nend\n\nbegin\n  @watcher.not_nil!.stop\n  true\nrescue ex\n  puts(\"Warning: Could not cleanly stop file watcher: #{ex.message}\")\n  false\nend\n"},"external_var":false},{"html_id":"watcher:Watcher|Nil-instance-method","name":"watcher","abstract":false,"location":{"filename":"src/sepia/file_storage.cr","line_number":83,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L83"},"def":{"name":"watcher","return_type":"Watcher | ::Nil","visibility":"Public","body":"@watcher"},"external_var":false},{"html_id":"watcher_enabled?:Bool-instance-method","name":"watcher_enabled?","doc":"Configuration for watcher creation.\n\nStores the watcher configuration for later use or recreation.\n\n```\nstorage = FileStorage.new(\"./data\", watch: true)\nstorage.watcher_enabled? # => true\n```","summary":"<p>Configuration for watcher creation.</p>","abstract":false,"location":{"filename":"src/sepia/file_storage.cr","line_number":94,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L94"},"def":{"name":"watcher_enabled?","return_type":"Bool","visibility":"Public","body":"@watcher_config.enabled"},"external_var":false},{"html_id":"watcher_running?:Bool-instance-method","name":"watcher_running?","doc":"Checks if the file system watcher is currently running.\n\n### Returns\n\n`true` if watcher is running, `false` otherwise\n\n### Example\n\n```\nstorage = FileStorage.new(\"./data\", watch: true)\nputs storage.watcher_running? # => true\n```","summary":"<p>Checks if the file system watcher is currently running.</p>","abstract":false,"location":{"filename":"src/sepia/file_storage.cr","line_number":233,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L233"},"def":{"name":"watcher_running?","return_type":"Bool","visibility":"Public","body":"(@watcher && @watcher.not_nil!.running?) || false"},"external_var":false}],"types":[{"html_id":"Sepia/Sepia/FileStorage/WatcherConfig","path":"Sepia/FileStorage/WatcherConfig.html","kind":"class","full_name":"Sepia::FileStorage::WatcherConfig","name":"WatcherConfig","abstract":false,"superclass":{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/file_storage.cr","line_number":63,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L63"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia/FileStorage","kind":"class","full_name":"Sepia::FileStorage","name":"FileStorage"},"doc":"File system watcher for external change detection.\n\nAutomatically monitors the storage directory for external changes\nand invalidates cache entries when files are modified.\n\n```\nstorage = FileStorage.new(\"./data\", watch: true)\nstorage.watcher_running? # => true\n```\nSimple configuration class for file system watcher","summary":"<p>File system watcher for external change detection.</p>","class_methods":[{"html_id":"from(config:Bool|Hash)-class-method","name":"from","abstract":false,"args":[{"name":"config","external_name":"config","restriction":"Bool | Hash"}],"args_string":"(config : Bool | Hash)","args_html":"(config : Bool | Hash)","location":{"filename":"src/sepia/file_storage.cr","line_number":71,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L71"},"def":{"name":"from","args":[{"name":"config","external_name":"config","restriction":"Bool | Hash"}],"visibility":"Public","body":"if config.is_a?(Bool)\n  new(config)\nelse\n  instance = new(true)\n  instance.recursive = (config[\"recursive\"]?.as(Bool)) || true\n  instance.latency = (config[\"latency\"]?.as(Float64)) || 0.1\n  instance\nend"},"external_var":false}],"constructors":[{"html_id":"new(enabled:Bool)-class-method","name":"new","abstract":false,"args":[{"name":"enabled","external_name":"enabled","restriction":"Bool"}],"args_string":"(enabled : Bool)","args_html":"(enabled : Bool)","location":{"filename":"src/sepia/file_storage.cr","line_number":68,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L68"},"def":{"name":"new","args":[{"name":"enabled","external_name":"enabled","restriction":"Bool"}],"visibility":"Public","body":"_ = allocate\n_.initialize(enabled)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"enabled:Bool-instance-method","name":"enabled","abstract":false,"location":{"filename":"src/sepia/file_storage.cr","line_number":64,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L64"},"def":{"name":"enabled","return_type":"Bool","visibility":"Public","body":"@enabled"},"external_var":false},{"html_id":"enabled=(enabled:Bool)-instance-method","name":"enabled=","abstract":false,"args":[{"name":"enabled","external_name":"enabled","restriction":"Bool"}],"args_string":"(enabled : Bool)","args_html":"(enabled : Bool)","location":{"filename":"src/sepia/file_storage.cr","line_number":64,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L64"},"def":{"name":"enabled=","args":[{"name":"enabled","external_name":"enabled","restriction":"Bool"}],"visibility":"Public","body":"@enabled = enabled"},"external_var":false},{"html_id":"latency:Float64-instance-method","name":"latency","abstract":false,"location":{"filename":"src/sepia/file_storage.cr","line_number":66,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L66"},"def":{"name":"latency","return_type":"Float64","visibility":"Public","body":"@latency"},"external_var":false},{"html_id":"latency=(latency:Float64)-instance-method","name":"latency=","abstract":false,"args":[{"name":"latency","external_name":"latency","restriction":"Float64"}],"args_string":"(latency : Float64)","args_html":"(latency : Float64)","location":{"filename":"src/sepia/file_storage.cr","line_number":66,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L66"},"def":{"name":"latency=","args":[{"name":"latency","external_name":"latency","restriction":"Float64"}],"visibility":"Public","body":"@latency = latency"},"external_var":false},{"html_id":"recursive:Bool-instance-method","name":"recursive","abstract":false,"location":{"filename":"src/sepia/file_storage.cr","line_number":65,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L65"},"def":{"name":"recursive","return_type":"Bool","visibility":"Public","body":"@recursive"},"external_var":false},{"html_id":"recursive=(recursive:Bool)-instance-method","name":"recursive=","abstract":false,"args":[{"name":"recursive","external_name":"recursive","restriction":"Bool"}],"args_string":"(recursive : Bool)","args_html":"(recursive : Bool)","location":{"filename":"src/sepia/file_storage.cr","line_number":65,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/file_storage.cr#L65"},"def":{"name":"recursive=","args":[{"name":"recursive","external_name":"recursive","restriction":"Bool"}],"visibility":"Public","body":"@recursive = recursive"},"external_var":false}]}]},{"html_id":"Sepia/Sepia/GenerationInfo","path":"Sepia/GenerationInfo.html","kind":"module","full_name":"Sepia::GenerationInfo","name":"GenerationInfo","abstract":false,"locations":[{"filename":"src/sepia/generation_info.cr","line_number":39,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/generation_info.cr#L39"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Module that adds generation tracking information to JSON serialization.\n\nInclude this module in your Serializable classes to automatically\ninclude generation metadata (`_generation` and `_base_id`) in the\nserialized JSON output. This is useful for:\n\n- Auditing: Track which version of an object was exported\n- Migration: Identify objects that need version updates\n- Debugging: See generation information in serialized data\n\n### Example\n\n```\nclass VersionedDocument < Sepia::Object\n  include Sepia::Serializable\n  include Sepia::GenerationInfo\n\n  property content : String\n\n  def initialize(@content = \"\")\n  end\n\n  def to_sepia : String\n    {content: @content}.to_json\n  end\n\n  def self.from_sepia(json : String) : self\n    data = JSON.parse(json)\n    new(data[\"content\"].as_s)\n  end\nend\n\ndoc = VersionedDocument.new(\"Hello\")\ndoc.sepia_id = \"doc-123.2\"\njson = doc.to_sepia\n# json includes: {\"content\":\"Hello\",\"_generation\":2,\"_base_id\":\"doc-123\"}\n```","summary":"<p>Module that adds generation tracking information to JSON serialization.</p>","class_methods":[{"html_id":"from_sepia_with_generation(sepia_string:String,&)-class-method","name":"from_sepia_with_generation","doc":"Helper method for deserializing objects with generation metadata.\n\nThis method processes JSON that may contain generation information\nfrom previous serialization. It removes the generation metadata\nbefore passing the cleaned JSON to the original `from_sepia` method.\n\n### Parameters\n\n- *sepia_string* : The JSON string potentially containing generation metadata\n- *&block* : A block that calls the original `from_sepia` method\n\n### Example Usage\n\n```\ndef self.from_sepia(json : String) : self\n  GenerationInfo.from_sepia_with_generation(json) do |clean_json|\n    # clean_json has _generation and _base_id removed\n    # Parse and create object normally\n    data = JSON.parse(clean_json)\n    new(data[\"content\"].as_s)\n  end\nend\n```","summary":"<p>Helper method for deserializing objects with generation metadata.</p>","abstract":false,"args":[{"name":"sepia_string","external_name":"sepia_string","restriction":"String"}],"args_string":"(sepia_string : String, &)","args_html":"(sepia_string : String, &)","location":{"filename":"src/sepia/generation_info.cr","line_number":84,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/generation_info.cr#L84"},"def":{"name":"from_sepia_with_generation","args":[{"name":"sepia_string","external_name":"sepia_string","restriction":"String"}],"yields":1,"block_arity":1,"visibility":"Public","body":"data = JSON.parse(sepia_string)\n\n\nif data.has_key?(\"_generation\")\n  data.delete(\"_generation\")\nend\nif data.has_key?(\"_base_id\")\n  data.delete(\"_base_id\")\nend\n\n\nyield data.to_json\n"},"external_var":false}],"instance_methods":[{"html_id":"to_sepia:String-instance-method","name":"to_sepia","doc":"Enhanced serialization method that includes generation metadata.\n\nParses the original JSON from the class's `to_sepia` method,\nadds `_generation` and `_base_id` fields, and returns the\naugmented JSON string.\n\nThe generation metadata helps track:\n- `_generation`: The version number of this object\n- `_base_id`: The base identifier without generation suffix\n\n```\n# When called on an object with ID \"note-123.2\"\nobj.to_sepia # Returns JSON with _generation: 2, _base_id: \"note-123\"\n```","summary":"<p>Enhanced serialization method that includes generation metadata.</p>","abstract":false,"location":{"filename":"src/sepia/generation_info.cr","line_number":54,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/generation_info.cr#L54"},"def":{"name":"to_sepia","return_type":"String","visibility":"Public","body":"data = JSON.parse(super())\ndata[\"_generation\"] = generation\ndata[\"_base_id\"] = base_id\ndata.to_json\n"},"external_var":false}]},{"html_id":"Sepia/Sepia/InMemoryStorage","path":"Sepia/InMemoryStorage.html","kind":"class","full_name":"Sepia::InMemoryStorage","name":"InMemoryStorage","abstract":false,"superclass":{"html_id":"Sepia/Sepia/StorageBackend","kind":"class","full_name":"Sepia::StorageBackend","name":"StorageBackend"},"ancestors":[{"html_id":"Sepia/Sepia/StorageBackend","kind":"class","full_name":"Sepia::StorageBackend","name":"StorageBackend"},{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/in_memory_storage.cr","line_number":30,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L30"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"In-memory storage backend for Sepia objects.\n\nThis backend stores all data in memory hashes without any filesystem\noperations. It's primarily useful for:\n\n- Testing: Fast operations without disk I/O\n- Demos: Self-contained examples that don't persist data\n- Temporary data: Caching or session storage\n\n### Data Structure\n\nThe storage uses three main hashes:\n- `@serializable_storage`: Maps class_name/id to serialized content\n- `@container_storage`: Maps class_name/id to property data and references\n- `@container_references`: Maps container paths to reference mappings\n\n### Example\n\n```\n# Configure Sepia to use in-memory storage\nSepia::Storage.configure(:memory)\n\n# Objects will be stored in memory only\ndoc = MyDocument.new(\"Hello\")\ndoc.save # Stored in @serializable_storage\n```","summary":"<p>In-memory storage backend for Sepia objects.</p>","instance_methods":[{"html_id":"clear-instance-method","name":"clear","doc":"Clears all data from memory storage.\n\nEmpties all internal hashes, effectively resetting the storage\nto its initial empty state.\n\n```\nstorage.clear # All data is now gone\n```","summary":"<p>Clears all data from memory storage.</p>","abstract":false,"location":{"filename":"src/sepia/in_memory_storage.cr","line_number":231,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L231"},"def":{"name":"clear","visibility":"Public","body":"@serializable_storage.clear\n@container_storage.clear\n@container_references.clear\n"},"external_var":false},{"html_id":"count(object_class:Class):Int32-instance-method","name":"count","doc":"Count objects of a given class","summary":"<p>Count objects of a given class</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"}],"args_string":"(object_class : Class) : Int32","args_html":"(object_class : Class) : Int32","location":{"filename":"src/sepia/in_memory_storage.cr","line_number":219,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L219"},"def":{"name":"count","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"}],"return_type":"Int32","visibility":"Public","body":"(list_all(object_class)).size"},"external_var":false},{"html_id":"delete(class_name:String,id:String)-instance-method","name":"delete","doc":"Delete an object by its class name and ID","summary":"<p>Delete an object by its class name and ID</p>","abstract":false,"args":[{"name":"class_name","external_name":"class_name","restriction":"String"},{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(class_name : String, id : String)","args_html":"(class_name : String, id : String)","location":{"filename":"src/sepia/in_memory_storage.cr","line_number":173,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L173"},"def":{"name":"delete","args":[{"name":"class_name","external_name":"class_name","restriction":"String"},{"name":"id","external_name":"id","restriction":"String"}],"visibility":"Public","body":"if Sepia.container?(class_name)\n  object_key = \"#{class_name}/#{id}\"\n  @container_storage.delete(object_key)\nelse\n  object_path = File.join(@path, class_name, id)\n  @serializable_storage.delete(object_path)\nend"},"external_var":false},{"html_id":"delete(object:Serializable|Container)-instance-method","name":"delete","doc":"Delete an object","summary":"<p>Delete an object</p>","abstract":false,"args":[{"name":"object","external_name":"object","restriction":"Serializable | Container"}],"args_string":"(object : Serializable | Container)","args_html":"(object : <a href=\"../Sepia/Serializable.html\">Serializable</a> | <a href=\"../Sepia/Container.html\">Container</a>)","location":{"filename":"src/sepia/in_memory_storage.cr","line_number":159,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L159"},"def":{"name":"delete","args":[{"name":"object","external_name":"object","restriction":"Serializable | Container"}],"visibility":"Public","body":"object_key = \"#{object.class.name}/#{object.sepia_id}\"\n\nif object.is_a?(Serializable)\n  @serializable_storage.delete(object_key)\nelsif object.is_a?(Container)\n  @container_storage.delete(object_key)\n\n  @container_references.each do |_path, refs|\n    refs.reject! do |_, target| target.starts_with?(object_key) end\n  end\nend\n"},"external_var":false},{"html_id":"exists?(object_class:Class,id:String):Bool-instance-method","name":"exists?","doc":"Check if an object exists","summary":"<p>Check if an object exists</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(object_class : Class, id : String) : Bool","args_html":"(object_class : Class, id : String) : Bool","location":{"filename":"src/sepia/in_memory_storage.cr","line_number":207,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L207"},"def":{"name":"exists?","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"return_type":"Bool","visibility":"Public","body":"if object_class < Serializable\n  canonical_path = File.join(@path, object_class.to_s, id)\n  @serializable_storage.has_key?(canonical_path)\nelsif object_class < Container\n  object_key = \"#{object_class}/#{id}\"\n  @container_storage.has_key?(object_key)\nelse\n  false\nend"},"external_var":false},{"html_id":"export_data:Hash(String,Array(Hash(String,String)))-instance-method","name":"export_data","doc":"Export all data as a hash structure","summary":"<p>Export all data as a hash structure</p>","abstract":false,"location":{"filename":"src/sepia/in_memory_storage.cr","line_number":237,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L237"},"def":{"name":"export_data","return_type":"Hash(String, Array(Hash(String, String)))","visibility":"Public","body":"data = {} of String => Array(Hash(String, String))\n\n\n@serializable_storage.each do |key, content|\n\n  if key.starts_with?(@path)\n    relative_path = key[(@path.size + 1)..-1]\n    parts = relative_path.split('/')\n    if parts.size == 2\n      class_name, id = parts\n      __temp_25c21543_1 = class_name\n      data[__temp_25c21543_1]? || (data[__temp_25c21543_1] = [] of Hash(String, String))\n      data[class_name] << {\"id\" => id, \"content\" => content}\n    end\n  end\nend\n\n\n@container_storage.each do |key, _|\n  class_name, id = key.split('/', 2)\n  __temp_25c21543_3 = class_name\n  data[__temp_25c21543_3]? || (data[__temp_25c21543_3] = [] of Hash(String, String))\n  data[class_name] << {\"id\" => id, \"type\" => \"container\"}\nend\n\ndata\n"},"external_var":false},{"html_id":"get_container_references(container_path:String):Hash(String,String)-instance-method","name":"get_container_references","abstract":false,"args":[{"name":"container_path","external_name":"container_path","restriction":"String"}],"args_string":"(container_path : String) : Hash(String, String)","args_html":"(container_path : String) : Hash(String, String)","location":{"filename":"src/sepia/in_memory_storage.cr","line_number":302,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L302"},"def":{"name":"get_container_references","args":[{"name":"container_path","external_name":"container_path","restriction":"String"}],"return_type":"Hash(String, String)","visibility":"Public","body":"@container_references[container_path] || ({} of String => String)"},"external_var":false},{"html_id":"get_reference(container_path:String,ref_name:String):String|Nil-instance-method","name":"get_reference","abstract":false,"args":[{"name":"container_path","external_name":"container_path","restriction":"String"},{"name":"ref_name","external_name":"ref_name","restriction":"String"}],"args_string":"(container_path : String, ref_name : String) : String | Nil","args_html":"(container_path : String, ref_name : String) : String | Nil","location":{"filename":"src/sepia/in_memory_storage.cr","line_number":291,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L291"},"def":{"name":"get_reference","args":[{"name":"container_path","external_name":"container_path","restriction":"String"},{"name":"ref_name","external_name":"ref_name","restriction":"String"}],"return_type":"String | ::Nil","visibility":"Public","body":"if refs = @container_references[container_path]?\n  refs[ref_name]?\nend"},"external_var":false},{"html_id":"import_data(data:Hash(String,Array(Hash(String,String))))-instance-method","name":"import_data","doc":"Import data from a hash structure","summary":"<p>Import data from a hash structure</p>","abstract":false,"args":[{"name":"data","external_name":"data","restriction":"Hash(String, Array(Hash(String, String)))"}],"args_string":"(data : Hash(String, Array(Hash(String, String))))","args_html":"(data : Hash(String, Array(Hash(String, String))))","location":{"filename":"src/sepia/in_memory_storage.cr","line_number":264,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L264"},"def":{"name":"import_data","args":[{"name":"data","external_name":"data","restriction":"Hash(String, Array(Hash(String, String)))"}],"visibility":"Public","body":"clear\n\ndata.each do |class_name, objects|\n  objects.each do |obj_data|\n    if obj_data.has_key?(\"content\")\n      id = obj_data[\"id\"]\n\n      key = File.join(@path, class_name, id)\n      @serializable_storage[key] = obj_data[\"content\"]\n    elsif obj_data[\"type\"]? == \"container\"\n      id = obj_data[\"id\"]\n      key = \"#{class_name}/#{id}\"\n      @container_storage[key] = {\"_type\" => \"container\"}\n    end\n  end\nend\n"},"external_var":false},{"html_id":"list_all(object_class:Class):Array(String)-instance-method","name":"list_all","doc":"List all object IDs of a given class","summary":"<p>List all object IDs of a given class</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"}],"args_string":"(object_class : Class) : Array(String)","args_html":"(object_class : Class) : Array(String)","location":{"filename":"src/sepia/in_memory_storage.cr","line_number":183,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L183"},"def":{"name":"list_all","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"}],"return_type":"Array(String)","visibility":"Public","body":"class_name = object_class.to_s\nids = [] of String\n\nif object_class < Serializable\n  @serializable_storage.each_key do |key|\n\n    canonical_path = File.join(@path, class_name)\n    if key.starts_with?(\"#{canonical_path}/\")\n      id = File.basename(key)\n      ids << id\n    end\n  end\nelsif object_class < Container\n  @container_storage.each_key do |key|\n    if key.starts_with?(\"#{class_name}/\")\n      ids << (key.split('/', 2))[1]\n    end\n  end\nend\n\nids.sort\n"},"external_var":false},{"html_id":"list_all_objects:Hash(String,Array(String))-instance-method","name":"list_all_objects","doc":"List all objects, grouped by class name","summary":"<p>List all objects, grouped by class name</p>","abstract":false,"location":{"filename":"src/sepia/in_memory_storage.cr","line_number":306,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L306"},"def":{"name":"list_all_objects","return_type":"Hash(String, Array(String))","visibility":"Public","body":"objects = Hash(String, Array(String)).new do |hash, key| hash[key] = [] of String end\nprefix = @path + \"/\"\n\n@serializable_storage.each_key do |key|\n  if key.starts_with?(prefix)\n    class_and_id = key[prefix.size..-1]\n    parts = class_and_id.split('/')\n    if parts.size == 2\n      class_name, id = parts\n      objects[class_name] << id\n    end\n  end\nend\n\n@container_storage.each_key do |key|\n\n  class_name, id = key.split('/', 2)\n  objects[class_name] << id\nend\n\nobjects\n"},"external_var":false},{"html_id":"load(object_class:Class,id:String,path:String|Nil=nil):Object-instance-method","name":"load","doc":"Loads an object from memory storage.\n\nRetrieves and deserializes an object of the specified class.\nFor Serializable objects, uses the class's `from_sepia` method.\nFor Container objects, restores primitive properties from JSON and\nloads references if a path is provided.\n\nRaises an exception if the object is not found.\n\n```\n# Load a Serializable object\ndoc = storage.load(MyDocument, \"doc-uuid\")\n\n# Load a Container object\nboard = storage.load(MyBoard, \"board-uuid\")\n```","summary":"<p>Loads an object from memory storage.</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"args_string":"(object_class : Class, id : String, path : String | Nil = nil) : Object","args_html":"(object_class : Class, id : String, path : String | Nil = <span class=\"n\">nil</span>) : <a href=\"../Sepia/Object.html\">Object</a>","location":{"filename":"src/sepia/in_memory_storage.cr","line_number":117,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L117"},"def":{"name":"load","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"return_type":"Object","visibility":"Public","body":"case\nwhen object_class.responds_to?(:from_sepia)\n  object_path = path || (File.join(@path, object_class.to_s, id))\n\n  if @serializable_storage.has_key?(object_path)\n  else\n    raise(\"Object with ID #{id} not found in storage for type #{object_class}\")\n  end\n\n  obj = object_class.from_sepia(@serializable_storage[object_path])\n  obj.sepia_id = id\n  obj\nwhen object_class < Container\n  object_key = \"#{object_class}/#{id}\"\n\n  if @container_storage.has_key?(object_key)\n  else\n    raise(\"Object with ID #{id} not found in storage for type #{object_class}\")\n  end\n\n  obj = object_class.new\n  obj.sepia_id = id\n\n\n  if data = @container_storage[object_key][\"_data\"]?\n    if data.empty?\n    else\n      (obj.as(Container)).restore_properties_from_json(data)\n    end\n  end\n\n\n  if path\n    (obj.as(Container)).load_references(path)\n  end\n\n  obj\nelse\n  raise(\"Unsupported class for Sepia storage: #{object_class.name}\")\nend"},"external_var":false},{"html_id":"save(object:Container,path:String|Nil=nil)-instance-method","name":"save","doc":"Saves a Container object to memory storage.\n\nStores the container's metadata and primitive properties in the\n`@container_storage` hash. Primitive properties are serialized to JSON\nand stored under the \"_data\" key.\n\n```\nboard = Board.new(\"My Board\")\nstorage = InMemoryStorage.new\nstorage.save(board) # Stored in @container_storage\n```","summary":"<p>Saves a Container object to memory storage.</p>","abstract":false,"args":[{"name":"object","external_name":"object","restriction":"Container"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"args_string":"(object : Container, path : String | Nil = nil)","args_html":"(object : <a href=\"../Sepia/Container.html\">Container</a>, path : String | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/sepia/in_memory_storage.cr","line_number":85,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L85"},"def":{"name":"save","args":[{"name":"object","external_name":"object","restriction":"Container"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"visibility":"Public","body":"object_key = \"#{object.class.name}/#{object.sepia_id}\"\n@container_storage[object_key] = {} of String => String\n\n\n@container_storage[object_key][\"_type\"] = \"container\"\n\n\n@container_storage[object_key][\"_data\"] = object.to_filtered_json\n\n\nif path\n  object.save_references(path)\nend\n"},"external_var":false},{"html_id":"save(object:Serializable,path:String|Nil=nil)-instance-method","name":"save","doc":"Saves a Serializable object to memory storage.\n\nStores the object's serialized content in the `@serializable_storage` hash.\nThe key is the full path (including the base path) to maintain\ncompatibility with FileStorage.\n\n```\ndoc = MyDocument.new(\"Hello\")\nstorage = InMemoryStorage.new\nstorage.save(doc) # Stored in @serializable_storage\n```","summary":"<p>Saves a Serializable object to memory storage.</p>","abstract":false,"args":[{"name":"object","external_name":"object","restriction":"Serializable"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"args_string":"(object : Serializable, path : String | Nil = nil)","args_html":"(object : <a href=\"../Sepia/Serializable.html\">Serializable</a>, path : String | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/sepia/in_memory_storage.cr","line_number":66,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L66"},"def":{"name":"save","args":[{"name":"object","external_name":"object","restriction":"Serializable"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"visibility":"Public","body":"object_path = path || (File.join(@path, object.class.name, object.sepia_id))\ncontent = object.to_sepia\n\n\n@serializable_storage[object_path] = content\n"},"external_var":false},{"html_id":"store_container_reference(container_path:String,ref_name:String,target_container:Container)-instance-method","name":"store_container_reference","abstract":false,"args":[{"name":"container_path","external_name":"container_path","restriction":"String"},{"name":"ref_name","external_name":"ref_name","restriction":"String"},{"name":"target_container","external_name":"target_container","restriction":"Container"}],"args_string":"(container_path : String, ref_name : String, target_container : Container)","args_html":"(container_path : String, ref_name : String, target_container : <a href=\"../Sepia/Container.html\">Container</a>)","location":{"filename":"src/sepia/in_memory_storage.cr","line_number":297,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L297"},"def":{"name":"store_container_reference","args":[{"name":"container_path","external_name":"container_path","restriction":"String"},{"name":"ref_name","external_name":"ref_name","restriction":"String"},{"name":"target_container","external_name":"target_container","restriction":"Container"}],"visibility":"Public","body":"__temp_25c21543_7 = container_path\n@container_references[__temp_25c21543_7]? || (@container_references[__temp_25c21543_7] = {} of String => String)\n@container_references[container_path][ref_name] = \"#{target_container.class.name}/#{target_container.sepia_id}\"\n"},"external_var":false},{"html_id":"store_reference(container_path:String,ref_name:String,target_class:String,target_id:String)-instance-method","name":"store_reference","doc":"Methods to support container references (for internal use by Container module)","summary":"<p>Methods to support container references (for internal use by Container module)</p>","abstract":false,"args":[{"name":"container_path","external_name":"container_path","restriction":"String"},{"name":"ref_name","external_name":"ref_name","restriction":"String"},{"name":"target_class","external_name":"target_class","restriction":"String"},{"name":"target_id","external_name":"target_id","restriction":"String"}],"args_string":"(container_path : String, ref_name : String, target_class : String, target_id : String)","args_html":"(container_path : String, ref_name : String, target_class : String, target_id : String)","location":{"filename":"src/sepia/in_memory_storage.cr","line_number":286,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/in_memory_storage.cr#L286"},"def":{"name":"store_reference","args":[{"name":"container_path","external_name":"container_path","restriction":"String"},{"name":"ref_name","external_name":"ref_name","restriction":"String"},{"name":"target_class","external_name":"target_class","restriction":"String"},{"name":"target_id","external_name":"target_id","restriction":"String"}],"visibility":"Public","body":"__temp_25c21543_5 = container_path\n@container_references[__temp_25c21543_5]? || (@container_references[__temp_25c21543_5] = {} of String => String)\n@container_references[container_path][ref_name] = \"#{target_class}/#{target_id}\"\n"},"external_var":false}]},{"html_id":"Sepia/Sepia/LogEvent","path":"Sepia/LogEvent.html","kind":"struct","full_name":"Sepia::LogEvent","name":"LogEvent","abstract":false,"superclass":{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"Sepia/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/event.cr","line_number":40,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L40"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Represents an event in the Sepia object lifecycle.\n\nThis struct captures when and how an object was modified, including\noptional metadata provided during save operations.\n\n### Properties\n\n- *timestamp*: When the event occurred\n- *event_type*: Type of operation (Created, Updated, Deleted)\n- *generation*: Object generation number for optimistic concurrency\n- *metadata*: Optional user-provided context (username, reason, etc.)\n\n### Example\n\n```\nevent = Sepia::LogEvent.new(\n  event_type: Sepia::LogEventType::Updated,\n  generation: 2,\n  metadata: {\"user\" => \"alice\", \"reason\" => \"content_edit\"}\n)\n```","summary":"<p>Represents an event in the Sepia object lifecycle.</p>","constructors":[{"html_id":"activity(metadata=nil):self-class-method","name":"activity","doc":"Creates a LogEvent for user activities.\n\n### Parameters\n\n- *metadata* : Optional metadata for the activity event\n\n### Returns\n\nA new LogEvent with Activity type (generation is always 0 for activities)\n\n### Example\n\n```\nevent = Sepia::LogEvent.activity({\"action\" => \"moved_lane\", \"user\" => \"alice\"})\n```","summary":"<p>Creates a LogEvent for user activities.</p>","abstract":false,"args":[{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"args_string":"(metadata = nil) : self","args_html":"(metadata = <span class=\"n\">nil</span>) : <span class=\"k\">self</span>","location":{"filename":"src/sepia/event.cr","line_number":188,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L188"},"def":{"name":"activity","args":[{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"return_type":"self","visibility":"Public","body":"metadata_json = metadata ? JSON.parse(metadata.to_json) : JSON::Any.new({} of String => JSON::Any)\nnew(LogEventType::Activity, 0, metadata_json)\n"},"external_var":false},{"html_id":"created(generation:Int32,metadata=nil):self-class-method","name":"created","doc":"Creates a LogEvent for object creation.\n\n### Parameters\n\n- *generation* : Initial generation number (usually 1)\n- *metadata* : Optional metadata for the creation event\n\n### Returns\n\nA new LogEvent with Created type\n\n### Example\n\n```\nevent = Sepia::LogEvent.created(1, {\"user\" => \"alice\"})\n```","summary":"<p>Creates a LogEvent for object creation.</p>","abstract":false,"args":[{"name":"generation","external_name":"generation","restriction":"Int32"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"args_string":"(generation : Int32, metadata = nil) : self","args_html":"(generation : Int32, metadata = <span class=\"n\">nil</span>) : <span class=\"k\">self</span>","location":{"filename":"src/sepia/event.cr","line_number":127,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L127"},"def":{"name":"created","args":[{"name":"generation","external_name":"generation","restriction":"Int32"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"return_type":"self","visibility":"Public","body":"metadata_json = metadata ? JSON.parse(metadata.to_json) : JSON::Any.new({} of String => JSON::Any)\nnew(LogEventType::Created, generation, metadata_json)\n"},"external_var":false},{"html_id":"deleted(metadata=nil):self-class-method","name":"deleted","doc":"Creates a LogEvent for object deletion.\n\n### Parameters\n\n- *metadata* : Optional metadata for the deletion event\n\n### Returns\n\nA new LogEvent with Deleted type (generation is always 0 for deletions)\n\n### Example\n\n```\nevent = Sepia::LogEvent.deleted({\"user\" => \"admin\", \"reason\" => \"cleanup\"})\n```","summary":"<p>Creates a LogEvent for object deletion.</p>","abstract":false,"args":[{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"args_string":"(metadata = nil) : self","args_html":"(metadata = <span class=\"n\">nil</span>) : <span class=\"k\">self</span>","location":{"filename":"src/sepia/event.cr","line_number":168,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L168"},"def":{"name":"deleted","args":[{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"return_type":"self","visibility":"Public","body":"metadata_json = metadata ? JSON.parse(metadata.to_json) : JSON::Any.new({} of String => JSON::Any)\nnew(LogEventType::Deleted, 0, metadata_json)\n"},"external_var":false},{"html_id":"from_json(json_string:String):self-class-method","name":"from_json","doc":"Creates a LogEvent from JSON string.\n\n### Parameters\n\n- *json_string* : JSON representation of the event\n\n### Returns\n\nA new LogEvent instance parsed from the JSON\n\n### Example\n\n```\nevent_json = %({\"ts\":\"2025-01-15T10:30:45Z\",\"type\":\"updated\",\"gen\":2,\"meta\":{\"user\":\"alice\"}})\nevent = Sepia::LogEvent.from_json(event_json)\n```","summary":"<p>Creates a LogEvent from JSON string.</p>","abstract":false,"args":[{"name":"json_string","external_name":"json_string","restriction":"String"}],"args_string":"(json_string : String) : self","args_html":"(json_string : String) : <span class=\"k\">self</span>","location":{"filename":"src/sepia/event.cr","line_number":65,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L65"},"def":{"name":"from_json","args":[{"name":"json_string","external_name":"json_string","restriction":"String"}],"return_type":"self","visibility":"Public","body":"parsed = JSON.parse(json_string)\n\ntimestamp = Time.parse_utc(parsed[\"ts\"].as_s, \"%Y-%m-%dT%H:%M:%SZ\")\nevent_type = LogEventType.parse(parsed[\"type\"].as_s)\ngeneration = parsed[\"gen\"].as_i\nmetadata = parsed[\"meta\"]?\n\nnew(event_type, generation, metadata || (JSON::Any.new({} of String => JSON::Any)), timestamp)\n"},"external_var":false},{"html_id":"new(event_type:LogEventType,generation:Int32,metadata:JSON::Any=JSON::Any.new({}ofString=>JSON::Any),timestamp:Time=Time.local)-class-method","name":"new","abstract":false,"args":[{"name":"event_type","external_name":"event_type","restriction":"LogEventType"},{"name":"generation","external_name":"generation","restriction":"Int32"},{"name":"metadata","default_value":"JSON::Any.new({} of String => JSON::Any)","external_name":"metadata","restriction":"::JSON::Any"},{"name":"timestamp","default_value":"Time.local","external_name":"timestamp","restriction":"Time"}],"args_string":"(event_type : LogEventType, generation : Int32, metadata : JSON::Any = JSON::Any.new({} of String => JSON::Any), timestamp : Time = Time.local)","args_html":"(event_type : <a href=\"../Sepia/LogEventType.html\">LogEventType</a>, generation : Int32, metadata : JSON::Any = <span class=\"t\">JSON</span><span class=\"t\">::</span><span class=\"t\">Any</span>.new({} <span class=\"k\">of</span> <span class=\"t\">String</span> <span class=\"o\">=&gt;</span> <span class=\"t\">JSON</span><span class=\"t\">::</span><span class=\"t\">Any</span>), timestamp : Time = <span class=\"t\">Time</span>.local)","location":{"filename":"src/sepia/event.cr","line_number":46,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L46"},"def":{"name":"new","args":[{"name":"event_type","external_name":"event_type","restriction":"LogEventType"},{"name":"generation","external_name":"generation","restriction":"Int32"},{"name":"metadata","default_value":"JSON::Any.new({} of String => JSON::Any)","external_name":"metadata","restriction":"::JSON::Any"},{"name":"timestamp","default_value":"Time.local","external_name":"timestamp","restriction":"Time"}],"visibility":"Public","body":"_ = allocate\n_.initialize(event_type, generation, metadata, timestamp)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"updated(generation:Int32,metadata=nil):self-class-method","name":"updated","doc":"Creates a LogEvent for object updates.\n\n### Parameters\n\n- *generation* : New generation number after update\n- *metadata* : Optional metadata for the update event\n\n### Returns\n\nA new LogEvent with Updated type\n\n### Example\n\n```\nevent = Sepia::LogEvent.updated(2, {\"user\" => \"bob\", \"reason\" => \"fix_typo\"})\n```","summary":"<p>Creates a LogEvent for object updates.</p>","abstract":false,"args":[{"name":"generation","external_name":"generation","restriction":"Int32"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"args_string":"(generation : Int32, metadata = nil) : self","args_html":"(generation : Int32, metadata = <span class=\"n\">nil</span>) : <span class=\"k\">self</span>","location":{"filename":"src/sepia/event.cr","line_number":148,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L148"},"def":{"name":"updated","args":[{"name":"generation","external_name":"generation","restriction":"Int32"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"return_type":"self","visibility":"Public","body":"metadata_json = metadata ? JSON.parse(metadata.to_json) : JSON::Any.new({} of String => JSON::Any)\nnew(LogEventType::Updated, generation, metadata_json)\n"},"external_var":false}],"instance_methods":[{"html_id":"event_type:LogEventType-instance-method","name":"event_type","abstract":false,"location":{"filename":"src/sepia/event.cr","line_number":42,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L42"},"def":{"name":"event_type","return_type":"LogEventType","visibility":"Public","body":"@event_type"},"external_var":false},{"html_id":"event_type=(event_type:LogEventType)-instance-method","name":"event_type=","abstract":false,"args":[{"name":"event_type","external_name":"event_type","restriction":"LogEventType"}],"args_string":"(event_type : LogEventType)","args_html":"(event_type : <a href=\"../Sepia/LogEventType.html\">LogEventType</a>)","location":{"filename":"src/sepia/event.cr","line_number":42,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L42"},"def":{"name":"event_type=","args":[{"name":"event_type","external_name":"event_type","restriction":"LogEventType"}],"visibility":"Public","body":"@event_type = event_type"},"external_var":false},{"html_id":"generation:Int32-instance-method","name":"generation","abstract":false,"location":{"filename":"src/sepia/event.cr","line_number":43,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L43"},"def":{"name":"generation","return_type":"Int32","visibility":"Public","body":"@generation"},"external_var":false},{"html_id":"generation=(generation:Int32)-instance-method","name":"generation=","abstract":false,"args":[{"name":"generation","external_name":"generation","restriction":"Int32"}],"args_string":"(generation : Int32)","args_html":"(generation : Int32)","location":{"filename":"src/sepia/event.cr","line_number":43,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L43"},"def":{"name":"generation=","args":[{"name":"generation","external_name":"generation","restriction":"Int32"}],"visibility":"Public","body":"@generation = generation"},"external_var":false},{"html_id":"metadata:JSON::Any-instance-method","name":"metadata","abstract":false,"location":{"filename":"src/sepia/event.cr","line_number":44,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L44"},"def":{"name":"metadata","return_type":"JSON::Any","visibility":"Public","body":"@metadata"},"external_var":false},{"html_id":"metadata=(metadata:JSON::Any)-instance-method","name":"metadata=","abstract":false,"args":[{"name":"metadata","external_name":"metadata","restriction":"JSON::Any"}],"args_string":"(metadata : JSON::Any)","args_html":"(metadata : JSON::Any)","location":{"filename":"src/sepia/event.cr","line_number":44,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L44"},"def":{"name":"metadata=","args":[{"name":"metadata","external_name":"metadata","restriction":"JSON::Any"}],"visibility":"Public","body":"@metadata = metadata"},"external_var":false},{"html_id":"timestamp:Time-instance-method","name":"timestamp","abstract":false,"location":{"filename":"src/sepia/event.cr","line_number":41,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L41"},"def":{"name":"timestamp","return_type":"Time","visibility":"Public","body":"@timestamp"},"external_var":false},{"html_id":"timestamp=(timestamp:Time)-instance-method","name":"timestamp=","abstract":false,"args":[{"name":"timestamp","external_name":"timestamp","restriction":"Time"}],"args_string":"(timestamp : Time)","args_html":"(timestamp : Time)","location":{"filename":"src/sepia/event.cr","line_number":41,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L41"},"def":{"name":"timestamp=","args":[{"name":"timestamp","external_name":"timestamp","restriction":"Time"}],"visibility":"Public","body":"@timestamp = timestamp"},"external_var":false},{"html_id":"to_json(json:JSON::Builder)-instance-method","name":"to_json","doc":"Serializes the event to JSON format (builder version).\n\nThis method writes the JSON representation to the provided JSON::Builder.\nUsed internally by the JSON serialization system.\n\n### Parameters\n\n- *json* : JSON::Builder to write to","summary":"<p>Serializes the event to JSON format (builder version).</p>","abstract":false,"args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"args_string":"(json : JSON::Builder)","args_html":"(json : JSON::Builder)","location":{"filename":"src/sepia/event.cr","line_number":102,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L102"},"def":{"name":"to_json","args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"visibility":"Public","body":"json.object do\n  json.field(\"ts\", timestamp.to_rfc3339)\n  json.field(\"type\", event_type)\n  json.field(\"gen\", generation)\n  json.field(\"meta\", metadata)\nend"},"external_var":false},{"html_id":"to_json:String-instance-method","name":"to_json","doc":"Serializes the event to JSON format.\n\n### Returns\n\nA JSON string representation of the event\n\n### Example\n\n```\nevent = Sepia::LogEvent.new(Sepia::LogEventType::Created, 1, {\"user\" => \"alice\"})\njson = event.to_json # => {\"ts\":\"2025-01-15T10:30:45Z\",\"type\":\"created\",\"gen\":1,\"meta\":{\"user\":\"alice\"}}\n```","summary":"<p>Serializes the event to JSON format.</p>","abstract":false,"location":{"filename":"src/sepia/event.cr","line_number":88,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L88"},"def":{"name":"to_json","return_type":"String","visibility":"Public","body":"String.build do |json|\n  to_json(json)\nend"},"external_var":false}]},{"html_id":"Sepia/Sepia/LogEventType","path":"Sepia/LogEventType.html","kind":"enum","full_name":"Sepia::LogEventType","name":"LogEventType","abstract":false,"ancestors":[{"html_id":"Sepia/Enum","kind":"struct","full_name":"Enum","name":"Enum"},{"html_id":"Sepia/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"Sepia/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/event.cr","line_number":8,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L8"}],"repository_name":"Sepia","program":false,"enum":true,"alias":false,"const":false,"constants":[{"id":"Created","name":"Created","value":"0"},{"id":"Updated","name":"Updated","value":"1"},{"id":"Deleted","name":"Deleted","value":"2"},{"id":"Activity","name":"Activity","value":"3"}],"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Event types for Sepia object operations.\n\nThese represent the different operations that can be performed on\nSepia objects and are recorded in the event log.","summary":"<p>Event types for Sepia object operations.</p>","instance_methods":[{"html_id":"activity?-instance-method","name":"activity?","doc":"Returns `true` if this enum value equals `Activity`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../Sepia/LogEventType.html#Activity\">Activity</a></code></p>","abstract":false,"location":{"filename":"src/sepia/event.cr","line_number":12,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L12"},"def":{"name":"activity?","visibility":"Public","body":"self == Activity"},"external_var":false},{"html_id":"created?-instance-method","name":"created?","doc":"Returns `true` if this enum value equals `Created`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../Sepia/LogEventType.html#Created\">Created</a></code></p>","abstract":false,"location":{"filename":"src/sepia/event.cr","line_number":9,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L9"},"def":{"name":"created?","visibility":"Public","body":"self == Created"},"external_var":false},{"html_id":"deleted?-instance-method","name":"deleted?","doc":"Returns `true` if this enum value equals `Deleted`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../Sepia/LogEventType.html#Deleted\">Deleted</a></code></p>","abstract":false,"location":{"filename":"src/sepia/event.cr","line_number":11,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L11"},"def":{"name":"deleted?","visibility":"Public","body":"self == Deleted"},"external_var":false},{"html_id":"to_json(json:JSON::Builder)-instance-method","name":"to_json","doc":"Serializes this enum member by name.\n\nFor non-flags enums, the serialization is a JSON string. The value is the\nmember name (see `#to_s`) transformed with `String#underscore`.\n\n```\nenum Stages\n  INITIAL\n  SECOND_STAGE\nend\n\nStages::INITIAL.to_json      # => %(\"initial\")\nStages::SECOND_STAGE.to_json # => %(\"second_stage\")\n```\n\nFor flags enums, the serialization is a JSON array including every flagged\nmember individually serialized in the same way as a member of a non-flags enum.\n`None` is serialized as an empty array, `All` as an array containing\nall members.\n\n```\n@[Flags]\nenum Sides\n  LEFT\n  RIGHT\nend\n\nSides::LEFT.to_json                  # => %([\"left\"])\n(Sides::LEFT | Sides::RIGHT).to_json # => %([\"left\",\"right\"])\nSides::All.to_json                   # => %([\"left\",\"right\"])\nSides::None.to_json                  # => %([])\n```\n\n`ValueConverter.to_json` offers a different serialization strategy based on the\nmember value.","summary":"<p>Serializes this enum member by name.</p>","abstract":false,"args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"args_string":"(json : JSON::Builder)","args_html":"(json : JSON::Builder)","location":{"filename":"src/sepia/event.cr","line_number":14,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L14"},"def":{"name":"to_json","args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"visibility":"Public","body":"json.string(to_s.downcase)"},"external_var":false},{"html_id":"updated?-instance-method","name":"updated?","doc":"Returns `true` if this enum value equals `Updated`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../Sepia/LogEventType.html#Updated\">Updated</a></code></p>","abstract":false,"location":{"filename":"src/sepia/event.cr","line_number":10,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event.cr#L10"},"def":{"name":"updated?","visibility":"Public","body":"self == Updated"},"external_var":false}]},{"html_id":"Sepia/Sepia/MemoryLimiter","path":"Sepia/MemoryLimiter.html","kind":"class","full_name":"Sepia::MemoryLimiter","name":"MemoryLimiter","abstract":false,"superclass":{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/memory_limiter.cr","line_number":24,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L24"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Memory pressure detection and management system.\n\nMonitors system memory usage and provides signals for when\ncaches should be purged or memory-saving measures should be taken.\nWorks across different platforms (Linux, macOS, Windows).\n\n### Example\n\n```\nlimiter = MemoryLimiter.new(\n  warning_threshold: \"70%\",\n  critical_threshold: \"85%\",\n  check_interval: 30.seconds\n)\n\nlimiter.on_warning { puts \"Memory usage is high\" }\nlimiter.on_critical { cache.clear }\n\nlimiter.start_monitoring\n```","summary":"<p>Memory pressure detection and management system.</p>","constructors":[{"html_id":"new(warning_threshold:Float64=0.7,critical_threshold:Float64=0.85,emergency_threshold:Float64=0.95,check_interval:Time::Span=30.seconds)-class-method","name":"new","doc":"Creates a new memory limiter.\n\n### Parameters\n\n- *warning_threshold* : Memory usage percentage for warning (default: 0.7 = 70%)\n- *critical_threshold* : Memory usage percentage for critical (default: 0.85 = 85%)\n- *emergency_threshold* : Memory usage percentage for emergency (default: 0.95 = 95%)\n- *check_interval* : How often to check memory usage (default: 30 seconds)\n\n### Example\n\n```\nlimiter = MemoryLimiter.new(\n  warning_threshold: 0.75,\n  critical_threshold: 0.90,\n  check_interval: 60.seconds\n)\n```","summary":"<p>Creates a new memory limiter.</p>","abstract":false,"args":[{"name":"warning_threshold","default_value":"0.7","external_name":"warning_threshold","restriction":"Float64"},{"name":"critical_threshold","default_value":"0.85","external_name":"critical_threshold","restriction":"Float64"},{"name":"emergency_threshold","default_value":"0.95","external_name":"emergency_threshold","restriction":"Float64"},{"name":"check_interval","default_value":"30.seconds","external_name":"check_interval","restriction":"Time::Span"}],"args_string":"(warning_threshold : Float64 = 0.7, critical_threshold : Float64 = 0.85, emergency_threshold : Float64 = 0.95, check_interval : Time::Span = 30.seconds)","args_html":"(warning_threshold : Float64 = <span class=\"n\">0.7</span>, critical_threshold : Float64 = <span class=\"n\">0.85</span>, emergency_threshold : Float64 = <span class=\"n\">0.95</span>, check_interval : Time::Span = <span class=\"n\">30</span>.seconds)","location":{"filename":"src/sepia/memory_limiter.cr","line_number":101,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L101"},"def":{"name":"new","args":[{"name":"warning_threshold","default_value":"0.7","external_name":"warning_threshold","restriction":"Float64"},{"name":"critical_threshold","default_value":"0.85","external_name":"critical_threshold","restriction":"Float64"},{"name":"emergency_threshold","default_value":"0.95","external_name":"emergency_threshold","restriction":"Float64"},{"name":"check_interval","default_value":"30.seconds","external_name":"check_interval","restriction":"Time::Span"}],"visibility":"Public","body":"_ = allocate\n_.initialize(warning_threshold, critical_threshold, emergency_threshold, check_interval)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"check_interval:Time::Span-instance-method","name":"check_interval","doc":"Monitoring interval","summary":"<p>Monitoring interval</p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":69,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L69"},"def":{"name":"check_interval","return_type":"Time::Span","visibility":"Public","body":"@check_interval"},"external_var":false},{"html_id":"check_now:PressureLevel-instance-method","name":"check_now","doc":"Forces an immediate memory check.\n\nUpdates current statistics and triggers appropriate callbacks.\n\n### Returns\n\nCurrent memory pressure level.\n\n### Example\n\n```\npressure = limiter.check_now\nputs \"Current pressure: #{pressure}\"\n```","summary":"<p>Forces an immediate memory check.</p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":166,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L166"},"def":{"name":"check_now","return_type":"PressureLevel","visibility":"Public","body":"check_memory\n@current_pressure\n"},"external_var":false},{"html_id":"critical?:Bool-instance-method","name":"critical?","doc":"Checks if memory pressure is at critical level or higher.\n\n### Returns\n\n`true` if usage >= critical_threshold, `false` otherwise.\n\n### Example\n\n```\nif limiter.critical?\n  cache.clear\n  GC.collect\nend\n```","summary":"<p>Checks if memory pressure is at critical level or higher.</p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":223,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L223"},"def":{"name":"critical?","return_type":"Bool","visibility":"Public","body":"@current_pressure.critical? || @current_pressure.emergency?"},"external_var":false},{"html_id":"critical_threshold:Float64-instance-method","name":"critical_threshold","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":65,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L65"},"def":{"name":"critical_threshold","return_type":"Float64","visibility":"Public","body":"@critical_threshold"},"external_var":false},{"html_id":"current_pressure:PressureLevel-instance-method","name":"current_pressure","doc":"Gets the current memory pressure level.\n\n### Returns\n\nCurrent pressure level without forcing a new check.\n\n### Example\n\n```\npressure = limiter.current_pressure\ncase pressure\nwhen .warning?\n  puts \"Memory usage is high\"\nwhen .critical?\n  puts \"Memory usage is critical\"\nend\n```","summary":"<p>Gets the current memory pressure level.</p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":188,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L188"},"def":{"name":"current_pressure","return_type":"PressureLevel","visibility":"Public","body":"@mutex.synchronize do @current_pressure end"},"external_var":false},{"html_id":"current_stats:MemoryStats-instance-method","name":"current_stats","doc":"Current memory statistics","summary":"<p>Current memory statistics</p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":72,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L72"},"def":{"name":"current_stats","return_type":"MemoryStats","visibility":"Public","body":"@current_stats"},"external_var":false},{"html_id":"emergency?:Bool-instance-method","name":"emergency?","doc":"Checks if memory pressure is at emergency level.\n\n### Returns\n\n`true` if usage >= emergency_threshold, `false` otherwise.\n\n### Example\n\n```\nif limiter.emergency?\n  raise \"Out of memory!\"\nend\n```","summary":"<p>Checks if memory pressure is at emergency level.</p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":240,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L240"},"def":{"name":"emergency?","return_type":"Bool","visibility":"Public","body":"@current_pressure.emergency?"},"external_var":false},{"html_id":"emergency_threshold:Float64-instance-method","name":"emergency_threshold","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":66,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L66"},"def":{"name":"emergency_threshold","return_type":"Float64","visibility":"Public","body":"@emergency_threshold"},"external_var":false},{"html_id":"monitoring:Bool-instance-method","name":"monitoring","doc":"Monitoring state","summary":"<p>Monitoring state</p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":81,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L81"},"def":{"name":"monitoring","return_type":"Bool","visibility":"Public","body":"@monitoring"},"external_var":false},{"html_id":"on_critical:Proc(Nil)|Nil-instance-method","name":"on_critical","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":76,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L76"},"def":{"name":"on_critical","return_type":"Proc(Nil) | ::Nil","visibility":"Public","body":"@on_critical"},"external_var":false},{"html_id":"on_critical=(on_critical:Proc(Nil)|Nil)-instance-method","name":"on_critical=","abstract":false,"args":[{"name":"on_critical","external_name":"on_critical","restriction":"Proc(Nil) | ::Nil"}],"args_string":"(on_critical : Proc(Nil) | Nil)","args_html":"(on_critical : Proc(Nil) | Nil)","location":{"filename":"src/sepia/memory_limiter.cr","line_number":76,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L76"},"def":{"name":"on_critical=","args":[{"name":"on_critical","external_name":"on_critical","restriction":"Proc(Nil) | ::Nil"}],"visibility":"Public","body":"@on_critical = on_critical"},"external_var":false},{"html_id":"on_emergency:Proc(Nil)|Nil-instance-method","name":"on_emergency","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":77,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L77"},"def":{"name":"on_emergency","return_type":"Proc(Nil) | ::Nil","visibility":"Public","body":"@on_emergency"},"external_var":false},{"html_id":"on_emergency=(on_emergency:Proc(Nil)|Nil)-instance-method","name":"on_emergency=","abstract":false,"args":[{"name":"on_emergency","external_name":"on_emergency","restriction":"Proc(Nil) | ::Nil"}],"args_string":"(on_emergency : Proc(Nil) | Nil)","args_html":"(on_emergency : Proc(Nil) | Nil)","location":{"filename":"src/sepia/memory_limiter.cr","line_number":77,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L77"},"def":{"name":"on_emergency=","args":[{"name":"on_emergency","external_name":"on_emergency","restriction":"Proc(Nil) | ::Nil"}],"visibility":"Public","body":"@on_emergency = on_emergency"},"external_var":false},{"html_id":"on_normal:Proc(Nil)|Nil-instance-method","name":"on_normal","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":78,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L78"},"def":{"name":"on_normal","return_type":"Proc(Nil) | ::Nil","visibility":"Public","body":"@on_normal"},"external_var":false},{"html_id":"on_normal=(on_normal:Proc(Nil)|Nil)-instance-method","name":"on_normal=","abstract":false,"args":[{"name":"on_normal","external_name":"on_normal","restriction":"Proc(Nil) | ::Nil"}],"args_string":"(on_normal : Proc(Nil) | Nil)","args_html":"(on_normal : Proc(Nil) | Nil)","location":{"filename":"src/sepia/memory_limiter.cr","line_number":78,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L78"},"def":{"name":"on_normal=","args":[{"name":"on_normal","external_name":"on_normal","restriction":"Proc(Nil) | ::Nil"}],"visibility":"Public","body":"@on_normal = on_normal"},"external_var":false},{"html_id":"on_warning:Proc(Nil)|Nil-instance-method","name":"on_warning","doc":"Event callbacks","summary":"<p>Event callbacks</p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":75,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L75"},"def":{"name":"on_warning","return_type":"Proc(Nil) | ::Nil","visibility":"Public","body":"@on_warning"},"external_var":false},{"html_id":"on_warning=(on_warning:Proc(Nil)|Nil)-instance-method","name":"on_warning=","doc":"Event callbacks","summary":"<p>Event callbacks</p>","abstract":false,"args":[{"name":"on_warning","external_name":"on_warning","restriction":"Proc(Nil) | ::Nil"}],"args_string":"(on_warning : Proc(Nil) | Nil)","args_html":"(on_warning : Proc(Nil) | Nil)","location":{"filename":"src/sepia/memory_limiter.cr","line_number":75,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L75"},"def":{"name":"on_warning=","args":[{"name":"on_warning","external_name":"on_warning","restriction":"Proc(Nil) | ::Nil"}],"visibility":"Public","body":"@on_warning = on_warning"},"external_var":false},{"html_id":"start_monitoring:Void-instance-method","name":"start_monitoring","doc":"Starts monitoring memory usage in the background.\n\nCreates a fiber that periodically checks memory usage and\ntriggers callbacks based on threshold levels.\n\n### Example\n\n```\nlimiter.start_monitoring\n```","summary":"<p>Starts monitoring memory usage in the background.</p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":124,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L124"},"def":{"name":"start_monitoring","return_type":"Void","visibility":"Public","body":"@mutex.synchronize do\n  if @monitoring\n    return\n  end\n\n  @monitoring = true\n  @monitor_thread = spawn do\n    while @monitoring\n      check_memory\n      sleep(@check_interval)\n    end\n  end\nend"},"external_var":false},{"html_id":"status_description:String-instance-method","name":"status_description","doc":"Gets a human-readable description of current memory state.\n\n### Returns\n\nDescription string.\n\n### Example\n\n```\nputs limiter.status_description\n# => \"Memory usage: 2.3 GB of 8.0 GB (28.8%) - Normal\"\n```","summary":"<p>Gets a human-readable description of current memory state.</p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":256,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L256"},"def":{"name":"status_description","return_type":"String","visibility":"Public","body":"@mutex.synchronize do\n  \"#{@current_stats.to_s} - #{@current_pressure}\"\nend"},"external_var":false},{"html_id":"stop_monitoring:Void-instance-method","name":"stop_monitoring","doc":"Stops monitoring memory usage.\n\n### Example\n\n```\nlimiter.stop_monitoring\n```","summary":"<p>Stops monitoring memory usage.</p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":145,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L145"},"def":{"name":"stop_monitoring","return_type":"Void","visibility":"Public","body":"@mutex.synchronize do\n  @monitoring = false\n  @monitor_thread = nil\nend"},"external_var":false},{"html_id":"suggest_cache_size(max_size:Int32):Int32-instance-method","name":"suggest_cache_size","doc":"Suggests cache size based on current memory pressure.\n\n### Parameters\n\n- *max_size* : Maximum desired cache size\n\n### Returns\n\nRecommended cache size based on memory pressure.\n\n### Example\n\n```\nrecommended = limiter.suggest_cache_size(1000)\ncache.resize(recommended)\n```","summary":"<p>Suggests cache size based on current memory pressure.</p>","abstract":false,"args":[{"name":"max_size","external_name":"max_size","restriction":"Int32"}],"args_string":"(max_size : Int32) : Int32","args_html":"(max_size : Int32) : Int32","location":{"filename":"src/sepia/memory_limiter.cr","line_number":278,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L278"},"def":{"name":"suggest_cache_size","args":[{"name":"max_size","external_name":"max_size","restriction":"Int32"}],"return_type":"Int32","visibility":"Public","body":"case @current_pressure\nwhen .normal?\n  max_size\nwhen .warning?\n  (max_size * 0.7).to_i32\nwhen .critical?\n  (max_size * 0.4).to_i32\nwhen .emergency?\n  (max_size * 0.1).to_i32\nelse\n  max_size\nend"},"external_var":false},{"html_id":"warning?:Bool-instance-method","name":"warning?","doc":"Checks if memory pressure is at warning level or higher.\n\n### Returns\n\n`true` if usage >= warning_threshold, `false` otherwise.\n\n### Example\n\n```\nif limiter.warning?\n  cache.cleanup\nend\n```","summary":"<p>Checks if memory pressure is at warning level or higher.</p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":205,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L205"},"def":{"name":"warning?","return_type":"Bool","visibility":"Public","body":"(@current_pressure.warning? || @current_pressure.critical?) || @current_pressure.emergency?"},"external_var":false},{"html_id":"warning_threshold:Float64-instance-method","name":"warning_threshold","doc":"Memory usage thresholds","summary":"<p>Memory usage thresholds</p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":64,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L64"},"def":{"name":"warning_threshold","return_type":"Float64","visibility":"Public","body":"@warning_threshold"},"external_var":false}],"types":[{"html_id":"Sepia/Sepia/MemoryLimiter/MemoryStats","path":"Sepia/MemoryLimiter/MemoryStats.html","kind":"struct","full_name":"Sepia::MemoryLimiter::MemoryStats","name":"MemoryStats","abstract":false,"superclass":{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"Sepia/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/memory_limiter.cr","line_number":26,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L26"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia/MemoryLimiter","kind":"class","full_name":"Sepia::MemoryLimiter","name":"MemoryLimiter"},"doc":"Memory statistics snapshot","summary":"<p>Memory statistics snapshot</p>","constructors":[{"html_id":"new(total_bytes:UInt64,used_bytes:UInt64,available_bytes:UInt64,usage_percent:Float64,timestamp:Time=Time.utc)-class-method","name":"new","abstract":false,"args":[{"name":"total_bytes","external_name":"total_bytes","restriction":"::UInt64"},{"name":"used_bytes","external_name":"used_bytes","restriction":"::UInt64"},{"name":"available_bytes","external_name":"available_bytes","restriction":"::UInt64"},{"name":"usage_percent","external_name":"usage_percent","restriction":"::Float64"},{"name":"timestamp","default_value":"Time.utc","external_name":"timestamp","restriction":"::Time"}],"args_string":"(total_bytes : UInt64, used_bytes : UInt64, available_bytes : UInt64, usage_percent : Float64, timestamp : Time = Time.utc)","args_html":"(total_bytes : UInt64, used_bytes : UInt64, available_bytes : UInt64, usage_percent : Float64, timestamp : Time = <span class=\"t\">Time</span>.utc)","location":{"filename":"src/sepia/memory_limiter.cr","line_number":33,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L33"},"def":{"name":"new","args":[{"name":"total_bytes","external_name":"total_bytes","restriction":"::UInt64"},{"name":"used_bytes","external_name":"used_bytes","restriction":"::UInt64"},{"name":"available_bytes","external_name":"available_bytes","restriction":"::UInt64"},{"name":"usage_percent","external_name":"usage_percent","restriction":"::Float64"},{"name":"timestamp","default_value":"Time.utc","external_name":"timestamp","restriction":"::Time"}],"visibility":"Public","body":"_ = allocate\n_.initialize(total_bytes, used_bytes, available_bytes, usage_percent, timestamp)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"available_bytes:UInt64-instance-method","name":"available_bytes","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":29,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L29"},"def":{"name":"available_bytes","return_type":"UInt64","visibility":"Public","body":"@available_bytes"},"external_var":false},{"html_id":"available_bytes=(available_bytes:UInt64)-instance-method","name":"available_bytes=","abstract":false,"args":[{"name":"available_bytes","external_name":"available_bytes","restriction":"UInt64"}],"args_string":"(available_bytes : UInt64)","args_html":"(available_bytes : UInt64)","location":{"filename":"src/sepia/memory_limiter.cr","line_number":29,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L29"},"def":{"name":"available_bytes=","args":[{"name":"available_bytes","external_name":"available_bytes","restriction":"UInt64"}],"visibility":"Public","body":"@available_bytes = available_bytes"},"external_var":false},{"html_id":"timestamp:Time-instance-method","name":"timestamp","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":31,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L31"},"def":{"name":"timestamp","return_type":"Time","visibility":"Public","body":"@timestamp"},"external_var":false},{"html_id":"timestamp=(timestamp:Time)-instance-method","name":"timestamp=","abstract":false,"args":[{"name":"timestamp","external_name":"timestamp","restriction":"Time"}],"args_string":"(timestamp : Time)","args_html":"(timestamp : Time)","location":{"filename":"src/sepia/memory_limiter.cr","line_number":31,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L31"},"def":{"name":"timestamp=","args":[{"name":"timestamp","external_name":"timestamp","restriction":"Time"}],"visibility":"Public","body":"@timestamp = timestamp"},"external_var":false},{"html_id":"to_s:String-instance-method","name":"to_s","doc":"Returns a nicely readable and concise string representation of this object,\ntypically intended for users.\n\nThis method should usually **not** be overridden. It delegates to\n`#to_s(IO)` which can be overridden for custom implementations.\n\nAlso see `#inspect`.","summary":"<p>Returns a nicely readable and concise string representation of this object, typically intended for users.</p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":36,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L36"},"def":{"name":"to_s","return_type":"String","visibility":"Public","body":"\"{total: #{format_bytes(@total_bytes)}, used: #{format_bytes(@used_bytes)}, available: #{format_bytes(@available_bytes)}, usage: #{@usage_percent.round(1)}%}\""},"external_var":false},{"html_id":"total_bytes:UInt64-instance-method","name":"total_bytes","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":27,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L27"},"def":{"name":"total_bytes","return_type":"UInt64","visibility":"Public","body":"@total_bytes"},"external_var":false},{"html_id":"total_bytes=(total_bytes:UInt64)-instance-method","name":"total_bytes=","abstract":false,"args":[{"name":"total_bytes","external_name":"total_bytes","restriction":"UInt64"}],"args_string":"(total_bytes : UInt64)","args_html":"(total_bytes : UInt64)","location":{"filename":"src/sepia/memory_limiter.cr","line_number":27,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L27"},"def":{"name":"total_bytes=","args":[{"name":"total_bytes","external_name":"total_bytes","restriction":"UInt64"}],"visibility":"Public","body":"@total_bytes = total_bytes"},"external_var":false},{"html_id":"usage_percent:Float64-instance-method","name":"usage_percent","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":30,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L30"},"def":{"name":"usage_percent","return_type":"Float64","visibility":"Public","body":"@usage_percent"},"external_var":false},{"html_id":"usage_percent=(usage_percent:Float64)-instance-method","name":"usage_percent=","abstract":false,"args":[{"name":"usage_percent","external_name":"usage_percent","restriction":"Float64"}],"args_string":"(usage_percent : Float64)","args_html":"(usage_percent : Float64)","location":{"filename":"src/sepia/memory_limiter.cr","line_number":30,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L30"},"def":{"name":"usage_percent=","args":[{"name":"usage_percent","external_name":"usage_percent","restriction":"Float64"}],"visibility":"Public","body":"@usage_percent = usage_percent"},"external_var":false},{"html_id":"used_bytes:UInt64-instance-method","name":"used_bytes","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":28,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L28"},"def":{"name":"used_bytes","return_type":"UInt64","visibility":"Public","body":"@used_bytes"},"external_var":false},{"html_id":"used_bytes=(used_bytes:UInt64)-instance-method","name":"used_bytes=","abstract":false,"args":[{"name":"used_bytes","external_name":"used_bytes","restriction":"UInt64"}],"args_string":"(used_bytes : UInt64)","args_html":"(used_bytes : UInt64)","location":{"filename":"src/sepia/memory_limiter.cr","line_number":28,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L28"},"def":{"name":"used_bytes=","args":[{"name":"used_bytes","external_name":"used_bytes","restriction":"UInt64"}],"visibility":"Public","body":"@used_bytes = used_bytes"},"external_var":false}]},{"html_id":"Sepia/Sepia/MemoryLimiter/PressureLevel","path":"Sepia/MemoryLimiter/PressureLevel.html","kind":"enum","full_name":"Sepia::MemoryLimiter::PressureLevel","name":"PressureLevel","abstract":false,"ancestors":[{"html_id":"Sepia/Enum","kind":"struct","full_name":"Enum","name":"Enum"},{"html_id":"Sepia/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"Sepia/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/memory_limiter.cr","line_number":56,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L56"}],"repository_name":"Sepia","program":false,"enum":true,"alias":false,"const":false,"constants":[{"id":"Normal","name":"Normal","value":"0"},{"id":"Warning","name":"Warning","value":"1"},{"id":"Critical","name":"Critical","value":"2"},{"id":"Emergency","name":"Emergency","value":"3"}],"namespace":{"html_id":"Sepia/Sepia/MemoryLimiter","kind":"class","full_name":"Sepia::MemoryLimiter","name":"MemoryLimiter"},"doc":"Memory pressure levels","summary":"<p>Memory pressure levels</p>","instance_methods":[{"html_id":"critical?-instance-method","name":"critical?","doc":"Returns `true` if this enum value equals `Critical`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../../Sepia/MemoryLimiter/PressureLevel.html#Critical\">Critical</a></code></p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":59,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L59"},"def":{"name":"critical?","visibility":"Public","body":"self == Critical"},"external_var":false},{"html_id":"emergency?-instance-method","name":"emergency?","doc":"Returns `true` if this enum value equals `Emergency`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../../Sepia/MemoryLimiter/PressureLevel.html#Emergency\">Emergency</a></code></p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":60,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L60"},"def":{"name":"emergency?","visibility":"Public","body":"self == Emergency"},"external_var":false},{"html_id":"normal?-instance-method","name":"normal?","doc":"Returns `true` if this enum value equals `Normal`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../../Sepia/MemoryLimiter/PressureLevel.html#Normal\">Normal</a></code></p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":57,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L57"},"def":{"name":"normal?","visibility":"Public","body":"self == Normal"},"external_var":false},{"html_id":"warning?-instance-method","name":"warning?","doc":"Returns `true` if this enum value equals `Warning`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../../Sepia/MemoryLimiter/PressureLevel.html#Warning\">Warning</a></code></p>","abstract":false,"location":{"filename":"src/sepia/memory_limiter.cr","line_number":58,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/memory_limiter.cr#L58"},"def":{"name":"warning?","visibility":"Public","body":"self == Warning"},"external_var":false}]}]},{"html_id":"Sepia/Sepia/Object","path":"Sepia/Object.html","kind":"class","full_name":"Sepia::Object","name":"Object","abstract":false,"superclass":{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/object.cr","line_number":34,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L34"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Base class for all objects managed by Sepia.\n\nProvides generation tracking functionality for optimistic concurrency control,\nautomatic ID generation with UUIDs, and core persistence methods.\n\nAll classes that use Sepia's serialization features must inherit from this class.\n\n### Example\n\n```\nclass MyDocument < Sepia::Object\n  include Sepia::Serializable\n\n  property content : String\n\n  def initialize(@content = \"\")\n  end\n\n  def to_sepia : String\n    @content\n  end\n\n  def self.from_sepia(sepia_string : String) : self\n    new(sepia_string)\n  end\nend\n\ndoc = MyDocument.new(\"Hello, World!\")\ndoc.save # Saves to storage with auto-generated UUID\n```","summary":"<p>Base class for all objects managed by Sepia.</p>","class_methods":[{"html_id":"exists?(id:String):Bool-class-method","name":"exists?","doc":"Check if an object with the given ID exists in storage.\n\nReturns `true` if an object of this class with the specified ID exists,\n`false` otherwise. This is useful for checking existence before loading\nor verifying if a specific generation exists.\n\n```\n# Check if a specific version exists\nif Document.exists?(\"doc-123.2\")\n  puts \"Version 2 exists\"\nelse\n  puts \"Version 2 does not exist\"\nend\n\n# Check for existence of legacy object (generation 0)\nDocument.exists?(\"legacy-doc\") # => true if exists\n\n# Common pattern: check before creating new generation\nunless Document.exists?(\"doc-123.3\")\n  # Safe to create version 3\nend\n```","summary":"<p>Check if an object with the given ID exists in storage.</p>","abstract":false,"args":[{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(id : String) : Bool","args_html":"(id : String) : Bool","location":{"filename":"src/sepia/object.cr","line_number":348,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L348"},"def":{"name":"exists?","args":[{"name":"id","external_name":"id","restriction":"String"}],"return_type":"Bool","visibility":"Public","body":"backend = Sepia::Storage.backend\n\nif backend.is_a?(FileStorage)\n  object_path = File.join(backend.path, self.name, id)\n  File.exists?(object_path)\nelse\n  begin\n    self.load(id)\n    true\n  rescue\n    false\n  end\nend\n"},"external_var":false},{"html_id":"generation_separator-class-method","name":"generation_separator","doc":"Separator character used between base ID and generation number.\n\nDefault is \".\" which creates IDs like \"note-123.1\", \"note-123.2\".\nCan be overridden per class if needed.\n\n```\nclass CustomNote < Sepia::Object\n  class_property generation_separator = \"_\"\nend\n\nnote = CustomNote.new\nnote.save_with_generation # ID becomes \"note-uuid_1\"\n```","summary":"<p>Separator character used between base ID and generation number.</p>","abstract":false,"location":{"filename":"src/sepia/object.cr","line_number":48,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L48"},"def":{"name":"generation_separator","visibility":"Public","body":"@@generation_separator"},"external_var":false},{"html_id":"generation_separator=(generation_separator:String)-class-method","name":"generation_separator=","doc":"Separator character used between base ID and generation number.\n\nDefault is \".\" which creates IDs like \"note-123.1\", \"note-123.2\".\nCan be overridden per class if needed.\n\n```\nclass CustomNote < Sepia::Object\n  class_property generation_separator = \"_\"\nend\n\nnote = CustomNote.new\nnote.save_with_generation # ID becomes \"note-uuid_1\"\n```","summary":"<p>Separator character used between base ID and generation number.</p>","abstract":false,"args":[{"name":"generation_separator","external_name":"generation_separator","restriction":"::String"}],"args_string":"(generation_separator : String)","args_html":"(generation_separator : String)","location":{"filename":"src/sepia/object.cr","line_number":48,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L48"},"def":{"name":"generation_separator=","args":[{"name":"generation_separator","external_name":"generation_separator","restriction":"::String"}],"visibility":"Public","body":"@@generation_separator = generation_separator"},"external_var":false},{"html_id":"latest(base_id:String):self|Nil-class-method","name":"latest","doc":"Find the latest version of an object by its base ID.\n\nReturns the object with the highest generation number, or `nil` if no versions exist.\nThis is useful for always retrieving the most recent version of an object.\n\n```\n# Get the latest version of a document\nlatest_doc = Document.latest(\"doc-123\")\nif latest_doc\n  puts \"Latest version: #{latest_doc.generation}\"\n  puts \"Content: #{latest_doc.content}\"\nend\n\n# Always returns nil for non-existent base IDs\nDocument.latest(\"non-existent\") # => nil\n```","summary":"<p>Find the latest version of an object by its base ID.</p>","abstract":false,"args":[{"name":"base_id","external_name":"base_id","restriction":"String"}],"args_string":"(base_id : String) : self | Nil","args_html":"(base_id : String) : <span class=\"k\">self</span> | Nil","location":{"filename":"src/sepia/object.cr","line_number":242,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L242"},"def":{"name":"latest","args":[{"name":"base_id","external_name":"base_id","restriction":"String"}],"return_type":"self | ::Nil","visibility":"Public","body":"all_versions = versions(base_id)\nall_versions.max_by(&.generation)\n"},"external_var":false},{"html_id":"versions(base_id:String):Array(self)-class-method","name":"versions","doc":"Find all versions of an object by its base ID.\n\nReturns an array of all object versions, sorted by generation number in ascending order.\nThis allows you to access the complete version history of an object.\n\n```\n# Get all versions of a document\nall_versions = Document.versions(\"doc-123\")\n\n# Print version history\nall_versions.each do |version|\n  puts \"Version #{version.generation}: #{version.created_at}\"\nend\n\n# versions are sorted by generation\nall_versions.first.generation # => 0 (oldest)\nall_versions.last.generation  # => 2 (newest)\n```\n\nNote: For FileStorage, this scans the directory and may be slow with many versions.\nConsider caching or cleanup strategies for long-running applications.","summary":"<p>Find all versions of an object by its base ID.</p>","abstract":false,"args":[{"name":"base_id","external_name":"base_id","restriction":"String"}],"args_string":"(base_id : String) : Array(self)","args_html":"(base_id : String) : Array(<span class=\"k\">self</span>)","location":{"filename":"src/sepia/object.cr","line_number":268,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L268"},"def":{"name":"versions","args":[{"name":"base_id","external_name":"base_id","restriction":"String"}],"return_type":"Array(self)","visibility":"Public","body":"backend = Sepia::Storage.backend\n\nversions = [] of self\nif backend.is_a?(FileStorage)\n  class_dir = File.join(backend.path, self.name)\n  if Dir.exists?(class_dir)\n  else\n    return versions\n  end\n\n  Dir.each_child(class_dir) do |filename|\n    if filename == base_id\n      begin\n        obj = Sepia::Storage.load(self, filename)\n        versions << obj\n      rescue\n      end\n    elsif filename.starts_with?(\"#{base_id}#{generation_separator}\")\n      gen_part = filename[(base_id.size + generation_separator.size)..-1]\n      if gen_part.matches?(/^\\d+$/)\n        begin\n          obj = Sepia::Storage.load(self, filename)\n          versions << obj\n        rescue\n        end\n      end\n    end\n  end\nelse\n  gen = 0\n  loop do\n    begin\n      obj = Sepia::Storage.load(self, \"#{base_id}#{generation_separator}#{gen}\")\n      versions << obj\n      gen = gen + 1\n    rescue\n      break\n    end\n  end\n\n\n  if versions.empty?\n    begin\n      obj = Sepia::Storage.load(self, base_id)\n      versions << obj\n    rescue\n    end\n  end\nend\n\nversions.sort_by(&.generation)\n"},"external_var":false}],"constructors":[{"html_id":"load(id:String,path:String|Nil=nil):self-class-method","name":"load","doc":"Loads an object from storage with transparent generation handling.\n\n**Generation-transparent loading:**\n- If you specify a generation (e.g., \"note-123.2\"), loads that specific generation\n- If you specify base ID only (e.g., \"note-123\"), automatically loads the latest generation\n- If no generations exist, loads the base object\n\nThis makes generations completely transparent - users get the latest content\nby default without needing to think about versioning.\n\n```\n# Load the latest version automatically (most common case)\ndoc = MyDocument.load(\"doc-uuid\")\n\n# Load a specific generation (rare, for version control)\nold_doc = MyDocument.load(\"doc-uuid.1\")\n\n# Load from custom path (still respects latest generation)\ndoc = MyDocument.load(\"doc-uuid\", \"/custom/path\")\n```","summary":"<p>Loads an object from storage with transparent generation handling.</p>","abstract":false,"args":[{"name":"id","external_name":"id","restriction":"String"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"args_string":"(id : String, path : String | Nil = nil) : self","args_html":"(id : String, path : String | Nil = <span class=\"n\">nil</span>) : <span class=\"k\">self</span>","location":{"filename":"src/sepia/object.cr","line_number":404,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L404"},"def":{"name":"load","args":[{"name":"id","external_name":"id","restriction":"String"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"return_type":"self","visibility":"Public","body":"if id.includes?(generation_separator)\n  Sepia::Storage::INSTANCE.load(self, id, path)\nelsif path\n  Sepia::Storage::INSTANCE.load(self, id, path)\nelse\n  latest_obj = latest(id)\n  if latest_obj\n    latest_obj\n  else\n    Sepia::Storage::INSTANCE.load(self, id, path)\n  end\nend"},"external_var":false}],"instance_methods":[{"html_id":"backup_supported?:Bool-instance-method","name":"backup_supported?","doc":"Checks if this object can be backed up with the current storage backend.\n\n### Returns\n\n`true` if backup is supported, `false` otherwise\n\n### Example\n\n```\nif document.backup_supported?\n  puts \"Can create backup of this document\"\nelse\n  puts \"Switch to FileStorage to enable backup\"\nend\n```","summary":"<p>Checks if this object can be backed up with the current storage backend.</p>","abstract":false,"location":{"filename":"src/sepia/object.cr","line_number":539,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L539"},"def":{"name":"backup_supported?","return_type":"Bool","visibility":"Public","body":"Sepia::Storage.backup_supported?"},"external_var":false},{"html_id":"backup_to(output_path:String):String-instance-method","name":"backup_to","doc":"Creates a backup of this object and all its referenced objects.\n\nThis is a convenience method that creates a backup containing this object\nas the root and automatically includes all objects it references.\n\n### Parameters\n\n- *output_path* : Path where the backup tar file will be created\n\n### Returns\n\nThe path to the created backup file\n\n### Example\n\n```\n# Backup a project and all its documents\nproject = Project.load(\"project-123\")\nbackup_path = project.backup_to(\"project_backup.tar\")\n\n# Auto-generate timestamped backup name\nbackup_path = user.backup_to(\"user_backup_#{Time.utc.to_unix}.tar\")\n```\n\n### Raises\n\n- `Sepia::Backup::BackendNotSupportedError` if storage doesn't support backups\n- `Sepia::Backup::BackupCreationError` if backup creation fails","summary":"<p>Creates a backup of this object and all its referenced objects.</p>","abstract":false,"args":[{"name":"output_path","external_name":"output_path","restriction":"String"}],"args_string":"(output_path : String) : String","args_html":"(output_path : String) : String","location":{"filename":"src/sepia/object.cr","line_number":484,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L484"},"def":{"name":"backup_to","args":[{"name":"output_path","external_name":"output_path","restriction":"String"}],"return_type":"String","visibility":"Public","body":"Sepia::Storage.backup(self, output_path)"},"external_var":false},{"html_id":"base_id:String-instance-method","name":"base_id","doc":"Returns the base ID without the generation suffix.\n\nThe base ID is the unique identifier that remains constant across all generations.\n\n```\nobj.sepia_id = \"note-123.2\"\nobj.base_id # => \"note-123\"\n\nobj.sepia_id = \"legacy-note\"\nobj.base_id # => \"legacy-note\"\n```","summary":"<p>Returns the base ID without the generation suffix.</p>","abstract":false,"location":{"filename":"src/sepia/object.cr","line_number":116,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L116"},"def":{"name":"base_id","return_type":"String","visibility":"Public","body":"parts = @sepia_id.split(self.class.generation_separator)\nif parts.size > 1 && (parts.last.matches?(/^\\d+$/))\n  parts[0..-2].join(self.class.generation_separator)\nelse\n  @sepia_id\nend\n"},"external_var":false},{"html_id":"canonical_path:String-instance-method","name":"canonical_path","doc":"Returns the canonical path for this object in storage.\n\nThe canonical path follows the pattern: `{storage_path}/{ClassName}/{sepia_id}`.\nThis is where Serializable objects are stored by default.\n\n```\ndoc = MyDocument.new\ndoc.sepia_id = \"my-doc\"\ndoc.canonical_path # => \"/tmp/storage/MyDocument/my-doc\"\n```","summary":"<p>Returns the canonical path for this object in storage.</p>","abstract":false,"location":{"filename":"src/sepia/object.cr","line_number":450,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L450"},"def":{"name":"canonical_path","return_type":"String","visibility":"Public","body":"File.join(Sepia::Storage::INSTANCE.path, self.class.name, sepia_id)"},"external_var":false},{"html_id":"create_backup(backup_dir:String=\".\",include_timestamp:Bool=true):String-instance-method","name":"create_backup","doc":"Creates a backup with an auto-generated timestamped filename.\n\nConvenience method that generates a backup filename based on the object's\nclass name and ID with a timestamp.\n\n### Parameters\n\n- *backup_dir* : Directory where the backup will be created (defaults to current directory)\n- *include_timestamp* : Whether to include timestamp in filename (default: true)\n\n### Returns\n\nThe path to the created backup file\n\n### Example\n\n```\n# Create timestamped backup in current directory\nbackup_path = document.create_backup\n# => \"Document_doc123_backup_1703123456.tar\"\n\n# Create backup in specific directory without timestamp\nbackup_path = project.create_backup(\"/backups\", include_timestamp: false)\n# => \"/backups/Project_project456_backup.tar\"\n```","summary":"<p>Creates a backup with an auto-generated timestamped filename.</p>","abstract":false,"args":[{"name":"backup_dir","default_value":"\".\"","external_name":"backup_dir","restriction":"String"},{"name":"include_timestamp","default_value":"true","external_name":"include_timestamp","restriction":"Bool"}],"args_string":"(backup_dir : String = \".\", include_timestamp : Bool = true) : String","args_html":"(backup_dir : String = <span class=\"s\">&quot;.&quot;</span>, include_timestamp : Bool = <span class=\"n\">true</span>) : String","location":{"filename":"src/sepia/object.cr","line_number":513,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L513"},"def":{"name":"create_backup","args":[{"name":"backup_dir","default_value":"\".\"","external_name":"backup_dir","restriction":"String"},{"name":"include_timestamp","default_value":"true","external_name":"include_timestamp","restriction":"Bool"}],"return_type":"String","visibility":"Public","body":"if Dir.exists?(backup_dir)\nelse\n  Dir.mkdir_p(backup_dir)\nend\n\nbase_name = \"#{self.class.name}_#{sepia_id}_backup\"\ntimestamp = include_timestamp ? \"_#{Time.utc.to_unix}\" : \"\"\nfilename = \"#{base_name}#{timestamp}.tar\"\noutput_path = File.join(backup_dir, filename)\n\nbackup_to(output_path)\n"},"external_var":false},{"html_id":"delete-instance-method","name":"delete","doc":"Deletes the object from storage.\n\nRemoves the object's file or directory from storage. For Container objects,\nalso cleans up any nested objects and references.\n\n```\ndoc = MyDocument.load(\"doc-uuid\")\ndoc.delete # Removes the document from storage\n```","summary":"<p>Deletes the object from storage.</p>","abstract":false,"location":{"filename":"src/sepia/object.cr","line_number":436,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L436"},"def":{"name":"delete","visibility":"Public","body":"Sepia::Storage::INSTANCE.delete(self)"},"external_var":false},{"html_id":"generation:Int32-instance-method","name":"generation","doc":"Returns the generation number extracted from the object's ID.\n\nFor IDs without a generation suffix, returns 0.\n\n```\nobj.sepia_id = \"note-123.2\"\nobj.generation # => 2\n\nobj.sepia_id = \"legacy-note\"\nobj.generation # => 0\n```","summary":"<p>Returns the generation number extracted from the object's ID.</p>","abstract":false,"location":{"filename":"src/sepia/object.cr","line_number":96,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L96"},"def":{"name":"generation","return_type":"Int32","visibility":"Public","body":"parts = @sepia_id.split(self.class.generation_separator)\nif parts.size > 1 && (parts.last.matches?(/^\\d+$/))\n  parts.last.to_i\nelse\n  0\nend\n"},"external_var":false},{"html_id":"save(path:String|Nil=nil)-instance-method","name":"save","doc":"Saves the object to storage.\n\nFor Serializable objects, serializes the object using its `to_sepia` method.\nFor Container objects, creates a directory structure and saves all nested objects.\n\nThe optional `path` parameter specifies where to save the object. If not provided,\nuses the canonical path based on the object's class and sepia_id.\n\n```\ndoc = MyDocument.new(\"Hello\")\ndoc.save # Saves to default location\n\n# Save to specific path\ndoc.save(\"/custom/path\")\n```","summary":"<p>Saves the object to storage.</p>","abstract":false,"args":[{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"args_string":"(path : String | Nil = nil)","args_html":"(path : String | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/sepia/object.cr","line_number":380,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L380"},"def":{"name":"save","args":[{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"visibility":"Public","body":"Sepia::Storage::INSTANCE.save(self, path)"},"external_var":false},{"html_id":"save(metadata=nil):self-instance-method","name":"save","doc":"Saves the object to storage with optional metadata.\n\nThis is a convenience method that delegates to the global Storage API.\nIt automatically detects whether to create a new object or update an existing one.\n\n### Parameters\n\n- *metadata* : Optional JSON-serializable metadata for event logging\n\n### Returns\n\nThe object itself (for method chaining)\n\n### Example\n\n```\nnote = Note.new(\"Hello World\")\nnote.sepia_id = \"my-note\"\n\n# Simple save\nnote.save\n\n# Save with metadata\nnote.save(metadata: {\"user\" => \"alice\"})\n```","summary":"<p>Saves the object to storage with optional metadata.</p>","abstract":false,"args":[{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"args_string":"(metadata = nil) : self","args_html":"(metadata = <span class=\"n\">nil</span>) : <span class=\"k\">self</span>","location":{"filename":"src/sepia/object.cr","line_number":163,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L163"},"def":{"name":"save","args":[{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"return_type":"self","visibility":"Public","body":"Sepia::Storage.save(self, metadata: metadata)\nself\n"},"external_var":false},{"html_id":"save(*,force_new_generation:Bool,metadata=nil)-instance-method","name":"save","doc":"Saves the object with forced new generation.\n\nThis method always creates a new version regardless of whether the object\nalready exists in storage. Equivalent to save_with_generation but follows\nthe same method signature pattern as save().\n\n### Parameters\n\n- *force_new_generation* : Always increment generation (set to true)\n- *metadata* : Optional JSON-serializable metadata for event logging\n\n### Returns\n\nThe object itself (for method chaining)\n\n### Example\n\n```\nnote = Note.new(\"Hello World\")\nnote.sepia_id = \"my-note\"\n\n# Always creates new version\nnote.save(force_new_generation: true, metadata: {\"user\" => \"alice\"})\n```","summary":"<p>Saves the object with forced new generation.</p>","abstract":false,"args":[{"name":"","external_name":"","restriction":""},{"name":"force_new_generation","external_name":"force_new_generation","restriction":"Bool"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"args_string":"(*, force_new_generation : Bool, metadata = nil)","args_html":"(*, force_new_generation : Bool, metadata = <span class=\"n\">nil</span>)","location":{"filename":"src/sepia/object.cr","line_number":192,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L192"},"def":{"name":"save","args":[{"name":"","external_name":"","restriction":""},{"name":"force_new_generation","external_name":"force_new_generation","restriction":"Bool"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"splat_index":0,"visibility":"Public","body":"Sepia::Storage.save(self, metadata: metadata, force_new_generation: force_new_generation)"},"external_var":false},{"html_id":"save_with_generation(metadata=nil):self-instance-method","name":"save_with_generation","doc":"Creates a new version of this object with an incremented generation number.\n\nReturns a new object instance with the same attributes but a new ID\ncontaining the next generation number. The original object is not modified.\n\n```\nobj.sepia_id = \"note-123.2\"\nnew_obj = obj.save_with_generation\nnew_obj.sepia_id # => \"note-123.3\"\n```\n\nNOTE: This method requires the class to implement `to_sepia` and `from_sepia`\nfor Serializable objects. For Container objects, override this method.","summary":"<p>Creates a new version of this object with an incremented generation number.</p>","abstract":false,"args":[{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"args_string":"(metadata = nil) : self","args_html":"(metadata = <span class=\"n\">nil</span>) : <span class=\"k\">self</span>","location":{"filename":"src/sepia/object.cr","line_number":209,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L209"},"def":{"name":"save_with_generation","args":[{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"return_type":"self","visibility":"Public","body":"new_id = \"#{base_id}#{self.class.generation_separator}#{generation + 1}\"\n\n\nif (self.responds_to?(:to_sepia)) && (self.class.responds_to?(:from_sepia))\n  new_obj = self.class.from_sepia(self.to_sepia)\n  new_obj.sepia_id = new_id\n  Sepia::Storage.save(new_obj, metadata: metadata)\n  new_obj\nelse\n  raise(\"save_with_generation not implemented for #{self.class.name}. \" + \"Either implement to_sepia/from_sepia or override save_with_generation.\")\nend\n"},"external_var":false},{"html_id":"sepia_id:String-instance-method","name":"sepia_id","doc":"Unique identifier for this object.\n\nDefaults to a randomly generated UUIDv4 string. Can be manually set\nfor specific use cases or when restoring objects with known IDs.\n\nThe ID format may include generation suffixes for version tracking:\n- Without generation: \"note-123e4567-e89b-12d3-a456-426614174000\"\n- With generation: \"note-123e4567-e89b-12d3-a456-426614174000.1\"\n\n```\nobj = MyClass.new\nobj.sepia_id # => \"myclass-uuid-string\"\n\n# Manually set ID\nobj.sepia_id = \"custom-id\"\n```","summary":"<p>Unique identifier for this object.</p>","abstract":false,"location":{"filename":"src/sepia/object.cr","line_number":66,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L66"},"def":{"name":"sepia_id","return_type":"String","visibility":"Public","body":"@sepia_id"},"external_var":false},{"html_id":"sepia_id=(id:String)-instance-method","name":"sepia_id=","doc":"Sets the unique identifier for this object.\n\nUse this when you need to control the object's ID, such as when\nrestoring from external data or maintaining specific naming conventions.\n\nNote: Forward slashes (\"/\") are automatically replaced with underscores (\"_\")\nto prevent unintended subdirectory creation in the filesystem storage.\n\n```\nobj = MyClass.new\nobj.sepia_id = \"document-2024-001\"\nobj.sepia_id = \"path/to/document\" # Becomes \"path_to_document\"\n```","summary":"<p>Sets the unique identifier for this object.</p>","abstract":false,"args":[{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(id : String)","args_html":"(id : String)","location":{"filename":"src/sepia/object.cr","line_number":81,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L81"},"def":{"name":"sepia_id=","args":[{"name":"id","external_name":"id","restriction":"String"}],"visibility":"Public","body":"@sepia_id = id.gsub('/', '_')"},"external_var":false},{"html_id":"stale?(expected_generation:Int32):Bool-instance-method","name":"stale?","doc":"Checks if a newer version of this object exists.\n\nReturns true if an object with ID `base_id.(expected_generation + 1)` exists.\nThis is useful for optimistic concurrency control.\n\n```\nobj.sepia_id = \"note-123.2\"\nobj.stale?(2) # => true if \"note-123.3\" exists\n```","summary":"<p>Checks if a newer version of this object exists.</p>","abstract":false,"args":[{"name":"expected_generation","external_name":"expected_generation","restriction":"Int32"}],"args_string":"(expected_generation : Int32) : Bool","args_html":"(expected_generation : Int32) : Bool","location":{"filename":"src/sepia/object.cr","line_number":134,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/object.cr#L134"},"def":{"name":"stale?","args":[{"name":"expected_generation","external_name":"expected_generation","restriction":"Int32"}],"return_type":"Bool","visibility":"Public","body":"self.class.exists?(\"#{base_id}#{self.class.generation_separator}#{expected_generation + 1}\")"},"external_var":false}]},{"html_id":"Sepia/Sepia/PathResolver","path":"Sepia/PathResolver.html","kind":"class","full_name":"Sepia::PathResolver","name":"PathResolver","abstract":false,"superclass":{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/path_resolver.cr","line_number":19,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L19"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Utility class for resolving file system paths to Sepia objects\n\nThis helper provides methods to convert file system paths back to\nSepia objects, which is particularly useful for file system watchers\nand other tools that need to map file paths back to object instances.\n\n### Example\n\n```\n# Given a file path like \"/data/MyDocument/uuid-123\"\nresolver = Sepia::PathResolver.new(\"/data\")\n\ninfo = resolver.resolve_path(\"/data/MyDocument/uuid-123\")\ninfo.class_name # => \"MyDocument\"\ninfo.object_id  # => \"uuid-123\"\ninfo.full_path  # => \"/data/MyDocument/uuid-123\"\n```","summary":"<p>Utility class for resolving file system paths to Sepia objects</p>","constructors":[{"html_id":"new(storage_path:String)-class-method","name":"new","doc":"Creates a new PathResolver\n\n```\nresolver = PathResolver.new(\"/data/sepia\")\nresolver = PathResolver.new(Sepia::Storage.instance.path)\n```","summary":"<p>Creates a new PathResolver</p>","abstract":false,"args":[{"name":"storage_path","external_name":"storage_path","restriction":"String"}],"args_string":"(storage_path : String)","args_html":"(storage_path : String)","location":{"filename":"src/sepia/path_resolver.cr","line_number":71,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L71"},"def":{"name":"new","args":[{"name":"storage_path","external_name":"storage_path","restriction":"String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(storage_path)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"list_all_objects:Array(ObjectInfo)-instance-method","name":"list_all_objects","doc":"List all Sepia objects in the storage directory\n\nReturns an array of ObjectInfo for all found objects\n\n```\nresolver = PathResolver.new(\"/data\")\nobjects = resolver.list_all_objects\nobjects.each do |info|\n  puts \"#{info.class_name}: #{info.object_id}\"\nend\n```","summary":"<p>List all Sepia objects in the storage directory</p>","abstract":false,"location":{"filename":"src/sepia/path_resolver.cr","line_number":139,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L139"},"def":{"name":"list_all_objects","return_type":"Array(ObjectInfo)","visibility":"Public","body":"objects = [] of ObjectInfo\nif Dir.exists?(@storage_path)\nelse\n  return objects\nend\n\nDir.each_child(@storage_path) do |class_name|\n  class_dir = File.join(@storage_path, class_name)\n  if File.directory?(class_dir)\n  else\n    next\n  end\n\n  Dir.each_child(class_dir) do |object_id|\n    object_path = File.join(class_dir, object_id)\n    if (File.file?(object_path)) || (File.directory?(object_path))\n    else\n      next\n    end\n\n    info = ObjectInfo.new(class_name: class_name, object_id: object_id, full_path: object_path, relative_path: File.join(class_name, object_id), storage_path: @storage_path)\n    objects << info\n  end\nend\n\nobjects\n"},"external_var":false},{"html_id":"resolve_and_load(full_path:String,klass:Class):Object|Nil-instance-method","name":"resolve_and_load","doc":"Resolve a path and load the actual Sepia object\n\nThis is a convenience method that combines resolve_path and object loading\n\n```\nobj = resolver.resolve_and_load(\"/data/MyDocument/uuid-123\", TestDocument)\nif obj\n  puts \"Loaded: #{obj.class.name} (#{obj.sepia_id})\"\nend\n```","summary":"<p>Resolve a path and load the actual Sepia object</p>","abstract":false,"args":[{"name":"full_path","external_name":"full_path","restriction":"String"},{"name":"klass","external_name":"klass","restriction":"Class"}],"args_string":"(full_path : String, klass : Class) : Object | Nil","args_html":"(full_path : String, klass : Class) : <a href=\"../Sepia/Object.html\">Object</a> | Nil","location":{"filename":"src/sepia/path_resolver.cr","line_number":121,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L121"},"def":{"name":"resolve_and_load","args":[{"name":"full_path","external_name":"full_path","restriction":"String"},{"name":"klass","external_name":"klass","restriction":"Class"}],"return_type":"Object | ::Nil","visibility":"Public","body":"info = resolve_path(full_path)\nif info\nelse\n  return nil\nend\n\ninfo.object(klass)\n"},"external_var":false},{"html_id":"resolve_path(full_path:String):ObjectInfo|Nil-instance-method","name":"resolve_path","doc":"Resolve a file system path to Sepia object information\n\n```\ninfo = resolver.resolve_path(\"/data/MyDocument/uuid-123\")\ninfo.class_name # => \"MyDocument\"\ninfo.object_id  # => \"uuid-123\"\n```","summary":"<p>Resolve a file system path to Sepia object information</p>","abstract":false,"args":[{"name":"full_path","external_name":"full_path","restriction":"String"}],"args_string":"(full_path : String) : ObjectInfo | Nil","args_html":"(full_path : String) : <a href=\"../Sepia/PathResolver/ObjectInfo.html\">ObjectInfo</a> | Nil","location":{"filename":"src/sepia/path_resolver.cr","line_number":81,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L81"},"def":{"name":"resolve_path","args":[{"name":"full_path","external_name":"full_path","restriction":"String"}],"return_type":"ObjectInfo | ::Nil","visibility":"Public","body":"storage_path = File.expand_path(@storage_path)\nfull_path = File.expand_path(full_path)\n\n\nif full_path.starts_with?(storage_path)\nelse\n  return nil\nend\n\n\nrelative_path = full_path[storage_path.size..-1]\nrelative_path = relative_path.lstrip('/')\n\n\nparts = relative_path.split('/')\nif parts.size >= 2\nelse\n  return nil\nend\n\nclass_name = parts[0]\nobject_id = parts[1]\n\nif class_name.empty? || object_id.empty?\n  return nil\nend\n\nObjectInfo.new(class_name: class_name, object_id: object_id, full_path: full_path, relative_path: relative_path, storage_path: storage_path)\n"},"external_var":false},{"html_id":"storage_path:String-instance-method","name":"storage_path","doc":"Base storage path for resolving objects","summary":"<p>Base storage path for resolving objects</p>","abstract":false,"location":{"filename":"src/sepia/path_resolver.cr","line_number":63,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L63"},"def":{"name":"storage_path","return_type":"String","visibility":"Public","body":"@storage_path"},"external_var":false},{"html_id":"storage_path=(storage_path:String)-instance-method","name":"storage_path=","doc":"Base storage path for resolving objects","summary":"<p>Base storage path for resolving objects</p>","abstract":false,"args":[{"name":"storage_path","external_name":"storage_path","restriction":"String"}],"args_string":"(storage_path : String)","args_html":"(storage_path : String)","location":{"filename":"src/sepia/path_resolver.cr","line_number":63,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L63"},"def":{"name":"storage_path=","args":[{"name":"storage_path","external_name":"storage_path","restriction":"String"}],"visibility":"Public","body":"@storage_path = storage_path"},"external_var":false},{"html_id":"valid_sepia_path?(path:String):Bool-instance-method","name":"valid_sepia_path?","doc":"Check if a path is a valid Sepia object path\n\n```\nif resolver.valid_sepia_path?(\"/data/MyDocument/uuid-123\")\n  puts \"This is a valid Sepia object path\"\nend\n```","summary":"<p>Check if a path is a valid Sepia object path</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String) : Bool","args_html":"(path : String) : Bool","location":{"filename":"src/sepia/path_resolver.cr","line_number":172,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L172"},"def":{"name":"valid_sepia_path?","args":[{"name":"path","external_name":"path","restriction":"String"}],"return_type":"Bool","visibility":"Public","body":"!resolve_path(path).nil?"},"external_var":false}],"types":[{"html_id":"Sepia/Sepia/PathResolver/ObjectInfo","path":"Sepia/PathResolver/ObjectInfo.html","kind":"struct","full_name":"Sepia::PathResolver::ObjectInfo","name":"ObjectInfo","abstract":false,"superclass":{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"Sepia/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/path_resolver.cr","line_number":21,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L21"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia/PathResolver","kind":"class","full_name":"Sepia::PathResolver","name":"PathResolver"},"doc":"Information about a resolved Sepia object path","summary":"<p>Information about a resolved Sepia object path</p>","constructors":[{"html_id":"new(class_name:String,object_id:String,full_path:String,relative_path:String,storage_path:String)-class-method","name":"new","abstract":false,"args":[{"name":"class_name","external_name":"class_name","restriction":"String"},{"name":"object_id","external_name":"object_id","restriction":"String"},{"name":"full_path","external_name":"full_path","restriction":"String"},{"name":"relative_path","external_name":"relative_path","restriction":"String"},{"name":"storage_path","external_name":"storage_path","restriction":"String"}],"args_string":"(class_name : String, object_id : String, full_path : String, relative_path : String, storage_path : String)","args_html":"(class_name : String, object_id : String, full_path : String, relative_path : String, storage_path : String)","location":{"filename":"src/sepia/path_resolver.cr","line_number":28,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L28"},"def":{"name":"new","args":[{"name":"class_name","external_name":"class_name","restriction":"String"},{"name":"object_id","external_name":"object_id","restriction":"String"},{"name":"full_path","external_name":"full_path","restriction":"String"},{"name":"relative_path","external_name":"relative_path","restriction":"String"},{"name":"storage_path","external_name":"storage_path","restriction":"String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(class_name, object_id, full_path, relative_path, storage_path)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"class_name:String-instance-method","name":"class_name","abstract":false,"location":{"filename":"src/sepia/path_resolver.cr","line_number":22,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L22"},"def":{"name":"class_name","return_type":"String","visibility":"Public","body":"@class_name"},"external_var":false},{"html_id":"class_name=(class_name:String)-instance-method","name":"class_name=","abstract":false,"args":[{"name":"class_name","external_name":"class_name","restriction":"String"}],"args_string":"(class_name : String)","args_html":"(class_name : String)","location":{"filename":"src/sepia/path_resolver.cr","line_number":22,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L22"},"def":{"name":"class_name=","args":[{"name":"class_name","external_name":"class_name","restriction":"String"}],"visibility":"Public","body":"@class_name = class_name"},"external_var":false},{"html_id":"container?:Bool-instance-method","name":"container?","doc":"Check if this path represents a Container object","summary":"<p>Check if this path represents a Container object</p>","abstract":false,"location":{"filename":"src/sepia/path_resolver.cr","line_number":32,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L32"},"def":{"name":"container?","return_type":"Bool","visibility":"Public","body":"File.directory?(@full_path)"},"external_var":false},{"html_id":"full_path:String-instance-method","name":"full_path","abstract":false,"location":{"filename":"src/sepia/path_resolver.cr","line_number":24,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L24"},"def":{"name":"full_path","return_type":"String","visibility":"Public","body":"@full_path"},"external_var":false},{"html_id":"full_path=(full_path:String)-instance-method","name":"full_path=","abstract":false,"args":[{"name":"full_path","external_name":"full_path","restriction":"String"}],"args_string":"(full_path : String)","args_html":"(full_path : String)","location":{"filename":"src/sepia/path_resolver.cr","line_number":24,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L24"},"def":{"name":"full_path=","args":[{"name":"full_path","external_name":"full_path","restriction":"String"}],"visibility":"Public","body":"@full_path = full_path"},"external_var":false},{"html_id":"object(klass:Class):Object|Nil-instance-method","name":"object","doc":"Load the actual Sepia object from storage using a given class\n\n```\nobj = info.object(TestDocument)\nif obj\n  puts \"Loaded #{obj.class.name} with ID #{obj.sepia_id}\"\nend\n```","summary":"<p>Load the actual Sepia object from storage using a given class</p>","abstract":false,"args":[{"name":"klass","external_name":"klass","restriction":"Class"}],"args_string":"(klass : Class) : Object | Nil","args_html":"(klass : Class) : <a href=\"../../Sepia/Object.html\">Object</a> | Nil","location":{"filename":"src/sepia/path_resolver.cr","line_number":49,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L49"},"def":{"name":"object","args":[{"name":"klass","external_name":"klass","restriction":"Class"}],"return_type":"Object | ::Nil","visibility":"Public","body":"file_storage = Sepia::FileStorage.new(@storage_path)\n\nbegin\n  file_storage.load(klass, @object_id, @full_path)\nrescue ex\n  nil\nend\n"},"external_var":false},{"html_id":"object_id:String-instance-method","name":"object_id","abstract":false,"location":{"filename":"src/sepia/path_resolver.cr","line_number":23,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L23"},"def":{"name":"object_id","return_type":"String","visibility":"Public","body":"@object_id"},"external_var":false},{"html_id":"object_id=(object_id:String)-instance-method","name":"object_id=","abstract":false,"args":[{"name":"object_id","external_name":"object_id","restriction":"String"}],"args_string":"(object_id : String)","args_html":"(object_id : String)","location":{"filename":"src/sepia/path_resolver.cr","line_number":23,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L23"},"def":{"name":"object_id=","args":[{"name":"object_id","external_name":"object_id","restriction":"String"}],"visibility":"Public","body":"@object_id = object_id"},"external_var":false},{"html_id":"relative_path:String-instance-method","name":"relative_path","abstract":false,"location":{"filename":"src/sepia/path_resolver.cr","line_number":25,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L25"},"def":{"name":"relative_path","return_type":"String","visibility":"Public","body":"@relative_path"},"external_var":false},{"html_id":"relative_path=(relative_path:String)-instance-method","name":"relative_path=","abstract":false,"args":[{"name":"relative_path","external_name":"relative_path","restriction":"String"}],"args_string":"(relative_path : String)","args_html":"(relative_path : String)","location":{"filename":"src/sepia/path_resolver.cr","line_number":25,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L25"},"def":{"name":"relative_path=","args":[{"name":"relative_path","external_name":"relative_path","restriction":"String"}],"visibility":"Public","body":"@relative_path = relative_path"},"external_var":false},{"html_id":"serializable?:Bool-instance-method","name":"serializable?","doc":"Check if this path represents a Serializable object","summary":"<p>Check if this path represents a Serializable object</p>","abstract":false,"location":{"filename":"src/sepia/path_resolver.cr","line_number":37,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L37"},"def":{"name":"serializable?","return_type":"Bool","visibility":"Public","body":"File.file?(@full_path)"},"external_var":false},{"html_id":"storage_path:String-instance-method","name":"storage_path","abstract":false,"location":{"filename":"src/sepia/path_resolver.cr","line_number":26,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L26"},"def":{"name":"storage_path","return_type":"String","visibility":"Public","body":"@storage_path"},"external_var":false},{"html_id":"storage_path=(storage_path:String)-instance-method","name":"storage_path=","abstract":false,"args":[{"name":"storage_path","external_name":"storage_path","restriction":"String"}],"args_string":"(storage_path : String)","args_html":"(storage_path : String)","location":{"filename":"src/sepia/path_resolver.cr","line_number":26,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/path_resolver.cr#L26"},"def":{"name":"storage_path=","args":[{"name":"storage_path","external_name":"storage_path","restriction":"String"}],"visibility":"Public","body":"@storage_path = storage_path"},"external_var":false}]}]},{"html_id":"Sepia/Sepia/PerFileEventLogger","path":"Sepia/PerFileEventLogger.html","kind":"class","full_name":"Sepia::PerFileEventLogger","name":"PerFileEventLogger","abstract":false,"superclass":{"html_id":"Sepia/Sepia/EventLoggerBackend","kind":"class","full_name":"Sepia::EventLoggerBackend","name":"EventLoggerBackend"},"ancestors":[{"html_id":"Sepia/Sepia/EventLoggerBackend","kind":"class","full_name":"Sepia::EventLoggerBackend","name":"EventLoggerBackend"},{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/event_logger.cr","line_number":82,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L82"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Event logging backend that stores one file per object.\n\nThis is the default implementation that creates a separate JSON Lines\nfile for each object, containing all events for that object in\nchronological order.\n\n### File Structure\n\n```\nstorage_path/\n  â”œâ”€â”€ Document/   # Regular object storage\n      â””â”€â”€.events/ # Event storage\n      â””â”€â”€ Document/\n          â””â”€â”€ doc - 123.jsonl # Events for doc-123\n```\n\n### Event Format\n\nEach line in the file is a JSON object:\n```\n{\"ts\":\"2025-01-15T10:30:45Z\",\"type\":\"created\",\"gen\":1,\"meta\":{}}\n{\"ts\":\"2025-01-15T11:15:22Z\",\"type\":\"updated\",\"gen\":2,\"meta\":{\"user\":\"alice\"}}\n```","summary":"<p>Event logging backend that stores one file per object.</p>","constructors":[{"html_id":"new(base_path:String=get_storage_path)-class-method","name":"new","abstract":false,"args":[{"name":"base_path","default_value":"get_storage_path","external_name":"base_path","restriction":"String"}],"args_string":"(base_path : String = get_storage_path)","args_html":"(base_path : String = get_storage_path)","location":{"filename":"src/sepia/event_logger.cr","line_number":88,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L88"},"def":{"name":"new","args":[{"name":"base_path","default_value":"get_storage_path","external_name":"base_path","restriction":"String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(base_path)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"append_event(object:Serializable|Container,event_type:LogEventType,generation:Int32,metadata)-instance-method","name":"append_event","doc":"Append an event to the object's event file.\n\nCreates the event file and directory structure if needed,\nthen appends the event as a JSON line.\n\n### Parameters\n\n- *object* : The Sepia object the event relates to\n- *event_type* : Type of event (Created, Updated, Deleted)\n- *generation* : Object generation number\n- *metadata* : Optional metadata for the event","summary":"<p>Append an event to the object's event file.</p>","abstract":false,"args":[{"name":"object","external_name":"object","restriction":"Serializable | Container"},{"name":"event_type","external_name":"event_type","restriction":"LogEventType"},{"name":"generation","external_name":"generation","restriction":"Int32"},{"name":"metadata","external_name":"metadata","restriction":""}],"args_string":"(object : Serializable | Container, event_type : LogEventType, generation : Int32, metadata)","args_html":"(object : <a href=\"../Sepia/Serializable.html\">Serializable</a> | <a href=\"../Sepia/Container.html\">Container</a>, event_type : <a href=\"../Sepia/LogEventType.html\">LogEventType</a>, generation : Int32, metadata)","location":{"filename":"src/sepia/event_logger.cr","line_number":122,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L122"},"def":{"name":"append_event","args":[{"name":"object","external_name":"object","restriction":"Serializable | Container"},{"name":"event_type","external_name":"event_type","restriction":"LogEventType"},{"name":"generation","external_name":"generation","restriction":"Int32"},{"name":"metadata","external_name":"metadata","restriction":""}],"visibility":"Public","body":"if should_log?(object.class)\nelse\n  return\nend\nmetadata_json = metadata ? JSON.parse(metadata.to_json) : JSON::Any.new({} of String => JSON::Any)\nevent = LogEvent.new(event_type, generation, metadata_json)\nevent_file = event_file_path(object.class, object.sepia_id)\n\n\nFileUtils.mkdir_p(File.dirname(event_file))\n\n\nWatcher.add_internal_file(event_file)\n\nbegin\n  File.write(event_file, event.to_json + \"\\n\", mode: \"a\")\n\n\n  spawn do\n    sleep(0.3.seconds)\n    Watcher.remove_internal_file(event_file)\n  end\nrescue ex\n  Watcher.remove_internal_file(event_file)\n  raise(ex)\nend\n"},"external_var":false},{"html_id":"base_path:String-instance-method","name":"base_path","doc":"The base storage path for events.\n\nThis is automatically detected from the current storage backend.","summary":"<p>The base storage path for events.</p>","abstract":false,"location":{"filename":"src/sepia/event_logger.cr","line_number":86,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L86"},"def":{"name":"base_path","return_type":"String","visibility":"Public","body":"@base_path"},"external_var":false},{"html_id":"base_path=(base_path:String)-instance-method","name":"base_path=","doc":"The base storage path for events.\n\nThis is automatically detected from the current storage backend.","summary":"<p>The base storage path for events.</p>","abstract":false,"args":[{"name":"base_path","external_name":"base_path","restriction":"String"}],"args_string":"(base_path : String)","args_html":"(base_path : String)","location":{"filename":"src/sepia/event_logger.cr","line_number":86,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L86"},"def":{"name":"base_path=","args":[{"name":"base_path","external_name":"base_path","restriction":"String"}],"visibility":"Public","body":"@base_path = base_path"},"external_var":false},{"html_id":"read_events(object_class:Class,id:String):Array(LogEvent)-instance-method","name":"read_events","doc":"Read all events for a specific object from its event file.\n\nReturns an empty array if the file doesn't exist or no events are found.\n\n### Parameters\n\n- *object_class* : The class of the object\n- *id* : The object's unique identifier\n\n### Returns\n\nArray of events for the specified object, ordered by timestamp","summary":"<p>Read all events for a specific object from its event file.</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(object_class : Class, id : String) : Array(LogEvent)","args_html":"(object_class : Class, id : String) : Array(<a href=\"../Sepia/LogEvent.html\">LogEvent</a>)","location":{"filename":"src/sepia/event_logger.cr","line_number":162,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/event_logger.cr#L162"},"def":{"name":"read_events","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"return_type":"Array(LogEvent)","visibility":"Public","body":"event_file = event_file_path(object_class, id)\nif File.exists?(event_file)\nelse\n  return [] of LogEvent\nend\n\nevents = [] of LogEvent\nbegin\n  File.each_line(event_file) do |line|\n    if line.strip.empty?\n      next\n    end\n    begin\n      events.push(LogEvent.from_json(line))\n    rescue ex\n    end\n  end\nrescue ex\n  puts(\"Warning: Error reading event file #{event_file}: #{ex.message}\")\nend\n\nevents\n"},"external_var":false}]},{"html_id":"Sepia/Sepia/Serializable","path":"Sepia/Serializable.html","kind":"module","full_name":"Sepia::Serializable","name":"Serializable","abstract":false,"locations":[{"filename":"src/sepia/serializable.cr","line_number":74,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/serializable.cr#L74"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Module for objects that serialize to a single file.\n\nThe `Serializable` module provides a contract for objects that can be\nserialized to and deserialized from a single string representation.\n\nâš ï¸ **WARNING**: The Serializable API and on-disk format are subject to change.\nData migrations will be required when upgrading Sepia versions.\nClasses including this module must implement two methods:\n\n- `to_sepia : String` - Serializes the object to a string\n- `self.from_sepia(sepia_string : String)` - Creates an object from a string\n\n## File Storage\n\nSerializable objects are stored as individual files in the filesystem.\nThe file contains the exact string returned by `to_sepia`.\n\n### Example\n\n```\nclass SimpleNote < Sepia::Object\n  include Sepia::Serializable\n\n  property text : String\n\n  def initialize(@text = \"\")\n  end\n\n  # Serialize to a simple string\n  def to_sepia : String\n    @text\n  end\n\n  # Deserialize from a string\n  def self.from_sepia(sepia_string : String) : self\n    new(sepia_string)\n  end\nend\n\nnote = SimpleNote.new(\"Hello, World!\")\nnote.save # Creates a file containing \"Hello, World!\"\n\nloaded = SimpleNote.load(note.sepia_id)\nloaded.text # => \"Hello, World!\"\n```\n\n### JSON Serialization\n\nFor more complex objects, you can serialize to JSON:\n\n```\nclass User < Sepia::Object\n  include Sepia::Serializable\n\n  property name : String\n  property email : String\n\n  def initialize(@name = \"\", @email = \"\")\n  end\n\n  def to_sepia : String\n    {name: @name, email: @email}.to_json\n  end\n\n  def self.from_sepia(json : String) : self\n    data = JSON.parse(json)\n    new(data[\"name\"].as_s, data[\"email\"].as_s)\n  end\nend\n```","summary":"<p>Module for objects that serialize to a single file.</p>","instance_methods":[{"html_id":"log_activity(action:String,metadata)-instance-method","name":"log_activity","doc":"Logs an activity event for this object.\n\nThis method allows objects to log arbitrary activities that are not\nrelated to object persistence (save/delete operations). Activities\nare stored in the object's event log alongside other events.\n\n### Parameters\n\n- *action* : Description of the activity (e.g., \"moved_lane\", \"edited\")\n- *metadata* : Optional metadata for the activity (values will be converted to strings)\n\n### Example\n\n```\nnote.log_activity(\"moved_lane\", {\"from\" => \"In Progress\", \"to\" => \"Done\", \"user\" => \"alice\"})\n\n# Simple version\nnote.log_activity(\"edited\")\n```","summary":"<p>Logs an activity event for this object.</p>","abstract":false,"args":[{"name":"action","external_name":"action","restriction":"String"},{"name":"metadata","external_name":"metadata","restriction":""}],"args_string":"(action : String, metadata)","args_html":"(action : String, metadata)","location":{"filename":"src/sepia/serializable.cr","line_number":241,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/serializable.cr#L241"},"def":{"name":"log_activity","args":[{"name":"action","external_name":"action","restriction":"String"},{"name":"metadata","external_name":"metadata","restriction":""}],"visibility":"Public","body":"activity_metadata = {\"action\" => action}.merge(metadata)\n\n\nif (self.class.responds_to?(:sepia_log_events)) && self.class.sepia_log_events\n  current_generation = EventLogger.current_generation(self.class, self.sepia_id)\n  EventLogger.append_event(self, LogEventType::Activity, current_generation, activity_metadata)\nend\n"},"external_var":false},{"html_id":"log_activity(action:String)-instance-method","name":"log_activity","doc":"Logs an activity event for this object (without metadata).\n\nThis method allows objects to log arbitrary activities that are not\nrelated to object persistence (save/delete operations). Activities\nare stored in the object's event log alongside other events.\n\n### Parameters\n\n- *action* : Description of the activity (e.g., \"moved_lane\", \"edited\")\n\n### Example\n\n```\nnote.log_activity(\"edited\")\n```","summary":"<p>Logs an activity event for this object (without metadata).</p>","abstract":false,"args":[{"name":"action","external_name":"action","restriction":"String"}],"args_string":"(action : String)","args_html":"(action : String)","location":{"filename":"src/sepia/serializable.cr","line_number":268,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/serializable.cr#L268"},"def":{"name":"log_activity","args":[{"name":"action","external_name":"action","restriction":"String"}],"visibility":"Public","body":"activity_metadata = {\"action\" => action}\n\n\nif (self.class.responds_to?(:sepia_log_events)) && self.class.sepia_log_events\n  current_generation = EventLogger.current_generation(self.class, self.sepia_id)\n  EventLogger.append_event(self, LogEventType::Activity, current_generation, activity_metadata)\nend\n"},"external_var":false},{"html_id":"sepia_references:Enumerable(Sepia::Object)-instance-method","name":"sepia_references","doc":"Returns all Sepia objects referenced by this object.\n\nThis method is used by the garbage collector to track object\nrelationships. By default, Serializable objects don't reference\nother Sepia objects.\n\nOverride this method if your Serializable contains references\nto other Sepia objects that should be tracked.\n\n### Returns\n\nAn Enumerable of Sepia::Object instances referenced by this object.\n\n### Example\n\n```\nclass Document < Sepia::Object\n  include Sepia::Serializable\n\n  property author : User\n\n  def sepia_references : Enumerable(Sepia::Object)\n    [@author] if @author\n  end\nend\n```","summary":"<p>Returns all Sepia objects referenced by this object.</p>","abstract":false,"location":{"filename":"src/sepia/serializable.cr","line_number":218,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/serializable.cr#L218"},"def":{"name":"sepia_references","return_type":"Enumerable(Sepia::Object)","visibility":"Public","body":"[] of Sepia::Object"},"external_var":false}]},{"html_id":"Sepia/Sepia/Storage","path":"Sepia/Storage.html","kind":"class","full_name":"Sepia::Storage","name":"Storage","abstract":false,"superclass":{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/storage.cr","line_number":40,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L40"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"INSTANCE","name":"INSTANCE","value":"new","doc":"Legacy singleton instance for backward compatibility.\n\nProvides the same API as the class methods for existing code\nthat relies on the singleton pattern.","summary":"<p>Legacy singleton instance for backward compatibility.</p>"}],"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Central storage management class.\n\nThe `Storage` class manages pluggable storage backends and provides\nboth a modern class-based API and backward compatibility with the\noriginal singleton pattern.\n\nâš ï¸ **WARNING**: The Storage API and backend interfaces are subject to change.\nThe on-disk format for the filesystem backend is not stable.\n\n### Supported Backends\n\n- `:filesystem` - Default file-based storage (FileStorage)\n- `:memory` - In-memory storage for testing (InMemoryStorage)\n\n### Usage\n\n```\n# Configure storage backend\nSepia::Storage.configure(:filesystem, {\"path\" => \"./data\"})\n\n# Or use in-memory storage\nSepia::Storage.configure(:memory)\n\n# Class-based API (recommended)\nSepia::Storage.save(my_object)\nloaded = Sepia::Storage.load(MyClass, \"object-id\")\n\n# Legacy singleton API (still supported)\nSepia::Storage::INSTANCE.save(my_object)\nloaded = Sepia::Storage::INSTANCE.load(MyClass, \"object-id\")\n```","summary":"<p>Central storage management class.</p>","class_methods":[{"html_id":"backend-class-method","name":"backend","doc":"Returns the current storage backend.\n\n### Returns\n\nThe currently active StorageBackend instance.\n\n### Example\n\n```\nbackend = Sepia::Storage.backend\nputs backend.class # => FileStorage or InMemoryStorage\n```","summary":"<p>Returns the current storage backend.</p>","abstract":false,"location":{"filename":"src/sepia/storage.cr","line_number":65,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L65"},"def":{"name":"backend","visibility":"Public","body":"@@current_backend"},"external_var":false},{"html_id":"backend=(backend:StorageBackend)-class-method","name":"backend=","doc":"Sets the current storage backend.\n\nAllows switching to a different backend implementation at runtime.\n\n### Parameters\n\n- *backend* : A StorageBackend instance to use\n\n### Example\n\n```\n# Switch to custom backend\ncustom_backend = MyCustomStorage.new\nSepia::Storage.backend = custom_backend\n```","summary":"<p>Sets the current storage backend.</p>","abstract":false,"args":[{"name":"backend","external_name":"backend","restriction":"StorageBackend"}],"args_string":"(backend : StorageBackend)","args_html":"(backend : <a href=\"../Sepia/StorageBackend.html\">StorageBackend</a>)","location":{"filename":"src/sepia/storage.cr","line_number":84,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L84"},"def":{"name":"backend=","args":[{"name":"backend","external_name":"backend","restriction":"StorageBackend"}],"visibility":"Public","body":"@@current_backend = backend"},"external_var":false},{"html_id":"backup(objects:Array(Sepia::Object),output_path:String):String-class-method","name":"backup","doc":"Creates a backup of the specified objects.\n\nThis is a convenience method that wraps the `Sepia::Backup.create` method\nand validates that the current storage backend supports backup operations.\n\n### Parameters\n\n- *objects* : Array of objects to include in the backup\n- *output_path* : Path where the backup tar file will be created\n\n### Returns\n\nThe path to the created backup file\n\n### Example\n\n```\n# Backup specific objects\ndocuments = [doc1, doc2, doc3]\nbackup_path = Sepia::Storage.backup(documents, \"docs_backup.tar\")\n\n# Backup a user's entire object tree\nuser_data = [user_object]\nbackup_path = Sepia::Storage.backup(user_data, \"user_backup_#{Time.utc.to_unix}.tar\")\n```\n\n### Raises\n\n- `Sepia::Backup::BackendNotSupportedError` if current backend doesn't support backups\n- `Sepia::Backup::BackupCreationError` if backup creation fails","summary":"<p>Creates a backup of the specified objects.</p>","abstract":false,"args":[{"name":"objects","external_name":"objects","restriction":"Array(Sepia::Object)"},{"name":"output_path","external_name":"output_path","restriction":"String"}],"args_string":"(objects : Array(Sepia::Object), output_path : String) : String","args_html":"(objects : Array(<a href=\"../Sepia/Object.html\">Sepia::Object</a>), output_path : String) : String","location":{"filename":"src/sepia/storage.cr","line_number":695,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L695"},"def":{"name":"backup","args":[{"name":"objects","external_name":"objects","restriction":"Array(Sepia::Object)"},{"name":"output_path","external_name":"output_path","restriction":"String"}],"return_type":"String","visibility":"Public","body":"if backup_supported?\nelse\n  raise(BackendNotSupportedError.new(\"Backup not supported with current storage backend (#{backend.class.name}). Use FileStorage instead.\"))\nend\n\nBackup.create(objects, output_path)\n"},"external_var":false},{"html_id":"backup(object:Sepia::Object,output_path:String):String-class-method","name":"backup","doc":"Creates a backup of a single object and its references.\n\nConvenience method for backing up one object tree.\n\n### Parameters\n\n- *object* : Root object to backup (includes all referenced objects)\n- *output_path* : Path where the backup tar file will be created\n\n### Returns\n\nThe path to the created backup file\n\n### Example\n\n```\n# Backup a project and all its documents\nproject = Sepia::Storage.load(Project, \"project-123\")\nbackup_path = Sepia::Storage.backup(project, \"project_backup.tar\")\n```","summary":"<p>Creates a backup of a single object and its references.</p>","abstract":false,"args":[{"name":"object","external_name":"object","restriction":"Sepia::Object"},{"name":"output_path","external_name":"output_path","restriction":"String"}],"args_string":"(object : Sepia::Object, output_path : String) : String","args_html":"(object : <a href=\"../Sepia/Object.html\">Sepia::Object</a>, output_path : String) : String","location":{"filename":"src/sepia/storage.cr","line_number":723,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L723"},"def":{"name":"backup","args":[{"name":"object","external_name":"object","restriction":"Sepia::Object"},{"name":"output_path","external_name":"output_path","restriction":"String"}],"return_type":"String","visibility":"Public","body":"backup([object], output_path)"},"external_var":false},{"html_id":"backup_all(output_path:String,progress_callback=nil):String-class-method","name":"backup_all","doc":"Creates a backup of all objects in the current storage.\n\nThis method attempts to backup all objects currently stored in the\nstorage backend. Be aware that this can be resource-intensive for\nlarge storage systems.\n\n### Parameters\n\n- *output_path* : Path where the backup tar file will be created\n- *progress_callback* : Optional callback for progress updates\n\n### Returns\n\nThe path to the created backup file\n\n### Example\n\n```\n# Backup everything with progress updates\nbackup_path = Sepia::Storage.backup_all(\"full_backup.tar\") do |progress|\n  puts \"Backup progress: #{progress} objects processed\"\nend\n```","summary":"<p>Creates a backup of all objects in the current storage.</p>","abstract":false,"args":[{"name":"output_path","external_name":"output_path","restriction":"String"},{"name":"progress_callback","default_value":"nil","external_name":"progress_callback","restriction":""}],"args_string":"(output_path : String, progress_callback = nil) : String","args_html":"(output_path : String, progress_callback = <span class=\"n\">nil</span>) : String","location":{"filename":"src/sepia/storage.cr","line_number":750,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L750"},"def":{"name":"backup_all","args":[{"name":"output_path","external_name":"output_path","restriction":"String"},{"name":"progress_callback","default_value":"nil","external_name":"progress_callback","restriction":""}],"return_type":"String","visibility":"Public","body":"if backup_supported?\nelse\n  raise(BackendNotSupportedError.new(\"Backup not supported with current storage backend\"))\nend\n\n\nfile_storage = backend.as(FileStorage)\nstorage_path = file_storage.path\nall_objects = [] of Sepia::Object\n\n\nDir.each_child(storage_path) do |class_dir_name|\n  class_dir = File.join(storage_path, class_dir_name)\n  if File.directory?(class_dir)\n  else\n    next\n  end\n\n\n  Dir.each_child(class_dir) do |object_file|\n\n\n\n\n\n\n    if progress_callback\n      progress_callback.call(all_objects.size)\n    end\n  end\nend\n\nbackup(all_objects, output_path)\n"},"external_var":false},{"html_id":"backup_supported?:Bool-class-method","name":"backup_supported?","doc":"Checks if the current storage backend supports backup operations.\n\nCurrently, only FileStorage supports backup operations as it provides\naccess to the underlying file system structure.\n\n### Returns\n\n`true` if backup is supported, `false` otherwise\n\n### Example\n\n```\nif Sepia::Storage.backup_supported?\n  puts \"Backup operations are available\"\nelse\n  puts \"Switch to FileStorage to enable backup features\"\nend\n```","summary":"<p>Checks if the current storage backend supports backup operations.</p>","abstract":false,"location":{"filename":"src/sepia/storage.cr","line_number":800,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L800"},"def":{"name":"backup_supported?","return_type":"Bool","visibility":"Public","body":"backend.is_a?(FileStorage)"},"external_var":false},{"html_id":"build_generation_path(base_path:String|Nil,generation_id:String):String|Nil-class-method","name":"build_generation_path","doc":"Build a generation-specific path from a base path and generation ID.","summary":"<p>Build a generation-specific path from a base path and generation ID.</p>","abstract":false,"args":[{"name":"base_path","external_name":"base_path","restriction":"String | ::Nil"},{"name":"generation_id","external_name":"generation_id","restriction":"String"}],"args_string":"(base_path : String | Nil, generation_id : String) : String | Nil","args_html":"(base_path : String | Nil, generation_id : String) : String | Nil","location":{"filename":"src/sepia/storage.cr","line_number":546,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L546"},"def":{"name":"build_generation_path","args":[{"name":"base_path","external_name":"base_path","restriction":"String | ::Nil"},{"name":"generation_id","external_name":"generation_id","restriction":"String"}],"return_type":"String | ::Nil","visibility":"Public","body":"if base_path\nelse\n  return nil\nend\n\nparent_dir = File.dirname(base_path)\nfilename = File.basename(base_path)\nFile.join(parent_dir, \"#{filename}#{generation_id}\")\n"},"external_var":false},{"html_id":"clear-class-method","name":"clear","doc":"Bulk operations","summary":"<p>Bulk operations</p>","abstract":false,"location":{"filename":"src/sepia/storage.cr","line_number":446,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L446"},"def":{"name":"clear","visibility":"Public","body":"@@current_backend.clear"},"external_var":false},{"html_id":"configure(backend:Symbol,config:Hash(String,String|Bool|Hash(String,String))={}ofString=>String)-class-method","name":"configure","doc":"Configures storage using a named backend.\n\nProvides a convenient way to configure common backends without\ninstantiating them manually.\n\n### Parameters\n\n- *backend* : Symbol identifying the backend type (`:filesystem` or `:memory`)\n- *config* : Optional configuration hash for the backend\n\n### Configuration Options\n\nFor `:filesystem` backend:\n- `\"path\"`: Root directory path (defaults to system temp directory)\n- `\"watch\"`: Enable file system watcher (default: false)\n  - `true`: Enable watcher with default settings\n  - `false`: Disable watcher\n  - `Hash`: Custom watcher configuration options\n\nFor `:memory` backend:\n- No configuration options available\n\n### Examples\n\n```\n# Configure filesystem storage with custom path\nSepia::Storage.configure(:filesystem, {\"path\" => \"./app_data\"})\n\n# Configure filesystem storage with watcher enabled\nSepia::Storage.configure(:filesystem, {\"watch\" => true})\n\n# Configure filesystem storage with custom watcher settings\nSepia::Storage.configure(:filesystem, {\n  \"path\"  => \"./app_data\",\n  \"watch\" => {\n    \"recursive\" => true,\n    \"latency\"   => 0.1,\n  },\n})\n\n# Configure in-memory storage\nSepia::Storage.configure(:memory)\n```","summary":"<p>Configures storage using a named backend.</p>","abstract":false,"args":[{"name":"backend","external_name":"backend","restriction":"Symbol"},{"name":"config","default_value":"{} of String => String","external_name":"config","restriction":"Hash(String, String | Bool | Hash(String, String))"}],"args_string":"(backend : Symbol, config : Hash(String, String | Bool | Hash(String, String)) = {} of String => String)","args_html":"(backend : Symbol, config : Hash(String, String | Bool | Hash(String, String)) = {} <span class=\"k\">of</span> <span class=\"t\">String</span> <span class=\"o\">=&gt;</span> <span class=\"t\">String</span>)","location":{"filename":"src/sepia/storage.cr","line_number":131,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L131"},"def":{"name":"configure","args":[{"name":"backend","external_name":"backend","restriction":"Symbol"},{"name":"config","default_value":"{} of String => String","external_name":"config","restriction":"Hash(String, String | Bool | Hash(String, String))"}],"visibility":"Public","body":"case backend\nwhen :filesystem\n  path = config[\"path\"]? || Dir.tempdir\n\n\n  watch_config = config[\"watch\"]?\n  if watch_config\n    case watch_config\n    when Bool\n      self.backend = FileStorage.new(path.to_s, watch: watch_config)\n    when Hash\n      self.backend = FileStorage.new(path.to_s, watch: watch_config)\n    when String\n      self.backend = FileStorage.new(path.to_s, watch: watch_config == \"true\")\n    else\n      self.backend = FileStorage.new(path.to_s, watch: !(!watch_config))\n    end\n  else\n    self.backend = FileStorage.new(path.to_s)\n  end\nwhen :memory\n  self.backend = InMemoryStorage.new\nelse\n  raise(\"Unknown storage backend: #{backend}\")\nend\n\n\nEventLogger.reset_backend\n"},"external_var":false},{"html_id":"count(object_class:Class):Int32-class-method","name":"count","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"}],"args_string":"(object_class : Class) : Int32","args_html":"(object_class : Class) : Int32","location":{"filename":"src/sepia/storage.cr","line_number":441,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L441"},"def":{"name":"count","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"}],"return_type":"Int32","visibility":"Public","body":"@@current_backend.count(object_class)"},"external_var":false},{"html_id":"delete(object:Serializable|Container,cache:Bool=true,metadata=nil)-class-method","name":"delete","abstract":false,"args":[{"name":"object","external_name":"object","restriction":"Serializable | Container"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"args_string":"(object : Serializable | Container, cache : Bool = true, metadata = nil)","args_html":"(object : <a href=\"../Sepia/Serializable.html\">Serializable</a> | <a href=\"../Sepia/Container.html\">Container</a>, cache : Bool = <span class=\"n\">true</span>, metadata = <span class=\"n\">nil</span>)","location":{"filename":"src/sepia/storage.cr","line_number":428,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L428"},"def":{"name":"delete","args":[{"name":"object","external_name":"object","restriction":"Serializable | Container"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"visibility":"Public","body":"INSTANCE.delete(object, cache, metadata)"},"external_var":false},{"html_id":"delete(class_name:String,id:String,cache:Bool=true)-class-method","name":"delete","abstract":false,"args":[{"name":"class_name","external_name":"class_name","restriction":"String"},{"name":"id","external_name":"id","restriction":"String"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"}],"args_string":"(class_name : String, id : String, cache : Bool = true)","args_html":"(class_name : String, id : String, cache : Bool = <span class=\"n\">true</span>)","location":{"filename":"src/sepia/storage.cr","line_number":458,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L458"},"def":{"name":"delete","args":[{"name":"class_name","external_name":"class_name","restriction":"String"},{"name":"id","external_name":"id","restriction":"String"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"}],"visibility":"Public","body":"if cache\n  cache_key = \"#{class_name}:#{id}\"\n  CacheManager.instance.remove(cache_key)\nend\n\n\n@@current_backend.delete(class_name, id)\n"},"external_var":false},{"html_id":"exists?(object_class:Class,id:String):Bool-class-method","name":"exists?","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(object_class : Class, id : String) : Bool","args_html":"(object_class : Class, id : String) : Bool","location":{"filename":"src/sepia/storage.cr","line_number":437,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L437"},"def":{"name":"exists?","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"return_type":"Bool","visibility":"Public","body":"@@current_backend.exists?(object_class, id)"},"external_var":false},{"html_id":"export_data:Hash(String,Array(Hash(String,String)))-class-method","name":"export_data","abstract":false,"location":{"filename":"src/sepia/storage.cr","line_number":450,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L450"},"def":{"name":"export_data","return_type":"Hash(String, Array(Hash(String, String)))","visibility":"Public","body":"@@current_backend.export_data"},"external_var":false},{"html_id":"gc(roots:Enumerable(Sepia::Object),dry_run:Bool=false):Hash(String,Array(String))-class-method","name":"gc","abstract":false,"args":[{"name":"roots","external_name":"roots","restriction":"Enumerable(Sepia::Object)"},{"name":"dry_run","default_value":"false","external_name":"dry_run","restriction":"Bool"}],"args_string":"(roots : Enumerable(Sepia::Object), dry_run : Bool = false) : Hash(String, Array(String))","args_html":"(roots : Enumerable(<a href=\"../Sepia/Object.html\">Sepia::Object</a>), dry_run : Bool = <span class=\"n\">false</span>) : Hash(String, Array(String))","location":{"filename":"src/sepia/storage.cr","line_number":600,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L600"},"def":{"name":"gc","args":[{"name":"roots","external_name":"roots","restriction":"Enumerable(Sepia::Object)"},{"name":"dry_run","default_value":"false","external_name":"dry_run","restriction":"Bool"}],"return_type":"Hash(String, Array(String))","visibility":"Public","body":"live_object_keys = Set(String).new\nroots.each do |obj|\n  mark_live_objects(obj, live_object_keys)\nend\n\n\ndeleted_keys = Hash(String, Array(String)).new do |hash, key| hash[key] = [] of String end\nall_objects = list_all_objects\n\nall_objects.each do |class_name, ids|\n  ids.each do |id|\n    key = \"#{class_name}/#{id}\"\n    if live_object_keys.includes?(key)\n    else\n      deleted_keys[class_name] << id\n      if dry_run\n      else\n        delete(class_name, id)\n      end\n    end\n  end\nend\n\ndeleted_keys\n"},"external_var":false},{"html_id":"get_latest_generation(object_class:Class,base_id:String)-class-method","name":"get_latest_generation","doc":"Get the latest generation object for a given base ID.\n\nReturns the object with the highest generation number, or nil if no generations exist.","summary":"<p>Get the latest generation object for a given base ID.</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"base_id","external_name":"base_id","restriction":"String"}],"args_string":"(object_class : Class, base_id : String)","args_html":"(object_class : Class, base_id : String)","location":{"filename":"src/sepia/storage.cr","line_number":513,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L513"},"def":{"name":"get_latest_generation","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"base_id","external_name":"base_id","restriction":"String"}],"visibility":"Public","body":"if @@current_backend.is_a?(FileStorage)\nelse\n  return nil\nend\n\nstorage_path = (@@current_backend.as(FileStorage)).path\nobject_dir = File.join(storage_path, object_class.name)\nif File.directory?(object_dir)\nelse\n  return nil\nend\n\nlatest_id = nil\nlatest_gen = -1\n\nDir.each_child(object_dir) do |filename|\n  if filename.starts_with?(\"#{base_id}.\")\n    gen_part = filename[(base_id.size + 1)..-1]\n    if gen_part.matches?(/^\\d+$/)\n      gen_num = gen_part.to_i\n      if gen_num > latest_gen\n        latest_gen = gen_num\n        latest_id = filename\n      end\n    end\n  end\nend\n\nif latest_id.nil?\n  return nil\nend\n\nbegin\n  @@current_backend.load(object_class, latest_id)\nrescue\n  nil\nend\n"},"external_var":false},{"html_id":"import_data(data:Hash(String,Array(Hash(String,String))))-class-method","name":"import_data","abstract":false,"args":[{"name":"data","external_name":"data","restriction":"Hash(String, Array(Hash(String, String)))"}],"args_string":"(data : Hash(String, Array(Hash(String, String))))","args_html":"(data : Hash(String, Array(Hash(String, String))))","location":{"filename":"src/sepia/storage.cr","line_number":454,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L454"},"def":{"name":"import_data","args":[{"name":"data","external_name":"data","restriction":"Hash(String, Array(Hash(String, String)))"}],"visibility":"Public","body":"@@current_backend.import_data(data)"},"external_var":false},{"html_id":"last_event(object_class:Class,id:String):LogEvent|Nil-class-method","name":"last_event","doc":"Get the last event for a specific object.\n\n### Parameters\n\n- *object_class* : The class of the object\n- *id* : The object's unique identifier\n\n### Returns\n\nThe last event for the object, or nil if no events exist\n\n### Example\n\n```\nlast_event = Sepia::Storage.last_event(MyDocument, \"doc-123\")\nif last_event\n  puts \"Last modified: #{last_event.timestamp}\"\nend\n```","summary":"<p>Get the last event for a specific object.</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(object_class : Class, id : String) : LogEvent | Nil","args_html":"(object_class : Class, id : String) : <a href=\"../Sepia/LogEvent.html\">LogEvent</a> | Nil","location":{"filename":"src/sepia/storage.cr","line_number":596,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L596"},"def":{"name":"last_event","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"return_type":"LogEvent | ::Nil","visibility":"Public","body":"EventLogger.last_event(object_class, id)"},"external_var":false},{"html_id":"list_all(object_class:Class):Array(String)-class-method","name":"list_all","doc":"Discovery API - delegates to current backend","summary":"<p>Discovery API - delegates to current backend</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"}],"args_string":"(object_class : Class) : Array(String)","args_html":"(object_class : Class) : Array(String)","location":{"filename":"src/sepia/storage.cr","line_number":433,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L433"},"def":{"name":"list_all","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"}],"return_type":"Array(String)","visibility":"Public","body":"@@current_backend.list_all(object_class)"},"external_var":false},{"html_id":"list_all_objects:Hash(String,Array(String))-class-method","name":"list_all_objects","abstract":false,"location":{"filename":"src/sepia/storage.cr","line_number":469,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L469"},"def":{"name":"list_all_objects","return_type":"Hash(String, Array(String))","visibility":"Public","body":"@@current_backend.list_all_objects"},"external_var":false},{"html_id":"load(object_class:T.class,id:String,path:String|Nil=nil,cache:Bool=true):TforallT-class-method","name":"load","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"T.class"},{"name":"id","external_name":"id","restriction":"String"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"}],"args_string":"(object_class : T.class, id : String, path : String | Nil = nil, cache : Bool = true) : T forall T","args_html":"(object_class : <span class=\"t\">T</span>.<span class=\"k\">class</span>, id : String, path : String | Nil = <span class=\"n\">nil</span>, cache : Bool = <span class=\"n\">true</span>) : T forall T","location":{"filename":"src/sepia/storage.cr","line_number":424,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L424"},"def":{"name":"load","args":[{"name":"object_class","external_name":"object_class","restriction":"T.class"},{"name":"id","external_name":"id","restriction":"String"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"}],"return_type":"T","visibility":"Public","body":"INSTANCE.load(object_class, id, path, cache)"},"external_var":false},{"html_id":"next_generation_number(object_class:Class,base_id:String):Int32-class-method","name":"next_generation_number","doc":"Get the next generation number for an object based on existing files.\n\nScans the filesystem to find the highest existing generation number\nand returns the next one. This is independent of event logging.\n\n### Parameters\n\n- *object_class* : The class of the object\n- *base_id* : The base ID without generation suffix\n\n### Returns\n\nThe next generation number (1 if no generations exist)","summary":"<p>Get the next generation number for an object based on existing files.</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"base_id","external_name":"base_id","restriction":"String"}],"args_string":"(object_class : Class, base_id : String) : Int32","args_html":"(object_class : Class, base_id : String) : Int32","location":{"filename":"src/sepia/storage.cr","line_number":488,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L488"},"def":{"name":"next_generation_number","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"base_id","external_name":"base_id","restriction":"String"}],"return_type":"Int32","visibility":"Public","body":"if @@current_backend.is_a?(FileStorage)\nelse\n  return 1\nend\n\nstorage_path = (@@current_backend.as(FileStorage)).path\nobject_dir = File.join(storage_path, object_class.name)\n\nif File.directory?(object_dir)\nelse\n  return 1\nend\n\nmax_gen = 0\nDir.each_child(object_dir) do |filename|\n  if filename.starts_with?(\"#{base_id}.\")\n    gen_part = filename[(base_id.size + 1)..-1]\n    if gen_part.matches?(/^\\d+$/)\n      gen_num = gen_part.to_i\n      if gen_num > max_gen\n        max_gen = gen_num\n      end\n    end\n  end\nend\n\nmax_gen + 1\n"},"external_var":false},{"html_id":"object_events(object_class:Class,id:String):Array(LogEvent)-class-method","name":"object_events","doc":"Get all events for a specific object.\n\n### Parameters\n\n- *object_class* : The class of the object\n- *id* : The object's unique identifier\n\n### Returns\n\nArray of events for the specified object, ordered by timestamp\n\n### Example\n\n```\nevents = Sepia::Storage.object_events(MyDocument, \"doc-123\")\nevents.each { |event| puts \"#{event.timestamp}: #{event.event_type}\" }\n```","summary":"<p>Get all events for a specific object.</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(object_class : Class, id : String) : Array(LogEvent)","args_html":"(object_class : Class, id : String) : Array(<a href=\"../Sepia/LogEvent.html\">LogEvent</a>)","location":{"filename":"src/sepia/storage.cr","line_number":573,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L573"},"def":{"name":"object_events","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"return_type":"Array(LogEvent)","visibility":"Public","body":"EventLogger.read_events(object_class, id)"},"external_var":false},{"html_id":"save(object:Serializable,path:String|Nil=nil,cache:Bool=true,metadata=nil,*,force_new_generation:Bool=false)-class-method","name":"save","doc":"Class methods with cache integration (caching is default)","summary":"<p>Class methods with cache integration (caching is default)</p>","abstract":false,"args":[{"name":"object","external_name":"object","restriction":"Serializable"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""},{"name":"","external_name":"","restriction":""},{"name":"force_new_generation","default_value":"false","external_name":"force_new_generation","restriction":"Bool"}],"args_string":"(object : Serializable, path : String | Nil = nil, cache : Bool = true, metadata = nil, *, force_new_generation : Bool = false)","args_html":"(object : <a href=\"../Sepia/Serializable.html\">Serializable</a>, path : String | Nil = <span class=\"n\">nil</span>, cache : Bool = <span class=\"n\">true</span>, metadata = <span class=\"n\">nil</span>, *, force_new_generation : Bool = <span class=\"n\">false</span>)","location":{"filename":"src/sepia/storage.cr","line_number":416,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L416"},"def":{"name":"save","args":[{"name":"object","external_name":"object","restriction":"Serializable"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""},{"name":"","external_name":"","restriction":""},{"name":"force_new_generation","default_value":"false","external_name":"force_new_generation","restriction":"Bool"}],"splat_index":4,"visibility":"Public","body":"INSTANCE.save(object, path, cache, metadata, force_new_generation: force_new_generation)"},"external_var":false},{"html_id":"save(object:Container,path:String|Nil=nil,cache:Bool=true,metadata=nil,*,force_new_generation:Bool=false)-class-method","name":"save","abstract":false,"args":[{"name":"object","external_name":"object","restriction":"Container"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""},{"name":"","external_name":"","restriction":""},{"name":"force_new_generation","default_value":"false","external_name":"force_new_generation","restriction":"Bool"}],"args_string":"(object : Container, path : String | Nil = nil, cache : Bool = true, metadata = nil, *, force_new_generation : Bool = false)","args_html":"(object : <a href=\"../Sepia/Container.html\">Container</a>, path : String | Nil = <span class=\"n\">nil</span>, cache : Bool = <span class=\"n\">true</span>, metadata = <span class=\"n\">nil</span>, *, force_new_generation : Bool = <span class=\"n\">false</span>)","location":{"filename":"src/sepia/storage.cr","line_number":420,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L420"},"def":{"name":"save","args":[{"name":"object","external_name":"object","restriction":"Container"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""},{"name":"","external_name":"","restriction":""},{"name":"force_new_generation","default_value":"false","external_name":"force_new_generation","restriction":"Bool"}],"splat_index":4,"visibility":"Public","body":"INSTANCE.save(object, path, cache, metadata, force_new_generation: force_new_generation)"},"external_var":false}],"instance_methods":[{"html_id":"backup(objects:Array(Sepia::Object),output_path:String):String-instance-method","name":"backup","doc":"Instance version of backup method for backward compatibility.\n\n### Example\n\n```\nSepia::Storage::INSTANCE.backup([doc1, doc2], \"backup.tar\")\n```","summary":"<p>Instance version of backup method for backward compatibility.</p>","abstract":false,"args":[{"name":"objects","external_name":"objects","restriction":"Array(Sepia::Object)"},{"name":"output_path","external_name":"output_path","restriction":"String"}],"args_string":"(objects : Array(Sepia::Object), output_path : String) : String","args_html":"(objects : Array(<a href=\"../Sepia/Object.html\">Sepia::Object</a>), output_path : String) : String","location":{"filename":"src/sepia/storage.cr","line_number":813,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L813"},"def":{"name":"backup","args":[{"name":"objects","external_name":"objects","restriction":"Array(Sepia::Object)"},{"name":"output_path","external_name":"output_path","restriction":"String"}],"return_type":"String","visibility":"Public","body":"self.class.backup(objects, output_path)"},"external_var":false},{"html_id":"backup(object:Sepia::Object,output_path:String):String-instance-method","name":"backup","doc":"Instance version of single object backup method.","summary":"<p>Instance version of single object backup method.</p>","abstract":false,"args":[{"name":"object","external_name":"object","restriction":"Sepia::Object"},{"name":"output_path","external_name":"output_path","restriction":"String"}],"args_string":"(object : Sepia::Object, output_path : String) : String","args_html":"(object : <a href=\"../Sepia/Object.html\">Sepia::Object</a>, output_path : String) : String","location":{"filename":"src/sepia/storage.cr","line_number":818,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L818"},"def":{"name":"backup","args":[{"name":"object","external_name":"object","restriction":"Sepia::Object"},{"name":"output_path","external_name":"output_path","restriction":"String"}],"return_type":"String","visibility":"Public","body":"self.class.backup(object, output_path)"},"external_var":false},{"html_id":"backup_all(output_path:String,progress_callback=nil):String-instance-method","name":"backup_all","doc":"Instance version of backup_all method.","summary":"<p>Instance version of backup_all method.</p>","abstract":false,"args":[{"name":"output_path","external_name":"output_path","restriction":"String"},{"name":"progress_callback","default_value":"nil","external_name":"progress_callback","restriction":""}],"args_string":"(output_path : String, progress_callback = nil) : String","args_html":"(output_path : String, progress_callback = <span class=\"n\">nil</span>) : String","location":{"filename":"src/sepia/storage.cr","line_number":823,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L823"},"def":{"name":"backup_all","args":[{"name":"output_path","external_name":"output_path","restriction":"String"},{"name":"progress_callback","default_value":"nil","external_name":"progress_callback","restriction":""}],"return_type":"String","visibility":"Public","body":"self.class.backup_all(output_path, progress_callback)"},"external_var":false},{"html_id":"backup_supported?:Bool-instance-method","name":"backup_supported?","doc":"Instance version of backup_supported? method.","summary":"<p>Instance version of backup_supported? method.</p>","abstract":false,"location":{"filename":"src/sepia/storage.cr","line_number":828,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L828"},"def":{"name":"backup_supported?","return_type":"Bool","visibility":"Public","body":"self.class.backup_supported?"},"external_var":false},{"html_id":"delete(object:Serializable|Container,cache:Bool=true,metadata=nil)-instance-method","name":"delete","abstract":false,"args":[{"name":"object","external_name":"object","restriction":"Serializable | Container"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"args_string":"(object : Serializable | Container, cache : Bool = true, metadata = nil)","args_html":"(object : <a href=\"../Sepia/Serializable.html\">Serializable</a> | <a href=\"../Sepia/Container.html\">Container</a>, cache : Bool = <span class=\"n\">true</span>, metadata = <span class=\"n\">nil</span>)","location":{"filename":"src/sepia/storage.cr","line_number":381,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L381"},"def":{"name":"delete","args":[{"name":"object","external_name":"object","restriction":"Serializable | Container"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""}],"visibility":"Public","body":"if EventLogger.should_log?(object.class)\n  current_generation = EventLogger.current_generation(object.class, object.sepia_id)\n  EventLogger.append_event(object, LogEventType::Deleted, current_generation, metadata)\nend\n\n\nif cache\n  cache_key = \"#{object.class.name}:#{object.sepia_id}\"\n  CacheManager.instance.remove(cache_key)\nend\n\n\n@@current_backend.delete(object)\n"},"external_var":false},{"html_id":"load(object_class:T.class,id:String,path:String|Nil=nil,cache:Bool=true):TforallT-instance-method","name":"load","doc":"Loads an object using the current backend.\n\nFirst checks the cache for the object. If not found, loads from backend\nand automatically caches the result for future retrievals. Set `cache: false`\nto disable caching for this operation.\n\n### Parameters\n\n- *object_class* : The class of object to load\n- *id* : The object's unique identifier\n- *path* : Optional custom load path\n- *cache* : Whether to use cache (default: true)\n\n### Returns\n\nAn instance of type T loaded from storage.\n\n### Example\n\n```\n# Load with caching (default)\ndoc = Sepia::Storage.load(MyDocument, \"doc-uuid\")\n\n# Load without caching\ndoc = Sepia::Storage.load(MyDocument, \"doc-uuid\", cache: false)\n\n# Type is inferred, no casting needed\nputs doc.content # doc is typed as MyDocument\n```","summary":"<p>Loads an object using the current backend.</p>","abstract":false,"args":[{"name":"object_class","external_name":"object_class","restriction":"T.class"},{"name":"id","external_name":"id","restriction":"String"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"}],"args_string":"(object_class : T.class, id : String, path : String | Nil = nil, cache : Bool = true) : T forall T","args_html":"(object_class : <span class=\"t\">T</span>.<span class=\"k\">class</span>, id : String, path : String | Nil = <span class=\"n\">nil</span>, cache : Bool = <span class=\"n\">true</span>) : T forall T","location":{"filename":"src/sepia/storage.cr","line_number":361,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L361"},"def":{"name":"load","args":[{"name":"object_class","external_name":"object_class","restriction":"T.class"},{"name":"id","external_name":"id","restriction":"String"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"}],"return_type":"T","visibility":"Public","body":"if cache\n  cache_key = \"#{object_class.name}:#{id}\"\n\n\n  cached_object = CacheManager.instance.get(cache_key)\n  if cached_object\n    return cached_object.as(T)\n  end\n\n\n  loaded_object = (@@current_backend.load(object_class, id, path)).as(T)\n  CacheManager.instance.put(cache_key, loaded_object)\n  loaded_object\nelse\n  (@@current_backend.load(object_class, id, path)).as(T)\nend"},"external_var":false},{"html_id":"path:String-instance-method","name":"path","doc":"Legacy path property (only works with FileStorage)","summary":"<p>Legacy path property (only works with FileStorage)</p>","abstract":false,"location":{"filename":"src/sepia/storage.cr","line_number":399,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L399"},"def":{"name":"path","return_type":"String","visibility":"Public","body":"if @@current_backend.is_a?(FileStorage)\n  (@@current_backend.as(FileStorage)).path\nelse\n  raise(\"path property is only available with FileStorage backend\")\nend"},"external_var":false},{"html_id":"path=(path:String)-instance-method","name":"path=","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String)","args_html":"(path : String)","location":{"filename":"src/sepia/storage.cr","line_number":407,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L407"},"def":{"name":"path=","args":[{"name":"path","external_name":"path","restriction":"String"}],"visibility":"Public","body":"if @@current_backend.is_a?(FileStorage)\n  (@@current_backend.as(FileStorage)).path = path\nelse\n  raise(\"path property is only available with FileStorage backend\")\nend"},"external_var":false},{"html_id":"save(object:Serializable,path:String|Nil=nil,cache:Bool=true,metadata=nil,*,force_new_generation:Bool=false)-instance-method","name":"save","doc":"Saves a Serializable object using the current backend.\n\nAutomatically caches the object for faster retrieval. Set `cache: false`\nto disable caching for this operation. Optionally logs the save operation\nif the object's class has event logging enabled.\n\n### Parameters\n\n- *object* : The Serializable object to save\n- *path* : Optional custom save path\n- *cache* : Whether to cache the object (default: true)\n- *metadata* : Optional metadata for event logging\n\n### Example\n\n```\ndoc = MyDocument.new(\"Hello\")\nSepia::Storage.save(doc)                                # Save with caching (default)\nSepia::Storage.save(doc, cache: false)                  # Save without caching\nSepia::Storage.save(doc, metadata: {\"user\" => \"alice\"}) # Save with event logging\n```","summary":"<p>Saves a Serializable object using the current backend.</p>","abstract":false,"args":[{"name":"object","external_name":"object","restriction":"Serializable"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""},{"name":"","external_name":"","restriction":""},{"name":"force_new_generation","default_value":"false","external_name":"force_new_generation","restriction":"Bool"}],"args_string":"(object : Serializable, path : String | Nil = nil, cache : Bool = true, metadata = nil, *, force_new_generation : Bool = false)","args_html":"(object : <a href=\"../Sepia/Serializable.html\">Serializable</a>, path : String | Nil = <span class=\"n\">nil</span>, cache : Bool = <span class=\"n\">true</span>, metadata = <span class=\"n\">nil</span>, *, force_new_generation : Bool = <span class=\"n\">false</span>)","location":{"filename":"src/sepia/storage.cr","line_number":188,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L188"},"def":{"name":"save","args":[{"name":"object","external_name":"object","restriction":"Serializable"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""},{"name":"","external_name":"","restriction":""},{"name":"force_new_generation","default_value":"false","external_name":"force_new_generation","restriction":"Bool"}],"splat_index":4,"visibility":"Public","body":"object_to_save = object\nsave_path = path\n\nif force_new_generation\n  base_id = object.base_id\n  next_gen = Sepia::Storage.next_generation_number(object.class, base_id)\n  new_id = \"#{base_id}#{object.class.generation_separator}#{next_gen}\"\n\n\n  object_to_save = object.class.from_sepia(object.to_sepia)\n  object_to_save.sepia_id = new_id\n\n\n  if save_path\n    parent_dir = File.dirname(save_path)\n    filename = File.basename(save_path)\n    save_path = File.join(parent_dir, \"#{filename}#{object.class.generation_separator}#{next_gen}\")\n  end\n\n  event_type = LogEventType::Updated\n  generation = next_gen\nelse\n  latest_obj = Sepia::Storage.get_latest_generation(object.class, object.base_id)\n  if latest_obj\n    object_to_save = object.class.from_sepia(object.to_sepia)\n    object_to_save.sepia_id = latest_obj.sepia_id\n    save_path = Sepia::Storage.build_generation_path(path, latest_obj.sepia_id)\n    event_type = LogEventType::Updated\n    generation = latest_obj.generation\n  else\n    event_type = determine_event_type(object, path)\n    generation = EventLogger.next_generation(object.class, object.sepia_id)\n  end\nend\n\n\n@@current_backend.save(object_to_save, save_path)\n\n\nif cache\n  cache_key = \"#{object_to_save.class.name}:#{object_to_save.sepia_id}\"\n  CacheManager.instance.put(cache_key, object_to_save)\nend\n\n\nif EventLogger.should_log?(object.class)\n  EventLogger.append_event(object, event_type, generation, metadata)\nend\n\n\nobject_to_save\n"},"external_var":false},{"html_id":"save(object:Container,path:String|Nil=nil,cache:Bool=true,metadata=nil,*,force_new_generation:Bool=false)-instance-method","name":"save","doc":"Saves a Container object using the current backend.\n\nAutomatically caches the object for faster retrieval. Set `cache: false`\nto disable caching for this operation. Optionally logs the save operation\nif the object's class has event logging enabled.\n\n### Parameters\n\n- *object* : The Container object to save\n- *path* : Optional custom save path\n- *cache* : Whether to cache the object (default: true)\n- *metadata* : Optional metadata for event logging\n\n### Example\n\n```\nboard = Board.new(\"My Board\")\nSepia::Storage.save(board)                                # Save with caching (default)\nSepia::Storage.save(board, cache: false)                  # Save without caching\nSepia::Storage.save(board, metadata: {\"user\" => \"alice\"}) # Save with event logging\n```","summary":"<p>Saves a Container object using the current backend.</p>","abstract":false,"args":[{"name":"object","external_name":"object","restriction":"Container"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""},{"name":"","external_name":"","restriction":""},{"name":"force_new_generation","default_value":"false","external_name":"force_new_generation","restriction":"Bool"}],"args_string":"(object : Container, path : String | Nil = nil, cache : Bool = true, metadata = nil, *, force_new_generation : Bool = false)","args_html":"(object : <a href=\"../Sepia/Container.html\">Container</a>, path : String | Nil = <span class=\"n\">nil</span>, cache : Bool = <span class=\"n\">true</span>, metadata = <span class=\"n\">nil</span>, *, force_new_generation : Bool = <span class=\"n\">false</span>)","location":{"filename":"src/sepia/storage.cr","line_number":268,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage.cr#L268"},"def":{"name":"save","args":[{"name":"object","external_name":"object","restriction":"Container"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"},{"name":"cache","default_value":"true","external_name":"cache","restriction":"Bool"},{"name":"metadata","default_value":"nil","external_name":"metadata","restriction":""},{"name":"","external_name":"","restriction":""},{"name":"force_new_generation","default_value":"false","external_name":"force_new_generation","restriction":"Bool"}],"splat_index":4,"visibility":"Public","body":"object_to_save = object\nsave_path = path\n\nif force_new_generation\n  base_id = object.base_id\n  next_gen = Sepia::Storage.next_generation_number(object.class, base_id)\n  new_id = \"#{base_id}#{object.class.generation_separator}#{next_gen}\"\n\n\n\n\n  object_to_save = object.class.new\n  object_to_save.sepia_id = new_id\n\n\n\n\n\n  if save_path\n    parent_dir = File.dirname(save_path)\n    filename = File.basename(save_path)\n    save_path = File.join(parent_dir, \"#{filename}#{object.class.generation_separator}#{next_gen}\")\n  end\n\n  event_type = LogEventType::Updated\n  generation = next_gen\nelse\n  latest_obj = Sepia::Storage.get_latest_generation(object.class, object.base_id)\n  if latest_obj\n    object_to_save.sepia_id = latest_obj.sepia_id\n    save_path = Sepia::Storage.build_generation_path(path, latest_obj.sepia_id)\n    event_type = LogEventType::Updated\n    generation = latest_obj.generation\n  else\n    event_type = determine_event_type(object, path)\n    generation = EventLogger.next_generation(object.class, object.sepia_id)\n  end\nend\n\n\n@@current_backend.save(object_to_save, save_path)\n\n\nif cache\n  cache_key = \"#{object_to_save.class.name}:#{object_to_save.sepia_id}\"\n  CacheManager.instance.put(cache_key, object_to_save)\nend\n\n\nif EventLogger.should_log?(object.class)\n  EventLogger.append_event(object, event_type, generation, metadata)\nend\n\n\nobject_to_save\n"},"external_var":false}]},{"html_id":"Sepia/Sepia/StorageBackend","path":"Sepia/StorageBackend.html","kind":"class","full_name":"Sepia::StorageBackend","name":"StorageBackend","abstract":true,"superclass":{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/storage_backend.cr","line_number":4,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage_backend.cr#L4"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"subclasses":[{"html_id":"Sepia/Sepia/FileStorage","kind":"class","full_name":"Sepia::FileStorage","name":"FileStorage"},{"html_id":"Sepia/Sepia/InMemoryStorage","kind":"class","full_name":"Sepia::InMemoryStorage","name":"InMemoryStorage"}],"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Abstract base class for storage backends.\nAll storage implementations must inherit from this class.","summary":"<p>Abstract base class for storage backends.</p>","instance_methods":[{"html_id":"clear-instance-method","name":"clear","doc":"Clear all data (useful for testing)","summary":"<p>Clear all data (useful for testing)</p>","abstract":true,"location":{"filename":"src/sepia/storage_backend.cr","line_number":30,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage_backend.cr#L30"},"def":{"name":"clear","visibility":"Public","body":""},"external_var":false},{"html_id":"count(object_class:Class):Int32-instance-method","name":"count","doc":"Count objects of a given class","summary":"<p>Count objects of a given class</p>","abstract":true,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"}],"args_string":"(object_class : Class) : Int32","args_html":"(object_class : Class) : Int32","location":{"filename":"src/sepia/storage_backend.cr","line_number":27,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage_backend.cr#L27"},"def":{"name":"count","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"}],"return_type":"Int32","visibility":"Public","body":""},"external_var":false},{"html_id":"delete(class_name:String,id:String)-instance-method","name":"delete","doc":"Delete an object by its class name and ID","summary":"<p>Delete an object by its class name and ID</p>","abstract":true,"args":[{"name":"class_name","external_name":"class_name","restriction":"String"},{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(class_name : String, id : String)","args_html":"(class_name : String, id : String)","location":{"filename":"src/sepia/storage_backend.cr","line_number":18,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage_backend.cr#L18"},"def":{"name":"delete","args":[{"name":"class_name","external_name":"class_name","restriction":"String"},{"name":"id","external_name":"id","restriction":"String"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"delete(object:Serializable|Container)-instance-method","name":"delete","doc":"Delete an object","summary":"<p>Delete an object</p>","abstract":true,"args":[{"name":"object","external_name":"object","restriction":"Serializable | Container"}],"args_string":"(object : Serializable | Container)","args_html":"(object : <a href=\"../Sepia/Serializable.html\">Serializable</a> | <a href=\"../Sepia/Container.html\">Container</a>)","location":{"filename":"src/sepia/storage_backend.cr","line_number":15,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage_backend.cr#L15"},"def":{"name":"delete","args":[{"name":"object","external_name":"object","restriction":"Serializable | Container"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"exists?(object_class:Class,id:String):Bool-instance-method","name":"exists?","doc":"Check if an object exists","summary":"<p>Check if an object exists</p>","abstract":true,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"args_string":"(object_class : Class, id : String) : Bool","args_html":"(object_class : Class, id : String) : Bool","location":{"filename":"src/sepia/storage_backend.cr","line_number":24,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage_backend.cr#L24"},"def":{"name":"exists?","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"}],"return_type":"Bool","visibility":"Public","body":""},"external_var":false},{"html_id":"export_data:Hash(String,Array(Hash(String,String)))-instance-method","name":"export_data","doc":"Export all data as a hash structure","summary":"<p>Export all data as a hash structure</p>","abstract":true,"location":{"filename":"src/sepia/storage_backend.cr","line_number":33,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage_backend.cr#L33"},"def":{"name":"export_data","return_type":"Hash(String, Array(Hash(String, String)))","visibility":"Public","body":""},"external_var":false},{"html_id":"import_data(data:Hash(String,Array(Hash(String,String))))-instance-method","name":"import_data","doc":"Import data from a hash structure","summary":"<p>Import data from a hash structure</p>","abstract":true,"args":[{"name":"data","external_name":"data","restriction":"Hash(String, Array(Hash(String, String)))"}],"args_string":"(data : Hash(String, Array(Hash(String, String))))","args_html":"(data : Hash(String, Array(Hash(String, String))))","location":{"filename":"src/sepia/storage_backend.cr","line_number":36,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage_backend.cr#L36"},"def":{"name":"import_data","args":[{"name":"data","external_name":"data","restriction":"Hash(String, Array(Hash(String, String)))"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"list_all(object_class:Class):Array(String)-instance-method","name":"list_all","doc":"List all object IDs of a given class","summary":"<p>List all object IDs of a given class</p>","abstract":true,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"}],"args_string":"(object_class : Class) : Array(String)","args_html":"(object_class : Class) : Array(String)","location":{"filename":"src/sepia/storage_backend.cr","line_number":21,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage_backend.cr#L21"},"def":{"name":"list_all","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"}],"return_type":"Array(String)","visibility":"Public","body":""},"external_var":false},{"html_id":"list_all_objects:Hash(String,Array(String))-instance-method","name":"list_all_objects","doc":"List all objects, grouped by class name","summary":"<p>List all objects, grouped by class name</p>","abstract":true,"location":{"filename":"src/sepia/storage_backend.cr","line_number":39,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage_backend.cr#L39"},"def":{"name":"list_all_objects","return_type":"Hash(String, Array(String))","visibility":"Public","body":""},"external_var":false},{"html_id":"load(object_class:Class,id:String,path:String|Nil=nil):Object-instance-method","name":"load","doc":"Load an object by class and ID","summary":"<p>Load an object by class and ID</p>","abstract":true,"args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"args_string":"(object_class : Class, id : String, path : String | Nil = nil) : Object","args_html":"(object_class : Class, id : String, path : String | Nil = <span class=\"n\">nil</span>) : <a href=\"../Sepia/Object.html\">Object</a>","location":{"filename":"src/sepia/storage_backend.cr","line_number":12,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage_backend.cr#L12"},"def":{"name":"load","args":[{"name":"object_class","external_name":"object_class","restriction":"Class"},{"name":"id","external_name":"id","restriction":"String"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"return_type":"Object","visibility":"Public","body":""},"external_var":false},{"html_id":"save(object:Serializable,path:String|Nil=nil)-instance-method","name":"save","doc":"Save a Serializable object","summary":"<p>Save a Serializable object</p>","abstract":true,"args":[{"name":"object","external_name":"object","restriction":"Serializable"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"args_string":"(object : Serializable, path : String | Nil = nil)","args_html":"(object : <a href=\"../Sepia/Serializable.html\">Serializable</a>, path : String | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/sepia/storage_backend.cr","line_number":6,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage_backend.cr#L6"},"def":{"name":"save","args":[{"name":"object","external_name":"object","restriction":"Serializable"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"save(object:Container,path:String|Nil=nil)-instance-method","name":"save","doc":"Save a Container object","summary":"<p>Save a Container object</p>","abstract":true,"args":[{"name":"object","external_name":"object","restriction":"Container"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"args_string":"(object : Container, path : String | Nil = nil)","args_html":"(object : <a href=\"../Sepia/Container.html\">Container</a>, path : String | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/sepia/storage_backend.cr","line_number":9,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/storage_backend.cr#L9"},"def":{"name":"save","args":[{"name":"object","external_name":"object","restriction":"Container"},{"name":"path","default_value":"nil","external_name":"path","restriction":"String | ::Nil"}],"visibility":"Public","body":""},"external_var":false}]},{"html_id":"Sepia/Sepia/Watcher","path":"Sepia/Watcher.html","kind":"class","full_name":"Sepia::Watcher","name":"Watcher","abstract":false,"superclass":{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/watcher.cr","line_number":57,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L57"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"File system watcher for Sepia objects using crystal-fswatch.\n\nThis watcher monitors file system changes in a Sepia storage directory\nand emits events for created, modified, or deleted objects.\n\n### Basic Usage\n\n```\nstorage = Sepia::FileStorage.new(\"./data\")\nwatcher = Sepia::Watcher.new(storage)\n\n# Register a callback to receive events\nwatcher.on_change do |event|\n  puts \"Event: #{event.type} for #{event.object_class}:#{event.object_id}\"\nend\n\n# Start watching (this is non-blocking)\nwatcher.start\n\n# When done, stop watching\nwatcher.stop\n```\n\n### Design Principles\n\nThis watcher uses **crystal-fswatch** for reliable file system monitoring:\n- Cross-platform support (Linux, macOS, Windows)\n- No hanging issues in spec environments\n- Clean lifecycle management\n- Thread-safe event handling\n\n### Path Structure\n\nThe watcher expects paths in the format: `storage_path/ClassName/object_id`\nIt will parse these paths and extract the class name and object ID for each event.","summary":"<p>File system watcher for Sepia objects using crystal-fswatch.</p>","class_methods":[{"html_id":"add_internal_file(path:String):Nil-class-method","name":"add_internal_file","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String) : Nil","args_html":"(path : String) : Nil","location":{"filename":"src/sepia/watcher.cr","line_number":57,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L57"},"def":{"name":"add_internal_file","args":[{"name":"path","external_name":"path","restriction":"String"}],"return_type":"Nil","visibility":"Public","body":"@@internal_files_mutex.synchronize do\n  @@internal_files.add(path)\nend"},"external_var":false},{"html_id":"internal_file?(path:String):Bool-class-method","name":"internal_file?","doc":"Class methods for internal file tracking","summary":"<p>Class methods for internal file tracking</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String) : Bool","args_html":"(path : String) : Bool","location":{"filename":"src/sepia/watcher.cr","line_number":57,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L57"},"def":{"name":"internal_file?","args":[{"name":"path","external_name":"path","restriction":"String"}],"return_type":"Bool","visibility":"Public","body":"@@internal_files_mutex.synchronize do\n  @@internal_files.includes?(path)\nend"},"external_var":false},{"html_id":"remove_internal_file(path:String):Nil-class-method","name":"remove_internal_file","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String) : Nil","args_html":"(path : String) : Nil","location":{"filename":"src/sepia/watcher.cr","line_number":57,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L57"},"def":{"name":"remove_internal_file","args":[{"name":"path","external_name":"path","restriction":"String"}],"return_type":"Nil","visibility":"Public","body":"@@internal_files_mutex.synchronize do\n  @@internal_files.delete(path)\nend"},"external_var":false}],"constructors":[{"html_id":"new(storage:FileStorage)-class-method","name":"new","abstract":false,"args":[{"name":"storage","external_name":"storage","restriction":"FileStorage"}],"args_string":"(storage : FileStorage)","args_html":"(storage : <a href=\"../Sepia/FileStorage.html\">FileStorage</a>)","location":{"filename":"src/sepia/watcher.cr","line_number":57,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L57"},"def":{"name":"new","args":[{"name":"storage","external_name":"storage","restriction":"FileStorage"}],"visibility":"Public","body":"_ = allocate\n_.initialize(storage)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"callback:Sepia::Event->Nil?-instance-method","name":"callback","doc":"Alias for callback_block to match spec expectations","summary":"<p>Alias for callback_block to match spec expectations</p>","abstract":false,"location":{"filename":"src/sepia/watcher.cr","line_number":57,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L57"},"def":{"name":"callback","visibility":"Public","body":"@callback_block"},"external_var":false},{"html_id":"callback_block:Event->|Nil-instance-method","name":"callback_block","doc":"Callback block for event handling","summary":"<p>Callback block for event handling</p>","abstract":false,"def":{"name":"callback_block","return_type":"(Event ->) | ::Nil","visibility":"Public","body":"@callback_block"},"external_var":false},{"html_id":"event_count:Int32-instance-method","name":"event_count","doc":"Get the number of events processed (for debugging)","summary":"<p>Get the number of events processed (for debugging)</p>","abstract":false,"location":{"filename":"src/sepia/watcher.cr","line_number":57,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L57"},"def":{"name":"event_count","visibility":"Public","body":"@event_count"},"external_var":false},{"html_id":"on_change(&block:Event->)-instance-method","name":"on_change","doc":"Register a callback to be called when events occur\n\nThe callback will be called for each event that occurs while the watcher is running.\n\n```\nwatcher.on_change do |event|\n  puts \"Got event: #{event.type}\"\nend\n```","summary":"<p>Register a callback to be called when events occur</p>","abstract":false,"location":{"filename":"src/sepia/watcher.cr","line_number":57,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L57"},"def":{"name":"on_change","yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(Event ->)"},"visibility":"Public","body":"@callback_block = block\n\n\nif session = @session\n  setup_session_callback(session, block)\nend\n\nspawn do\n\n  while @running\n    sleep(0.1.seconds)\n  end\nend\n"},"external_var":false},{"html_id":"path_resolver:PathResolver-instance-method","name":"path_resolver","doc":"Path resolver for converting file paths to Sepia object information","summary":"<p>Path resolver for converting file paths to Sepia object information</p>","abstract":false,"def":{"name":"path_resolver","return_type":"PathResolver","visibility":"Public","body":"@path_resolver"},"external_var":false},{"html_id":"running:Bool-instance-method","name":"running","doc":"Whether the watcher is currently running","summary":"<p>Whether the watcher is currently running</p>","abstract":false,"def":{"name":"running","return_type":"Bool","visibility":"Public","body":"@running"},"external_var":false},{"html_id":"running=(running:Bool)-instance-method","name":"running=","doc":"Whether the watcher is currently running","summary":"<p>Whether the watcher is currently running</p>","abstract":false,"args":[{"name":"running","external_name":"running","restriction":"Bool"}],"args_string":"(running : Bool)","args_html":"(running : Bool)","def":{"name":"running=","args":[{"name":"running","external_name":"running","restriction":"Bool"}],"visibility":"Public","body":"@running = running"},"external_var":false},{"html_id":"running?:Bool-instance-method","name":"running?","doc":"Check if the watcher is currently running","summary":"<p>Check if the watcher is currently running</p>","abstract":false,"location":{"filename":"src/sepia/watcher.cr","line_number":57,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L57"},"def":{"name":"running?","visibility":"Public","body":"@running"},"external_var":false},{"html_id":"start-instance-method","name":"start","doc":"Start watching the storage directory for changes\n\nThis method is non-blocking and returns immediately.\nThe actual file system monitoring happens in the background.\n\n```\nwatcher.start\nputs \"Watcher started, continuing with other work...\"\n```","summary":"<p>Start watching the storage directory for changes</p>","abstract":false,"location":{"filename":"src/sepia/watcher.cr","line_number":57,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L57"},"def":{"name":"start","visibility":"Public","body":"if @running\n  return\nend\n\n@running = true\nwatch_path = @storage.path\n\n\n@session = FSWatch::Session.build(recursive: true, latency: 0.1)\n\n\nif callback = @callback_block\n  setup_session_callback(@session.not_nil!, callback)\nend\n\n\n@session.not_nil!.add_path(watch_path)\n\n\n@session.not_nil!.start_monitor\n"},"external_var":false},{"html_id":"stop-instance-method","name":"stop","doc":"Stop watching for file system changes\n\nThis stops the background monitoring.\n\n```\nwatcher.stop\nputs \"Watcher stopped\"\n```","summary":"<p>Stop watching for file system changes</p>","abstract":false,"location":{"filename":"src/sepia/watcher.cr","line_number":57,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/watcher.cr#L57"},"def":{"name":"stop","visibility":"Public","body":"if @running\nelse\n  return\nend\n\n@running = false\n\n\nif session = @session\n  session.stop_monitor\n  @session = nil\nend\n"},"external_var":false},{"html_id":"storage:FileStorage-instance-method","name":"storage","doc":"Storage backend being watched","summary":"<p>Storage backend being watched</p>","abstract":false,"def":{"name":"storage","return_type":"FileStorage","visibility":"Public","body":"@storage"},"external_var":false}]},{"html_id":"Sepia/Sepia/WeakCache","path":"Sepia/WeakCache.html","kind":"class","full_name":"Sepia::WeakCache(T)","name":"WeakCache","abstract":false,"superclass":{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Sepia/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/weak_cache.cr","line_number":27,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L27"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia","kind":"module","full_name":"Sepia","name":"Sepia"},"doc":"Memory-aware cache using weak references.\n\nThis cache holds weak references to objects, allowing the garbage\ncollector to reclaim memory when needed. Automatically cleans up\ndead references and provides memory pressure monitoring.\n\nUses Crystal's built-in WeakRef class for proper weak reference behavior.\n\n### Example\n\n```\nweak_cache = WeakCache(Sepia::Object).new\n\n# Store an object\nweak_cache.put(\"doc-123\", my_document)\n\n# Retrieve an object (may return nil if GC collected it)\ndoc = weak_cache.get(\"doc-123\")\n\n# Cleanup dead references\nweak_cache.cleanup\n```","summary":"<p>Memory-aware cache using weak references.</p>","constructors":[{"html_id":"new(cleanup_interval:Time::Span=60.seconds)-class-method","name":"new","doc":"Creates a new weak cache.\n\n### Parameters\n\n- *cleanup_interval* : How often to run automatic cleanup (default: 60 seconds)\n\n### Example\n\n```\ncache = WeakCache(MyClass).new(cleanup_interval: 30.seconds)\n```","summary":"<p>Creates a new weak cache.</p>","abstract":false,"args":[{"name":"cleanup_interval","default_value":"60.seconds","external_name":"cleanup_interval","restriction":"Time::Span"}],"args_string":"(cleanup_interval : Time::Span = 60.seconds)","args_html":"(cleanup_interval : Time::Span = <span class=\"n\">60</span>.seconds)","location":{"filename":"src/sepia/weak_cache.cr","line_number":77,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L77"},"def":{"name":"new","args":[{"name":"cleanup_interval","default_value":"60.seconds","external_name":"cleanup_interval","restriction":"Time::Span"}],"visibility":"Public","body":"_ = WeakCache(T).allocate\n_.initialize(cleanup_interval)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"cleanup:Int32-instance-method","name":"cleanup","doc":"Removes all dead references from the weak cache.\n\nThis should be called periodically to clean up references to\nobjects that have been garbage collected.\n\n### Returns\n\nThe number of dead references that were removed.\n\n### Example\n\n```\nremoved = weak_cache.cleanup\nputs \"Cleaned up #{removed} dead references\"\n```","summary":"<p>Removes all dead references from the weak cache.</p>","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":227,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L227"},"def":{"name":"cleanup","return_type":"Int32","visibility":"Public","body":"@mutex.synchronize do\n  removed = 0\n  @cache.reject! do |_, ref|\n    if ref.alive?\n      false\n    else\n      removed = removed + 1\n      true\n    end\n  end\n\n  @stats.dead_refs = 0\n  @stats.size = @cache.size\n  @stats.cleanups = @stats.cleanups + 1\n  @last_cleanup = Time.utc\n\n  removed\nend"},"external_var":false},{"html_id":"cleanup_interval:Time::Span-instance-method","name":"cleanup_interval","doc":"Interval for automatic cleanup (in seconds)","summary":"<p>Interval for automatic cleanup (in seconds)</p>","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":64,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L64"},"def":{"name":"cleanup_interval","return_type":"Time::Span","visibility":"Public","body":"@cleanup_interval"},"external_var":false},{"html_id":"clear:Void-instance-method","name":"clear","doc":"Clears all entries from the weak cache.\n\n### Example\n\n```\nweak_cache.clear\nputs weak_cache.stats.size # => 0\n```","summary":"<p>Clears all entries from the weak cache.</p>","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":204,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L204"},"def":{"name":"clear","return_type":"Void","visibility":"Public","body":"@mutex.synchronize do\n  @cache.clear\n  @stats.size = 0\n  @stats.dead_refs = 0\nend"},"external_var":false},{"html_id":"force_cleanup:Void-instance-method","name":"force_cleanup","doc":"Forces cleanup regardless of interval.\n\n### Example\n\n```\nweak_cache.force_cleanup\n```","summary":"<p>Forces cleanup regardless of interval.</p>","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":255,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L255"},"def":{"name":"force_cleanup","return_type":"Void","visibility":"Public","body":"cleanup"},"external_var":false},{"html_id":"get(key:String):T|Nil-instance-method","name":"get","doc":"Retrieves an object from the weak cache.\n\nReturns `nil` if the key doesn't exist, the object was garbage\ncollected, or the weak reference is dead.\n\n### Parameters\n\n- *key* : The cache key\n\n### Returns\n\nThe cached object or `nil`.\n\n### Example\n\n```\ndoc = weak_cache.get(\"doc-123\")\nputs doc.title if doc\n```","summary":"<p>Retrieves an object from the weak cache.</p>","abstract":false,"args":[{"name":"key","external_name":"key","restriction":"String"}],"args_string":"(key : String) : T | Nil","args_html":"(key : String) : T | Nil","location":{"filename":"src/sepia/weak_cache.cr","line_number":129,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L129"},"def":{"name":"get","args":[{"name":"key","external_name":"key","restriction":"String"}],"return_type":"T | ::Nil","visibility":"Public","body":"@mutex.synchronize do\n  ref = @cache[key]?\n  if ref\n    object = ref.get\n    if object\n    else\n      @stats.dead_refs = @stats.dead_refs + 1\n    end\n    object\n  else\n    nil\n  end\nend"},"external_var":false},{"html_id":"has_key?(key:String):Bool-instance-method","name":"has_key?","doc":"Checks if a key exists in the weak cache.\n\n### Parameters\n\n- *key* : The cache key\n\n### Returns\n\n`true` if the key exists and reference is alive, `false` otherwise.\n\n### Example\n\n```\nif weak_cache.has_key?(\"doc-123\")\n  puts \"Object is cached and alive\"\nend\n```","summary":"<p>Checks if a key exists in the weak cache.</p>","abstract":false,"args":[{"name":"key","external_name":"key","restriction":"String"}],"args_string":"(key : String) : Bool","args_html":"(key : String) : Bool","location":{"filename":"src/sepia/weak_cache.cr","line_number":162,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L162"},"def":{"name":"has_key?","args":[{"name":"key","external_name":"key","restriction":"String"}],"return_type":"Bool","visibility":"Public","body":"@mutex.synchronize do\n  ref = @cache[key]?\n  ref ? ref.alive? : false\nend"},"external_var":false},{"html_id":"live_keys:Array(String)-instance-method","name":"live_keys","doc":"Returns all live keys in the weak cache.\n\n### Returns\n\nArray of keys with alive references.\n\n### Example\n\n```\nlive_keys = weak_cache.live_keys\nputs \"#{live_keys.size} objects still cached\"\n```","summary":"<p>Returns all live keys in the weak cache.</p>","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":271,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L271"},"def":{"name":"live_keys","return_type":"Array(String)","visibility":"Public","body":"@mutex.synchronize do\n  @cache.compact_map do |key, ref|\n    if ref.alive?\n      key\n    end\n  end\nend"},"external_var":false},{"html_id":"live_objects:Array(T)-instance-method","name":"live_objects","doc":"Returns all live objects in the weak cache.\n\n### Returns\n\nArray of objects with alive references.\n\n### Example\n\n```\nlive_objects = weak_cache.live_objects\nputs \"#{live_objects.size} objects still cached\"\n```","summary":"<p>Returns all live objects in the weak cache.</p>","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":291,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L291"},"def":{"name":"live_objects","return_type":"Array(T)","visibility":"Public","body":"@mutex.synchronize do\n  @cache.compact_map do |_, ref|\n    ref.get\n  end\nend"},"external_var":false},{"html_id":"memory_pressure:Float64-instance-method","name":"memory_pressure","doc":"Gets the memory pressure level.\n\nReturns a value between 0.0 (no pressure) and 1.0 (high pressure)\nbased on the ratio of dead references to total references.\n\n### Returns\n\nMemory pressure level as a float between 0.0 and 1.0.\n\n### Example\n\n```\npressure = weak_cache.memory_pressure\nputs \"Memory pressure: #{(pressure * 100).round(1)}%\"\n```","summary":"<p>Gets the memory pressure level.</p>","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":356,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L356"},"def":{"name":"memory_pressure","return_type":"Float64","visibility":"Public","body":"@mutex.synchronize do\n  total = @cache.size\n  if total == 0\n    return 0.0\n  end\n\n  dead = @cache.count do |_, ref| !ref.alive? end\n  dead.to_f / total\nend"},"external_var":false},{"html_id":"memory_usage:Int64-instance-method","name":"memory_usage","doc":"Estimates memory usage of live objects in the weak cache.\n\nThis is a rough estimation based on the number of live objects.\n\n### Returns\n\nEstimated memory usage in bytes.\n\n### Example\n\n```\nbytes = weak_cache.memory_usage\nputs \"Weak cache uses approximately #{bytes / 1024} KB\"\n```","summary":"<p>Estimates memory usage of live objects in the weak cache.</p>","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":334,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L334"},"def":{"name":"memory_usage","return_type":"Int64","visibility":"Public","body":"@mutex.synchronize do\n\n  live_objects.size.to_i64 * 1024\nend"},"external_var":false},{"html_id":"needs_cleanup?:Bool-instance-method","name":"needs_cleanup?","doc":"Checks if cleanup is needed based on interval or pressure.\n\n### Returns\n\n`true` if cleanup is recommended, `false` otherwise.\n\n### Example\n\n```\nif weak_cache.needs_cleanup?\n  weak_cache.cleanup\nend\n```","summary":"<p>Checks if cleanup is needed based on interval or pressure.</p>","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":379,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L379"},"def":{"name":"needs_cleanup?","return_type":"Bool","visibility":"Public","body":"@mutex.synchronize do\n  time_since_cleanup = Time.utc - @last_cleanup\n  time_based = time_since_cleanup > @cleanup_interval\n  pressure_based = memory_pressure > 0.3\n\n  time_based || pressure_based\nend"},"external_var":false},{"html_id":"put(key:String,object:T):Void-instance-method","name":"put","doc":"Stores an object in the weak cache.\n\nThe object is stored via weak reference and may be garbage collected\nif there are no strong references to it elsewhere.\n\n### Parameters\n\n- *key* : The cache key\n- *object* : The object to cache\n\n### Example\n\n```\nweak_cache.put(\"doc-123\", my_document)\n```","summary":"<p>Stores an object in the weak cache.</p>","abstract":false,"args":[{"name":"key","external_name":"key","restriction":"String"},{"name":"object","external_name":"object","restriction":"T"}],"args_string":"(key : String, object : T) : Void","args_html":"(key : String, object : T) : Void","location":{"filename":"src/sepia/weak_cache.cr","line_number":99,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L99"},"def":{"name":"put","args":[{"name":"key","external_name":"key","restriction":"String"},{"name":"object","external_name":"object","restriction":"T"}],"return_type":"Void","visibility":"Public","body":"@mutex.synchronize do\n  @cache[key] = CachedRef(T).new(object)\n  @stats.total_added = @stats.total_added + 1\n  @stats.size = @cache.size\n\n\n  maybe_cleanup\nend"},"external_var":false},{"html_id":"remove(key:String):Bool-instance-method","name":"remove","doc":"Removes a specific key from the weak cache.\n\n### Parameters\n\n- *key* : The cache key to remove\n\n### Returns\n\n`true` if the key was removed, `false` if it didn't exist.\n\n### Example\n\n```\nweak_cache.remove(\"doc-123\")\n```","summary":"<p>Removes a specific key from the weak cache.</p>","abstract":false,"args":[{"name":"key","external_name":"key","restriction":"String"}],"args_string":"(key : String) : Bool","args_html":"(key : String) : Bool","location":{"filename":"src/sepia/weak_cache.cr","line_number":184,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L184"},"def":{"name":"remove","args":[{"name":"key","external_name":"key","restriction":"String"}],"return_type":"Bool","visibility":"Public","body":"@mutex.synchronize do\n  if @cache.has_key?(key)\n    @cache.delete(key)\n    @stats.size = @cache.size\n    true\n  else\n    false\n  end\nend"},"external_var":false},{"html_id":"stats:Stats-instance-method","name":"stats","doc":"Returns cache statistics including dead reference count.\n\n### Returns\n\nCurrent cache statistics.\n\n### Example\n\n```\nputs weak_cache.stats\n# => {size: 45, dead_refs: 3, cleanups: 12, total_added: 156}\n```","summary":"<p>Returns cache statistics including dead reference count.</p>","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":311,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L311"},"def":{"name":"stats","return_type":"Stats","visibility":"Public","body":"@mutex.synchronize do\n\n  dead_count = @cache.count do |_, ref| !ref.alive? end\n  @stats.dead_refs = dead_count\n  @stats\nend"},"external_var":false}],"types":[{"html_id":"Sepia/Sepia/WeakCache/Stats","path":"Sepia/WeakCache/Stats.html","kind":"struct","full_name":"Sepia::WeakCache::Stats","name":"Stats","abstract":false,"superclass":{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"Sepia/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"Sepia/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Sepia/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sepia/weak_cache.cr","line_number":48,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L48"}],"repository_name":"Sepia","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"Sepia/Sepia/WeakCache","kind":"class","full_name":"Sepia::WeakCache(T)","name":"WeakCache"},"doc":"Cache statistics","summary":"<p>Cache statistics</p>","constructors":[{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":48,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L48"},"def":{"name":"new","visibility":"Public","body":"x = allocate\nif x.responds_to?(:finalize)\n  ::GC.add_finalizer(x)\nend\nx\n"},"external_var":false}],"instance_methods":[{"html_id":"cleanups:Int64-instance-method","name":"cleanups","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":51,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L51"},"def":{"name":"cleanups","return_type":"Int64","visibility":"Public","body":"@cleanups"},"external_var":false},{"html_id":"cleanups=(cleanups:Int64)-instance-method","name":"cleanups=","abstract":false,"args":[{"name":"cleanups","external_name":"cleanups","restriction":"Int64"}],"args_string":"(cleanups : Int64)","args_html":"(cleanups : Int64)","location":{"filename":"src/sepia/weak_cache.cr","line_number":51,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L51"},"def":{"name":"cleanups=","args":[{"name":"cleanups","external_name":"cleanups","restriction":"Int64"}],"visibility":"Public","body":"@cleanups = cleanups"},"external_var":false},{"html_id":"dead_refs:Int32-instance-method","name":"dead_refs","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":50,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L50"},"def":{"name":"dead_refs","return_type":"Int32","visibility":"Public","body":"@dead_refs"},"external_var":false},{"html_id":"dead_refs=(dead_refs:Int32)-instance-method","name":"dead_refs=","abstract":false,"args":[{"name":"dead_refs","external_name":"dead_refs","restriction":"Int32"}],"args_string":"(dead_refs : Int32)","args_html":"(dead_refs : Int32)","location":{"filename":"src/sepia/weak_cache.cr","line_number":50,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L50"},"def":{"name":"dead_refs=","args":[{"name":"dead_refs","external_name":"dead_refs","restriction":"Int32"}],"visibility":"Public","body":"@dead_refs = dead_refs"},"external_var":false},{"html_id":"initialize-instance-method","name":"initialize","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":48,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L48"},"def":{"name":"initialize","visibility":"Public","body":""},"external_var":false},{"html_id":"size:Int32-instance-method","name":"size","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":49,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L49"},"def":{"name":"size","return_type":"Int32","visibility":"Public","body":"@size"},"external_var":false},{"html_id":"size=(size:Int32)-instance-method","name":"size=","abstract":false,"args":[{"name":"size","external_name":"size","restriction":"Int32"}],"args_string":"(size : Int32)","args_html":"(size : Int32)","location":{"filename":"src/sepia/weak_cache.cr","line_number":49,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L49"},"def":{"name":"size=","args":[{"name":"size","external_name":"size","restriction":"Int32"}],"visibility":"Public","body":"@size = size"},"external_var":false},{"html_id":"to_s:String-instance-method","name":"to_s","doc":"Returns a nicely readable and concise string representation of this object,\ntypically intended for users.\n\nThis method should usually **not** be overridden. It delegates to\n`#to_s(IO)` which can be overridden for custom implementations.\n\nAlso see `#inspect`.","summary":"<p>Returns a nicely readable and concise string representation of this object, typically intended for users.</p>","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":54,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L54"},"def":{"name":"to_s","return_type":"String","visibility":"Public","body":"\"{size: #{@size}, dead_refs: #{@dead_refs}, cleanups: #{@cleanups}, total_added: #{@total_added}}\""},"external_var":false},{"html_id":"total_added:Int64-instance-method","name":"total_added","abstract":false,"location":{"filename":"src/sepia/weak_cache.cr","line_number":52,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L52"},"def":{"name":"total_added","return_type":"Int64","visibility":"Public","body":"@total_added"},"external_var":false},{"html_id":"total_added=(total_added:Int64)-instance-method","name":"total_added=","abstract":false,"args":[{"name":"total_added","external_name":"total_added","restriction":"Int64"}],"args_string":"(total_added : Int64)","args_html":"(total_added : Int64)","location":{"filename":"src/sepia/weak_cache.cr","line_number":52,"url":"https://github.com/ralsina/sepia/blob/7dc1203c49c05bcc38841185ff5432fc3fc4d2a6/src/sepia/weak_cache.cr#L52"},"def":{"name":"total_added=","args":[{"name":"total_added","external_name":"total_added","restriction":"Int64"}],"visibility":"Public","body":"@total_added = total_added"},"external_var":false}]}]}]}]}})